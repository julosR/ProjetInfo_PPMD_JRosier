<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>photosequence.photosequence API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Photosequence">Photosequence</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Photosequence.__init__">Photosequence</a>
                        </li>
                        <li>
                                <a class="variable" href="#Photosequence.iface">iface</a>
                        </li>
                        <li>
                                <a class="variable" href="#Photosequence.plugin_dir">plugin_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#Photosequence.actions">actions</a>
                        </li>
                        <li>
                                <a class="variable" href="#Photosequence.menu">menu</a>
                        </li>
                        <li>
                                <a class="variable" href="#Photosequence.first_start">first_start</a>
                        </li>
                        <li>
                                <a class="variable" href="#Photosequence.transformer">transformer</a>
                        </li>
                        <li>
                                <a class="variable" href="#Photosequence.data_path">data_path</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.init_transformer">init_transformer</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.tr">tr</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.add_action">add_action</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.initGui">initGui</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.unload">unload</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.BrowseFilesXml">BrowseFilesXml</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.BrowseFilesGPKG">BrowseFilesGPKG</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.BrowseFilesIMG">BrowseFilesIMG</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.BrowseOutputFile">BrowseOutputFile</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.add_png_to_qgis_project">add_png_to_qgis_project</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.get_attribute_values">get_attribute_values</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.list2pts3D">list2pts3D</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.extract_rotation_translation">extract_rotation_translation</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.csv_to_dict">csv_to_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.World2Camera">World2Camera</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.Cam2Bundle">Cam2Bundle</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.RadDistOnBundle">RadDistOnBundle</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.Bundle2Pixel">Bundle2Pixel</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.TransfoCoord">TransfoCoord</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.execute_mm3d_simplepredict">execute_mm3d_simplepredict</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.creer_projet_qgis">creer_projet_qgis</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.creer_points">creer_points</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.creer_polygone">creer_polygone</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.reset_dialog">reset_dialog</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.disconnect_signals">disconnect_signals</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.get_image_files">get_image_files</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.get_merged_mask_images">get_merged_mask_images</a>
                        </li>
                        <li>
                                <a class="function" href="#Photosequence.run">run</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
photosequence<wbr>.photosequence    </h1>

                
                        <input id="mod-photosequence-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-photosequence-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">csv</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">os.path</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">QSettings</span><span class="p">,</span> <span class="n">QTranslator</span><span class="p">,</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">NULL</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="n">QIcon</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">qgis.PyQt.QtWidgets</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QFileDialog</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsRasterTransparency</span><span class="p">,</span> <span class="n">QgsPoint</span><span class="p">,</span> <span class="n">QgsField</span><span class="p">,</span> <span class="n">QgsFeature</span><span class="p">,</span> <span class="n">QgsPointXY</span><span class="p">,</span> <span class="n">Qgis</span><span class="p">,</span> <span class="n">QgsVectorLayer</span><span class="p">,</span> \
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>    <span class="n">QgsRasterLayer</span><span class="p">,</span> <span class="n">QgsProject</span><span class="p">,</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">,</span> <span class="n">QgsCoordinateTransform</span><span class="p">,</span> <span class="n">QgsGeometry</span><span class="p">,</span> <span class="n">QgsMessageLog</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">cv2</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># from pyproj import Transformer</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># from .photosequence_micmac import *</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">.CALIB2CSV</span> <span class="kn">import</span> <span class="n">Calib2CSV</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="c1"># Initialize Qt resources from file resources.py</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span> <span class="nn">.resources</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="c1"># Import the code for the dialog</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">.photosequence_dialog</span> <span class="kn">import</span> <span class="n">PhotosequenceDialog</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="k">class</span> <span class="nc">Photosequence</span><span class="p">:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;QGIS Plugin Implementation.&quot;&quot;&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        Constructor.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">        </span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        :param iface: An interface instance that will be passed to this class,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">            which provides the hook by which you can manipulate the QGIS</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">            application at run time.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        :type iface: QgsInterface</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="c1"># Save reference to the QGIS interface</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="c1"># initialize plugin directory</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="c1"># initialize locale</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="n">locale</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;locale/userLocale&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="n">locale_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>            <span class="s1">&#39;i18n&#39;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>            <span class="s1">&#39;Photosequence_</span><span class="si">{}</span><span class="s1">.qm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locale</span><span class="p">))</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">locale_path</span><span class="p">):</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="n">QTranslator</span><span class="p">()</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">locale_path</span><span class="p">)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="c1"># Declare instance attributes</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;photosequence&#39;</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="c1"># Check if plugin was started the first time in current QGIS session</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="c1"># Must be set in initGui() to survive plugin reloads</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">init_transformer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">source_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">target_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">source_crs</span><span class="p">,</span> <span class="n">target_crs</span><span class="p">,</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">())</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="c1"># noinspection PyMethodMayBeStatic</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the translation for a string using Qt translation API.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        We implement this ourselves since we do not inherit QObject.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        :param message: String for translation.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">        :type message: str, QString</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        :returns: Translated version of message.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        :rtype: QString</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="c1"># noinspection PyTypeChecker,PyArgumentList,PyCallByClass</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;Photosequence&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">add_action</span><span class="p">(</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>            <span class="n">icon_path</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>            <span class="n">text</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>            <span class="n">callback</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="n">enabled_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>            <span class="n">add_to_menu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="n">add_to_toolbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>            <span class="n">status_tip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>            <span class="n">whats_this</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>            <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a toolbar icon to the toolbar.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        :param icon_path: Path to the icon for this action. Can be a resource</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">            path (e.g. &#39;:/plugins/foo/bar.png&#39;) or a normal file system path.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        :type icon_path: str</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        :param text: Text that should be shown in menu items for this action.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        :type text: str</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        :param callback: Function to be called when the action is triggered.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        :type callback: function</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        :param enabled_flag: A flag indicating if the action should be enabled</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">            by default. Defaults to True.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        :type enabled_flag: bool</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        :param add_to_menu: Flag indicating whether the action should also</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            be added to the menu. Defaults to True.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        :type add_to_menu: bool</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        :param add_to_toolbar: Flag indicating whether the action should also</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">            be added to the toolbar. Defaults to True.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        :type add_to_toolbar: bool</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        :param status_tip: Optional text to show in a popup when mouse pointer</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">            hovers over the action.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        :type status_tip: str</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        :param parent: Parent widget for the new action. Defaults None.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        :type parent: QWidget</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        :param whats_this: Optional text to show in the status bar when the</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">            mouse pointer hovers over the action.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        :returns: The action that was created. Note that the action is also</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">            added to self.actions list.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        :rtype: QAction</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled_flag</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="n">status_tip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>            <span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">status_tip</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">whats_this</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="n">action</span><span class="o">.</span><span class="n">setWhatsThis</span><span class="p">(</span><span class="n">whats_this</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">add_to_toolbar</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="c1"># Adds plugin icon to Plugins toolbar</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="n">add_to_menu</span><span class="p">:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addPluginToMenu</span><span class="p">(</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                <span class="n">action</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="n">action</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the menu entries and toolbar icons inside the QGIS GUI.&quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="n">icon_path</span> <span class="o">=</span> <span class="s1">&#39;:/plugins/photosequence/icon.png&#39;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="n">icon_path</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Photosquence&#39;</span><span class="p">),</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="c1"># will be set False in run()</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes the plugin menu item and icon from QGIS GUI.&quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removePluginMenu</span><span class="p">(</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;photosequence&#39;</span><span class="p">),</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                <span class="n">action</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removeToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">,</span> <span class="n">file_type</span><span class="p">):</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;calibration&#39;</span><span class="p">:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="c1"># pour le fichier de calibration de al camra</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open Calibration File&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;XML files (*.xml)&#39;</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="c1"># pour le fichier d&#39;orientation</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open Orientation File&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;XML files (*.xml)&#39;</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesGPKG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">,</span> <span class="n">file_type</span><span class="p">):</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="c1"># pour le fichierde mise en place absolue de camra</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open line trajectory file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>                                                <span class="s1">&#39;GPKG files (*.gpkg)&#39;</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="c1"># pour le fichier de calibration de al camra</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open point trajectory file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>                                                <span class="s1">&#39;GPKG files (*.gpkg)&#39;</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesIMG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">):</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Select image(s) directory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                                                     <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>            <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">BrowseOutputFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Select output directory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                                                     <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">add_png_to_qgis_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">,</span> <span class="n">png_path</span><span class="p">,</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">transparence</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        Ajoute une couche d&#39;image PNG  un projet QGIS existant et retourne la couche ajoute.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        Si &#39;transparence&#39; est True, applique la transparence sur la couche.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        </span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        :param project_path: Chemin du projet QGIS existant (.qgs ou .qgz).</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        :param png_path: Chemin de l&#39;image PNG  ajouter comme couche raster.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        :param transparence: Boolen indiquant si la transparence doit tre applique (True ou False).</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        :return: La couche raster ajoute au projet.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="c1"># Charger le projet existant</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="n">project</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de lire le projet QGIS : </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="c1"># Crer une couche raster  partir du PNG</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">png_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Nom de la couche bas sur le fichier</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="n">raster_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">png_path</span><span class="p">,</span> <span class="n">layer_name</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : La couche raster base sur </span><span class="si">{</span><span class="n">png_path</span><span class="si">}</span><span class="s2"> n&#39;est pas valide.&quot;</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="n">raster_layer</span><span class="o">.</span><span class="n">setCrs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="c1"># Ajouter la couche raster au projet</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">project</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">raster_layer</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couche raster ajoute : </span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="c1"># Si transparence est active, appliquer la transparence  la couche</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="n">transparence</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="n">raster_layer</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raster_layer</span><span class="p">,</span> <span class="n">QgsRasterLayer</span><span class="p">):</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="n">transparency</span> <span class="o">=</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">rasterTransparency</span><span class="p">()</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                <span class="n">transparent_pixel</span> <span class="o">=</span> <span class="n">QgsRasterTransparency</span><span class="o">.</span><span class="n">TransparentThreeValuePixel</span><span class="p">()</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">blue</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">green</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">red</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">percentTransparent</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="n">transparency</span><span class="o">.</span><span class="n">setTransparentThreeValuePixelList</span><span class="p">([</span><span class="n">transparent_pixel</span><span class="p">])</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>                <span class="c1"># Rafrachir la couche pour que la transparence soit applique</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>                <span class="n">raster_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transparence applique  la couche : </span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="c1"># Sauvegarder le projet</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="o">.</span><span class="n">write</span><span class="p">():</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Erreur lors de la sauvegarde du projet QGIS.&quot;</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projet sauvegard avec succs : </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="c1"># Retourner la couche ajoute</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="n">raster_layer</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="nf">get_attribute_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gpkg_path</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">        Rcupre les valeurs d&#39;un attribut spcifique dans un fichier GeoPackage.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    </span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">        :param gpkg_path: Chemin vers le fichier GeoPackage (.gpkg)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        :param attribute_name: Nom de l&#39;attribut  rcuprer</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        :return: Liste des valeurs de l&#39;attribut</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">gpkg_path</span><span class="p">,</span> <span class="s2">&quot;MyLayer&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de charger la couche GeoPackage : </span><span class="si">{</span><span class="n">gpkg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">if</span> <span class="n">attribute_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;attribut &#39;</span><span class="si">{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">&#39; n&#39;existe pas dans la couche.&quot;</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">attribute_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()]</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">attribute_values</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">list2pts3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">liste_coord</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        Permet de transformer une liste de coordonnes en fichier XML pour MicMac.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        </span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        :param liste_coord: Liste de coordonnes x, y, z de taille (3, n), </span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">                             par exemple : [[x1, x2, ...], [y1, y2, ...], [z1, z2, ...]].</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">        :param output_file: Chemin du fichier XML  gnrer.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">        :return: Un fichier xml au format MicMac des points pour utiliser mm3d SimplePredict</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="c1"># Vrifier que la liste est dans le bon format</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">liste_coord</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">liste_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">liste_coord</span><span class="p">):</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="s2">&quot;La liste des coordonnes doit tre au format [[x1, x2, ...], [y1, y2, ...], [z1, z2, ...]].&quot;</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="c1"># Crer l&#39;lment racine XML</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;DicoAppuisFlottant&quot;</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="c1"># Ajouter les coordonnes au fichier XML</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">liste_coord</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>            <span class="n">one_appuis_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;OneAppuisDAF&quot;</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>            <span class="c1"># Ajouter l&#39;lment Pt avec les coordonnes x, y, z</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="n">pt_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;Pt&quot;</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="n">pt_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="c1"># Ajouter le nom du point (NamePt)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="n">name_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;NamePt&quot;</span><span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="n">name_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="c1"># Ajouter l&#39;incertitude</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>            <span class="n">incertitude_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;Incertitude&quot;</span><span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="n">incertitude_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;1 1 1&quot;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="c1"># Crer l&#39;arbre XML et l&#39;crire dans le fichier</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">extract_rotation_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_filepath</span><span class="p">):</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml_filepath</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="c1"># Extraire la matrice de rotation qui est dans la balise externe</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="n">param_rotation</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//Externe/ParamRotation/CodageMatr&#39;</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="n">param_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">)</span>  <span class="c1"># Convertir en array (3, 3)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="c1"># Extraire le vecteur de translation (Centre)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="n">centre</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//Externe/Centre&#39;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">translation_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">centre</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()))])</span> <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># Convertir en array (1, 3)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">translation_vector</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">csv_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="c1"># On retourne le dictionnaire de la premire ligne</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>    <span class="k">def</span> <span class="nf">World2Camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">Cam2Bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt3d</span><span class="p">):</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">pt3d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">RadDistOnBundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="n">rho2</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeffs</span><span class="p">))</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="p">),</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="nf">Bundle2Pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">PP_x</span><span class="p">,</span> <span class="n">PP_y</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">PP_x</span><span class="p">,</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">PP_y</span><span class="p">]</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="k">def</span> <span class="nf">TransfoCoord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">TablCoord</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        Transforme des coordonnes 3D en coordonnes 2D dans une image en appliquant les tapes de la chane</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        de calibration, de projection et de distorsion.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        </span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        Cette mthode prend un fichier de calibration (XML), une orientation (matrices de rotation et de translation),</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        un tableau de coordonnes 3D, et une image pour produire une liste de points filtrs (en pixels) correspondant</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        aux coordonnes projetes dans l&#39;image.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        </span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        :param calib: Chemin vers le fichier de calibration au format XML.</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        :type calib: str</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        :param orientation: Chemin vers le fichier contenant les matrices de rotation et de translation.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        :type orientation: str</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        :param TablCoord: Tableau numpy contenant les coordonnes 3D  transformer (de forme Nx3).</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        :type TablCoord: numpy.ndarray</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        :param img: Chemin vers l&#39;image utilise pour filtrer les points en dehors des dimensions de l&#39;image.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        :type img: str</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        </span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        :return: Un tuple contenant :</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">            - list: Liste des coordonnes 2D filtres (QgsPointXY) qui se trouvent  l&#39;intrieur des dimensions de l&#39;image.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">            - list: Liste complte des coordonnes 2D projetes (incluant les outliers).</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        :rtype: tuple</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        </span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        :notes:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">            - Les tapes de transformation incluent :</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">                1. Transformation du fichier de calibration XML en CSV.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">                2. Extraction des matrices de rotation et du vecteur de translation.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">                3. Application des distorsions radiales.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">                4. Filtrage des points projets pour ne garder que ceux dans les limites de l&#39;image.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">            - Les points hors des dimensions de l&#39;image sont exclus du rsultat final.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">            - Les coordonnes retournes sont inverses en Y, pour correspondre au coordones image sur qgis.</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 0 pour Incertitudes, 1 pour Angles</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>    
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="c1"># Convertir le fichier de calibration XML en CSV</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="n">calib_converter</span> <span class="o">=</span> <span class="n">Calib2CSV</span><span class="p">(</span><span class="n">calib</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="n">calib_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>  <span class="c1"># Convertir le fichier XML en CSV</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="n">calib_camera_csv</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="c1"># Dictionnaire des variables de calibrations</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_to_dict</span><span class="p">(</span><span class="n">calib_camera_csv</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>    
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="n">R</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_rotation_translation</span><span class="p">(</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="n">orientation</span><span class="p">)</span>  <span class="c1"># Rcupration des matrices de rotation et vecteurs de translation</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="n">coeffs_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_1&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_2&#39;</span><span class="p">]),</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                               <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_3&#39;</span><span class="p">])])</span>  <span class="c1"># Cration du vecteur K1, K2, K3</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="n">coeffs_rad_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_1&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_2&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_3&#39;</span><span class="p">]),</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>             <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_4&#39;</span><span class="p">])])</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>    
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="n">L_Coord</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>    
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TablCoord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># Boucle sur tous les points  transformer</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="c1"># World to camera frame</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="n">ptCam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">World2Camera</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">TablCoord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># Reshape pour vecteurs</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>            <span class="c1"># Camera frame to bundle</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="n">ptBun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cam2Bundle</span><span class="p">(</span><span class="n">ptCam</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="c1"># Application des distorsions radiales</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="n">ptDist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadDistOnBundle</span><span class="p">(</span><span class="n">coeffs_rad</span><span class="p">,</span> <span class="n">ptBun</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>            <span class="c1"># Bundle to pixel</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="n">pt2Dproj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bundle2Pixel</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CDist_X&#39;</span><span class="p">]),</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                                         <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CDist_Y&#39;</span><span class="p">]),</span> <span class="n">ptDist</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>            <span class="n">L_Coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt2Dproj</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>    
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>    
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="c1"># Filtrer les points pour ne garder que ceux dans les dimensions de l&#39;image</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="n">coord_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">L_Coord</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">]</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="c1"># Traiter les coordonnes sans outliers</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="n">coord_wo_outliers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">)):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">L_Coord</span><span class="p">[</span><span class="n">L_Coord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">coord_filtered</span><span class="p">):</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_Coord</span><span class="p">[</span><span class="n">L_Coord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>    
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="c1"># Transformation des coordonnes en QgsPointXY</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">coord_XY</span> <span class="o">=</span> <span class="p">[</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_wo_outliers</span><span class="p">]</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>    
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="k">return</span> <span class="n">coord_XY</span><span class="p">,</span> <span class="n">L_Coord</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>    <span class="k">def</span> <span class="nf">execute_mm3d_simplepredict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        Excute la commande MicMac `mm3d SimplePredict`.</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        </span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        Commande excute : </span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">            mm3d SimplePredict &quot;*.JPG&quot; Ori-Absolut/ Points3D.xml</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">        </span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">        :return: La sortie standard de la commande si elle s&#39;excute avec succs, ou None si une erreur survient.</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">        :rtype: str | None</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">        </span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">        :raises subprocess.CalledProcessError: Si la commande choue et que `check=True` est activ.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">        </span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        :notes:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">            - Les fichiers requis doivent tre prsents dans les rpertoires appropris pour que la commande aboutisse</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">              (images JPG, orientation absolue et fichier Points3D.xml).</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">            - Les logs sont crits dans la console de QGIS via `QgsMessageLog`.</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="c1"># commande micmac </span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mm3d&#39;</span><span class="p">,</span> <span class="s1">&#39;SimplePredict&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;.*.JPG&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;Ori-Absolut/&#39;</span><span class="p">,</span> <span class="s1">&#39;Points3D.xml&#39;</span><span class="p">]</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>            <span class="c1"># Excuter la commande et sauver la sortie</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>    
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>            <span class="c1"># Log de la sortie standard</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="n">QgsMessageLog</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Commande excute avec succs : </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;PhotosequenceGen&quot;</span><span class="p">,</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>            <span class="k">return</span> <span class="n">output</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="c1"># Log en cas d&#39;erreur</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="n">QgsMessageLog</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur lors de l&#39;excution : </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;PhotosequenceGen&quot;</span><span class="p">,</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="k">def</span> <span class="nf">creer_projet_qgis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputdir</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        Cre un projet QGIS  et retourne le chemin d&#39;accs au fichier cr.</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">    </span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        Parameters</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">        ----------</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">        self : instance</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">            Instance de la classe qui contient cette mthode.</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">        outputdir : str</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">            Chemin du rpertoire o le projet QGIS sera cr.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">    </span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        Returns</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        -------</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        str</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">            Chemin complet du fichier projet QGIS cr, ou None en cas d&#39;erreur.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="c1"># Vrifier si le dossier de sortie existe</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputdir</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : Le dossier </span><span class="si">{</span><span class="n">outputdir</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="c1"># Vrifier si le chemin est un rpertoire</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outputdir</span><span class="p">):</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : </span><span class="si">{</span><span class="n">outputdir</span><span class="si">}</span><span class="s2"> n&#39;est pas un rpertoire.&quot;</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="c1"># Nom et chemin complet du fichier projet</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="n">nom_projet</span> <span class="o">=</span> <span class="s2">&quot;photosequence.qgz&quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="n">chemin_projet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputdir</span><span class="p">,</span> <span class="n">nom_projet</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="c1"># Crer un projet QGIS vierge</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="n">projet</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="n">projet</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Nettoyer le projet actuel pour garantir qu&#39;il est vierge</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">projet</span><span class="o">.</span><span class="n">setCrs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="c1"># Enregistrer le projet dans le rpertoire spcifi</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="k">if</span> <span class="n">projet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chemin_projet</span><span class="p">):</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projet QGIS vierge cr avec succs : </span><span class="si">{</span><span class="n">chemin_projet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="k">return</span> <span class="n">chemin_projet</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : Impossible de crer le projet QGIS dans </span><span class="si">{</span><span class="n">chemin_projet</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="k">def</span> <span class="nf">creer_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory_file</span><span class="p">,</span> <span class="n">OutputDir</span><span class="p">,</span> <span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">        Permet de crer une couche de points contenant les pinules et les labels de certains points de la trajectoire de l&#39;avion.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">        </span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">        :param trajectory_file: Couche vectorielle contenant les donnes de la trajectoire de vol avec des champs comme &#39;longitude&#39;, &#39;latitude&#39; et &#39;alt_m&#39;.</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">        :type trajectory_file: QgsVectorLayer</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">        :param OutputDir: Rpertoire de sortie o seront enregistres les donnes (non utilis dans cette fonction mais pass par convention).</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">        :type OutputDir: str</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">        :param calib: Chemin vers le fichier contenant les paramtres de calibration de la camra.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="sd">        :type calib: str</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">        :param orientation: Dictionnaire contenant les paramtres d&#39;orientation de la camra.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">        :type orientation: dict</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        :param img: Chemin du fichier image  utiliser pour la projection des points.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">        :type img: str</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">        </span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">        :return: Couche vectorielle contenant les points projets, ajoute au projet QGIS.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">        :rtype: QgsVectorLayer</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_transformer</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="c1"># Cration de la couche temporaire en mmoire</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="n">point_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Point?crs=EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;points_photosequence&#39;</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">provider</span> <span class="o">=</span> <span class="n">point_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="c1"># Ajout des champs provenant de la couche trajectory_file</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="n">qgsfields</span> <span class="o">=</span> <span class="n">trajectory_file</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">(</span><span class="n">qgsfields</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="n">point_layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="c1"># Boucle pour ajouter les points  la couche</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">trajectory_file</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>            <span class="n">altitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>            <span class="c1"># Transformation des coordonnes en systme RGF93</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>            <span class="n">point_wgs84</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>            <span class="n">point_proj_wo_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point_wgs84</span><span class="p">)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>            <span class="n">point_proj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">point_proj_wo_z</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj_wo_z</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">altitude</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>            <span class="c1"># Transformation en coordonnes d&#39;image</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">coord_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">point_proj</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>            <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>                <span class="c1"># Cration de l&#39;entit avec les coordonnes de l&#39;image</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>                <span class="n">new_feature</span> <span class="o">=</span> <span class="n">feature</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>                <span class="n">new_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>                <span class="c1"># Copie des attributs de trajecto_layer</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>                <span class="c1"># new_feature.setAttributes([feature[field.name()] for field in qgsfields])</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>                <span class="n">new_feature</span><span class="p">[</span><span class="s1">&#39;label_posx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>                <span class="n">new_feature</span><span class="p">[</span><span class="s1">&#39;label_posy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>                <span class="c1"># Ajout de l&#39;entit  la couche</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>                <span class="n">provider</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">new_feature</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>        <span class="c1"># Application du style  la couche (si le fichier de style existe)</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>        <span class="n">style_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;style_bea.qml&quot;</span><span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">style_path</span><span class="p">):</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>            <span class="n">point_layer</span><span class="o">.</span><span class="n">loadNamedStyle</span><span class="p">(</span><span class="n">style_path</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>            <span class="n">point_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : le fichier de style </span><span class="si">{</span><span class="n">style_path</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>        <span class="c1"># Ajouter la couche au projet QGIS</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>        <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">point_layer</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="c1"># Retourner la couche cre</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>        <span class="k">return</span> <span class="n">point_layer</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>    <span class="k">def</span> <span class="nf">creer_polygone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points_sol</span><span class="p">,</span> <span class="n">points_air</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="sd">        Permet de crer des polygones pour les points 2  2.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">        </span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">        Les polygones auront un contour rouge, et leur intrieur sera d&#39;un rouge plus clair. </span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">        La table attributaire est remplie avec le numro du point et les coordonnes des points dans les airs.</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">        </span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">        :param points_sol: Liste des positions de l&#39;avion au sol sous forme de QgsPointXY.</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">        :type points_sol: List[QgsPointXY]</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">        :param points_air: Liste des positions de la trace arienne de l&#39;avion sous forme de QgsPointXY.</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">        :type points_air: List[QgsPointXY]</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">        </span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">        :return: Une couche de polygone</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">        :rtype: QgsVectorLayer</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="c1"># Crer une couche de polygones vide</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="n">polygone_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Polygon?crs=EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Polygones&#39;</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="n">provider</span> <span class="o">=</span> <span class="n">polygone_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="c1"># Ajouter les champs pour la table d&#39;attributs</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;num_point&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;x_air1&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;y_air1&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;x_air2&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;y_air2&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="p">])</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>        <span class="c1"># Ajouter les polygones pour chaque paire de points</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points_sol</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_air</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>            <span class="n">point_sol1</span> <span class="o">=</span> <span class="n">points_sol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>            <span class="n">point_sol2</span> <span class="o">=</span> <span class="n">points_sol</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>            <span class="n">point_air1</span> <span class="o">=</span> <span class="n">points_air</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>            <span class="n">point_air2</span> <span class="o">=</span> <span class="n">points_air</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>            <span class="c1"># Crer le polygone</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>            <span class="n">polygone</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPolygonXY</span><span class="p">([</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>                <span class="p">[</span><span class="n">point_sol1</span><span class="p">,</span> <span class="n">point_air1</span><span class="p">,</span> <span class="n">point_air2</span><span class="p">,</span> <span class="n">point_sol2</span><span class="p">]</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>            <span class="p">])</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>            <span class="c1"># Crer une entit avec les attributs</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            <span class="n">feature</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="n">feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">polygone</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>            <span class="n">feature</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>                <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Numro du point</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>                <span class="n">point_air1</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_air1</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span>  <span class="c1"># Coordonnes du premier point arien</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                <span class="n">point_air2</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_air2</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>  <span class="c1"># Coordonnes du deuxime point arien</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>            <span class="p">])</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>            <span class="n">provider</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>        <span class="n">chemin_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>        <span class="n">repertoire_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">chemin_script</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>        <span class="n">style_path</span> <span class="o">=</span> <span class="n">repertoire_script</span> <span class="o">+</span> <span class="s1">&#39;/Polygones.qml&#39;</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">style_path</span><span class="p">):</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : le fichier de style </span><span class="si">{</span><span class="n">style_path</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>            <span class="k">return</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>        <span class="c1"># Charger le style .qml</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">loadNamedStyle</span><span class="p">(</span><span class="n">style_path</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">polygone_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erreur : le style n&#39;a pas pu tre appliqu.&quot;</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>            <span class="k">return</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>        <span class="c1"># Appliquer le style et redessiner la couche</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="c1"># Confirmer que le style a t appliqu</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Style appliqu avec succs.&quot;</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>        <span class="c1"># Ajouter la couche au projet</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">polygone_layer</span><span class="p">)</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>        <span class="c1"># Retourner la couche cre</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="k">return</span> <span class="n">polygone_layer</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>    <span class="k">def</span> <span class="nf">reset_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rinitialise les champs de la bote de dialogue.&quot;&quot;&quot;</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier de calibration</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier d&#39;orientation</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier image</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser la trajectoire des points</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le rpertoire de sortie</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>    <span class="k">def</span> <span class="nf">disconnect_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dconnecte les signaux pour viter les doublons.&quot;&quot;&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_micmac</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_classic</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>            <span class="c1"># Si les signaux ne sont pas connects, ignorer les erreurs</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>            <span class="k">pass</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">get_image_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="sd">        Parcourt tous les fichiers dans le rpertoire spcifi et retourne une liste des chemins des fichiers image</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">        (avec les extensions .JPG, .PNG, .TIF), trie par ordre alphabtique des noms de fichiers,</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a><span class="sd">        en excluant ceux dont le nom se termine par &quot;_Masq&quot; ou &quot;_masq_merged&quot;.</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">        </span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">        :param directory: Le chemin du rpertoire  parcourir.</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">        :type directory: str</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="sd">        </span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">        :return: Liste des chemins de fichiers image trie par ordre alphabtique, avec exclusions.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="sd">        :rtype: list</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>        <span class="c1"># Vrifier si le rpertoire existe</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Le rpertoire spcifi n&#39;existe pas : </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>        <span class="c1"># Initialiser une liste pour les fichiers image</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>        <span class="n">image_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>        <span class="c1"># Extensions d&#39;image acceptes</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>        <span class="n">valid_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">]</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>        <span class="c1"># Parcourir les fichiers dans le rpertoire</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>            <span class="n">file_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>            <span class="c1"># Vrifier si c&#39;est un fichier et si l&#39;extension est valide</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">valid_extensions</span><span class="p">:</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>                <span class="c1"># Exclure les fichiers dont le nom se termine par &quot;_Masq.ext&quot; ou &quot;_masq_merged.ext&quot;</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_Masq&quot;</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_masq_merged&quot;</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">):</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>                    <span class="k">continue</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>                <span class="n">image_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>        <span class="c1"># Trier la liste par ordre alphabtique des noms de fichiers</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>        <span class="n">image_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>        <span class="k">return</span> <span class="n">image_files</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>    <span class="k">def</span> <span class="nf">get_merged_mask_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a><span class="sd">        Rcupre les fichiers d&#39;image dans un rpertoire qui se terminent par &quot;_masq_merged.png&quot;.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a><span class="sd">        </span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a><span class="sd">        :param directory: Le chemin du rpertoire  parcourir.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="sd">        :type directory: str</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a><span class="sd">        </span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a><span class="sd">        :return: Liste des chemins des fichiers image se terminant par &quot;_masq_merged.png&quot;.</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a><span class="sd">        :rtype: list</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>        <span class="c1"># Vrifier si le rpertoire existe</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Le rpertoire spcifi n&#39;existe pas : </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>        <span class="c1"># Initialiser une liste pour les fichiers image</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>        <span class="n">merged_mask_images</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>        <span class="c1"># Parcourir les fichiers dans le rpertoire</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>            <span class="c1"># Vrifier si c&#39;est un fichier et si le nom se termine par &quot;_masq_merged.png&quot;</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_masq_merged.png&quot;</span><span class="p">):</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>                <span class="n">merged_mask_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>        <span class="k">return</span> <span class="n">merged_mask_images</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run method that performs all the real work&quot;&quot;&quot;</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>        <span class="c1"># Create the dialog with elements (after translation) and keep reference</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>        <span class="c1"># Only create GUI ONCE in callback, so that it will only load when the plugin is started</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">PhotosequenceDialog</span><span class="p">()</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>        <span class="c1"># show the dialog</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset_dialog</span><span class="p">()</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>        <span class="c1">#permet d&#39;viter les doublons</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_signals</span><span class="p">()</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>        <span class="c1"># Connecter les boutons au fichier XML correspondant</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="p">,</span> <span class="s1">&#39;calibration&#39;</span><span class="p">))</span>  <span class="c1"># Bouton pour le fichier de calibration</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">))</span>  <span class="c1"># Bouton pour le fichier d&#39;orientation</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>        <span class="c1">#connecter les boutons pour les fichiers images</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesIMG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="p">))</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>        <span class="c1">#connecter les boutons pour les fichiers trajecto</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesGPKG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">))</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>        <span class="c1"># connecter le bouton repertoire de sortie</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseOutputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="p">))</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>        <span class="c1"># Run the dialog event loop</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>        <span class="c1"># See if OK was pressed</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>            <span class="n">calibration_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>            <span class="n">orientation_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>            <span class="n">image_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>            <span class="n">point_trajectory_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>            <span class="n">OutputDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>            <span class="n">epsg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">le_epsg</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">:</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">init_transformer</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>            <span class="c1"># Rcuperer les coordonnes de l&#39;aronef dans la BDD de la trajectoire en .gpkg</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>            <span class="n">posx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>            <span class="n">posy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>            <span class="n">posz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;alt_m&#39;</span><span class="p">)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>            <span class="n">posz_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;mnt_m&#39;</span><span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>            <span class="c1"># crer le projet QGIS</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>            <span class="n">project_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_projet_qgis</span><span class="p">(</span><span class="n">OutputDir</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>            <span class="c1"># gestion de la banque d&#39;image</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>            <span class="n">images_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">images_list</span><span class="p">)</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>            <span class="n">base_img</span> <span class="o">=</span> <span class="n">images_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>            <span class="n">base_img_lyr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_png_to_qgis_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">base_img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>            <span class="c1"># Zoom to first raster layer extent</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>            <span class="n">extent</span> <span class="o">=</span> <span class="n">base_img_lyr</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>            <span class="n">projection</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">base_img_lyr</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>                                                <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>                                                <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">())</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">setExtent</span><span class="p">(</span><span class="n">projection</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">extent</span><span class="p">))</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>            <span class="c1"># Gestion des masques</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>            <span class="c1"># Boucle permettant de fusionner les masque micmac des images aux images.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_list</span><span class="p">)):</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>                <span class="c1"># Charger l&#39;image en couleur et le masque</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>                <span class="n">path_in</span> <span class="o">=</span> <span class="n">images_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>                <span class="n">path_mask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_Masq.tif&quot;</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>                <span class="c1"># print(path_mask)</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>                <span class="n">image_color</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>                <span class="c1"># Vrifier que les dimensions correspondent</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a>                <span class="k">if</span> <span class="n">image_color</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Les dimensions de l&#39;image couleur et du masque ne correspondent pas.&quot;</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a>                <span class="c1"># Convertir le masque en 3 canaux pour l&#39;appliquer sur l&#39;image couleur</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>                <span class="n">mask_3channel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a>                <span class="c1"># Appliquer le masque  l&#39;image couleur</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">image_color</span><span class="p">,</span> <span class="n">mask_3channel</span><span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a>                <span class="c1"># Sauvegarder ou afficher le rsultat</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_masq_merged.png&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a>            <span class="c1"># Boucle permettant de fusionner les masque micmac des images aux images.</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a>            <span class="n">merged_mask_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_mask_images</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">merged_mask_list</span><span class="p">)):</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a>                <span class="c1"># Ajouter l&#39;image PNG au projet et rcuprer la couche</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>                <span class="n">transparence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a>                <span class="n">raster_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_png_to_qgis_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">merged_mask_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">transparence</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a>            <span class="c1"># ALGORITHME &quot;MAISON&quot;</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_classic</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos">894</span></a>                <span class="c1">#             Trajectoire de l&#39;avion</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos">895</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos">896</span></a>                <span class="c1"># Rcuprer les indices des valeurs non NULL et transformer les coordonnes en flottants</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos">897</span></a>                <span class="n">indices_posx_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">posx</span><span class="p">)</span> <span class="k">if</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos">898</span></a>                                         <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos">899</span></a>                <span class="n">indices_posy_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">posy</span><span class="p">)</span> <span class="k">if</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos">900</span></a>                                         <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos">901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos">902</span></a>                <span class="c1"># Permet de trier les valeurs de la BDD pour enlever les valeurs NULL et aussi transformer les coordonnes en flottant</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos">903</span></a>                <span class="n">posx_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posx</span> <span class="k">if</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos">904</span></a>                                 <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos">905</span></a>                <span class="n">posy_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posy</span> <span class="k">if</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos">906</span></a>                                 <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos">907</span></a>                <span class="n">posz_not_null</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos">908</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">)):</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos">909</span></a>                    <span class="n">posz_not_null</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posz</span><span class="p">[</span><span class="n">indices_posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos">910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos">911</span></a>                <span class="n">coord_XY_qgs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos">912</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">))):</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos">913</span></a>                    <span class="n">coord_XY_qgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">posy_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos">914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos">915</span></a>                <span class="n">coord_proj_air</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos">916</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos">917</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">coord_XY_qgs</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos">918</span></a>                    <span class="n">point_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos">919</span></a>                    <span class="n">coord_proj_air</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_proj</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">posz_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos">920</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos">921</span></a>                <span class="c1"># print(&quot;coord_proj_air: &quot;,coord_proj_air)</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos">922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos">923</span></a>                <span class="n">L_coord_image_air</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span> <span class="n">coord_proj_air</span><span class="p">,</span> <span class="n">base_img</span><span class="p">)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos">924</span></a>                <span class="c1"># print(&quot;L_coord_image_air: &quot;,L_coord_image_air)</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos">925</span></a>                <span class="c1"># self.creer_ligne(L_coord_image_air)</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos">926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos">927</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos">928</span></a>                <span class="c1">#             Trace au sol</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos">929</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos">930</span></a>                <span class="n">posz_not_null_tr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos">931</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">)):</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos">932</span></a>                    <span class="n">posz_not_null_tr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posz_tr</span><span class="p">[</span><span class="n">indices_posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos">933</span></a>
</span><span id="L-934"><a href="#L-934"><span class="linenos">934</span></a>                <span class="n">coord_proj_tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos">935</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos">936</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">coord_XY_qgs</span><span class="p">:</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos">937</span></a>                    <span class="n">point_proj_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos">938</span></a>                    <span class="n">coord_proj_tr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_proj_tr</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj_tr</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">posz_not_null_tr</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos">939</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos">940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos">941</span></a>                <span class="n">L_coord_image_tr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span> <span class="n">coord_proj_tr</span><span class="p">,</span> <span class="n">base_img</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos">942</span></a>                <span class="c1"># print(&quot;L_coord_image_tr: &quot;,L_coord_image_tr)</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos">943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos">944</span></a>                <span class="n">layer_polygone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_polygone</span><span class="p">(</span><span class="n">L_coord_image_tr</span><span class="p">,</span> <span class="n">L_coord_image_air</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos">945</span></a>
</span><span id="L-946"><a href="#L-946"><span class="linenos">946</span></a>                <span class="n">trajectory_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s2">&quot;trajecto_fictive&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos">947</span></a>                <span class="n">point_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_points</span><span class="p">(</span><span class="n">trajectory_layer</span><span class="p">,</span> <span class="n">OutputDir</span><span class="p">,</span> <span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos">948</span></a>                                                <span class="n">base_img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos">949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos">950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos">951</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos">952</span></a>            <span class="c1"># si MicMac est choisi</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos">953</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos">954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos">955</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_micmac</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos">956</span></a>                <span class="c1"># TODO</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos">957</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;oui&#39;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="Photosequence">
                            <input id="Photosequence-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Photosequence</span>:

                <label class="view-source-button" for="Photosequence-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence-25"><a href="#Photosequence-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">Photosequence</span><span class="p">:</span>
</span><span id="Photosequence-26"><a href="#Photosequence-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;QGIS Plugin Implementation.&quot;&quot;&quot;</span>
</span><span id="Photosequence-27"><a href="#Photosequence-27"><span class="linenos"> 27</span></a>
</span><span id="Photosequence-28"><a href="#Photosequence-28"><span class="linenos"> 28</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
</span><span id="Photosequence-29"><a href="#Photosequence-29"><span class="linenos"> 29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-30"><a href="#Photosequence-30"><span class="linenos"> 30</span></a><span class="sd">        Constructor.</span>
</span><span id="Photosequence-31"><a href="#Photosequence-31"><span class="linenos"> 31</span></a><span class="sd">        </span>
</span><span id="Photosequence-32"><a href="#Photosequence-32"><span class="linenos"> 32</span></a><span class="sd">        :param iface: An interface instance that will be passed to this class,</span>
</span><span id="Photosequence-33"><a href="#Photosequence-33"><span class="linenos"> 33</span></a><span class="sd">            which provides the hook by which you can manipulate the QGIS</span>
</span><span id="Photosequence-34"><a href="#Photosequence-34"><span class="linenos"> 34</span></a><span class="sd">            application at run time.</span>
</span><span id="Photosequence-35"><a href="#Photosequence-35"><span class="linenos"> 35</span></a><span class="sd">        :type iface: QgsInterface</span>
</span><span id="Photosequence-36"><a href="#Photosequence-36"><span class="linenos"> 36</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-37"><a href="#Photosequence-37"><span class="linenos"> 37</span></a>        <span class="c1"># Save reference to the QGIS interface</span>
</span><span id="Photosequence-38"><a href="#Photosequence-38"><span class="linenos"> 38</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>
</span><span id="Photosequence-39"><a href="#Photosequence-39"><span class="linenos"> 39</span></a>        <span class="c1"># initialize plugin directory</span>
</span><span id="Photosequence-40"><a href="#Photosequence-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</span><span id="Photosequence-41"><a href="#Photosequence-41"><span class="linenos"> 41</span></a>        <span class="c1"># initialize locale</span>
</span><span id="Photosequence-42"><a href="#Photosequence-42"><span class="linenos"> 42</span></a>        <span class="n">locale</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;locale/userLocale&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Photosequence-43"><a href="#Photosequence-43"><span class="linenos"> 43</span></a>        <span class="n">locale_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Photosequence-44"><a href="#Photosequence-44"><span class="linenos"> 44</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">,</span>
</span><span id="Photosequence-45"><a href="#Photosequence-45"><span class="linenos"> 45</span></a>            <span class="s1">&#39;i18n&#39;</span><span class="p">,</span>
</span><span id="Photosequence-46"><a href="#Photosequence-46"><span class="linenos"> 46</span></a>            <span class="s1">&#39;Photosequence_</span><span class="si">{}</span><span class="s1">.qm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locale</span><span class="p">))</span>
</span><span id="Photosequence-47"><a href="#Photosequence-47"><span class="linenos"> 47</span></a>
</span><span id="Photosequence-48"><a href="#Photosequence-48"><span class="linenos"> 48</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">locale_path</span><span class="p">):</span>
</span><span id="Photosequence-49"><a href="#Photosequence-49"><span class="linenos"> 49</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="n">QTranslator</span><span class="p">()</span>
</span><span id="Photosequence-50"><a href="#Photosequence-50"><span class="linenos"> 50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">locale_path</span><span class="p">)</span>
</span><span id="Photosequence-51"><a href="#Photosequence-51"><span class="linenos"> 51</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">)</span>
</span><span id="Photosequence-52"><a href="#Photosequence-52"><span class="linenos"> 52</span></a>
</span><span id="Photosequence-53"><a href="#Photosequence-53"><span class="linenos"> 53</span></a>        <span class="c1"># Declare instance attributes</span>
</span><span id="Photosequence-54"><a href="#Photosequence-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-55"><a href="#Photosequence-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;photosequence&#39;</span><span class="p">)</span>
</span><span id="Photosequence-56"><a href="#Photosequence-56"><span class="linenos"> 56</span></a>
</span><span id="Photosequence-57"><a href="#Photosequence-57"><span class="linenos"> 57</span></a>        <span class="c1"># Check if plugin was started the first time in current QGIS session</span>
</span><span id="Photosequence-58"><a href="#Photosequence-58"><span class="linenos"> 58</span></a>        <span class="c1"># Must be set in initGui() to survive plugin reloads</span>
</span><span id="Photosequence-59"><a href="#Photosequence-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Photosequence-60"><a href="#Photosequence-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Photosequence-61"><a href="#Photosequence-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Photosequence-62"><a href="#Photosequence-62"><span class="linenos"> 62</span></a>
</span><span id="Photosequence-63"><a href="#Photosequence-63"><span class="linenos"> 63</span></a>    <span class="k">def</span> <span class="nf">init_transformer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence-64"><a href="#Photosequence-64"><span class="linenos"> 64</span></a>        <span class="n">source_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
</span><span id="Photosequence-65"><a href="#Photosequence-65"><span class="linenos"> 65</span></a>        <span class="n">target_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-66"><a href="#Photosequence-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">source_crs</span><span class="p">,</span> <span class="n">target_crs</span><span class="p">,</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">())</span>
</span><span id="Photosequence-67"><a href="#Photosequence-67"><span class="linenos"> 67</span></a>
</span><span id="Photosequence-68"><a href="#Photosequence-68"><span class="linenos"> 68</span></a>    <span class="c1"># noinspection PyMethodMayBeStatic</span>
</span><span id="Photosequence-69"><a href="#Photosequence-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="Photosequence-70"><a href="#Photosequence-70"><span class="linenos"> 70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the translation for a string using Qt translation API.</span>
</span><span id="Photosequence-71"><a href="#Photosequence-71"><span class="linenos"> 71</span></a>
</span><span id="Photosequence-72"><a href="#Photosequence-72"><span class="linenos"> 72</span></a><span class="sd">        We implement this ourselves since we do not inherit QObject.</span>
</span><span id="Photosequence-73"><a href="#Photosequence-73"><span class="linenos"> 73</span></a>
</span><span id="Photosequence-74"><a href="#Photosequence-74"><span class="linenos"> 74</span></a><span class="sd">        :param message: String for translation.</span>
</span><span id="Photosequence-75"><a href="#Photosequence-75"><span class="linenos"> 75</span></a><span class="sd">        :type message: str, QString</span>
</span><span id="Photosequence-76"><a href="#Photosequence-76"><span class="linenos"> 76</span></a>
</span><span id="Photosequence-77"><a href="#Photosequence-77"><span class="linenos"> 77</span></a><span class="sd">        :returns: Translated version of message.</span>
</span><span id="Photosequence-78"><a href="#Photosequence-78"><span class="linenos"> 78</span></a><span class="sd">        :rtype: QString</span>
</span><span id="Photosequence-79"><a href="#Photosequence-79"><span class="linenos"> 79</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-80"><a href="#Photosequence-80"><span class="linenos"> 80</span></a>        <span class="c1"># noinspection PyTypeChecker,PyArgumentList,PyCallByClass</span>
</span><span id="Photosequence-81"><a href="#Photosequence-81"><span class="linenos"> 81</span></a>        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;Photosequence&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span id="Photosequence-82"><a href="#Photosequence-82"><span class="linenos"> 82</span></a>
</span><span id="Photosequence-83"><a href="#Photosequence-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="nf">add_action</span><span class="p">(</span>
</span><span id="Photosequence-84"><a href="#Photosequence-84"><span class="linenos"> 84</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Photosequence-85"><a href="#Photosequence-85"><span class="linenos"> 85</span></a>            <span class="n">icon_path</span><span class="p">,</span>
</span><span id="Photosequence-86"><a href="#Photosequence-86"><span class="linenos"> 86</span></a>            <span class="n">text</span><span class="p">,</span>
</span><span id="Photosequence-87"><a href="#Photosequence-87"><span class="linenos"> 87</span></a>            <span class="n">callback</span><span class="p">,</span>
</span><span id="Photosequence-88"><a href="#Photosequence-88"><span class="linenos"> 88</span></a>            <span class="n">enabled_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Photosequence-89"><a href="#Photosequence-89"><span class="linenos"> 89</span></a>            <span class="n">add_to_menu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Photosequence-90"><a href="#Photosequence-90"><span class="linenos"> 90</span></a>            <span class="n">add_to_toolbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Photosequence-91"><a href="#Photosequence-91"><span class="linenos"> 91</span></a>            <span class="n">status_tip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Photosequence-92"><a href="#Photosequence-92"><span class="linenos"> 92</span></a>            <span class="n">whats_this</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Photosequence-93"><a href="#Photosequence-93"><span class="linenos"> 93</span></a>            <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Photosequence-94"><a href="#Photosequence-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a toolbar icon to the toolbar.</span>
</span><span id="Photosequence-95"><a href="#Photosequence-95"><span class="linenos"> 95</span></a>
</span><span id="Photosequence-96"><a href="#Photosequence-96"><span class="linenos"> 96</span></a><span class="sd">        :param icon_path: Path to the icon for this action. Can be a resource</span>
</span><span id="Photosequence-97"><a href="#Photosequence-97"><span class="linenos"> 97</span></a><span class="sd">            path (e.g. &#39;:/plugins/foo/bar.png&#39;) or a normal file system path.</span>
</span><span id="Photosequence-98"><a href="#Photosequence-98"><span class="linenos"> 98</span></a><span class="sd">        :type icon_path: str</span>
</span><span id="Photosequence-99"><a href="#Photosequence-99"><span class="linenos"> 99</span></a>
</span><span id="Photosequence-100"><a href="#Photosequence-100"><span class="linenos">100</span></a><span class="sd">        :param text: Text that should be shown in menu items for this action.</span>
</span><span id="Photosequence-101"><a href="#Photosequence-101"><span class="linenos">101</span></a><span class="sd">        :type text: str</span>
</span><span id="Photosequence-102"><a href="#Photosequence-102"><span class="linenos">102</span></a>
</span><span id="Photosequence-103"><a href="#Photosequence-103"><span class="linenos">103</span></a><span class="sd">        :param callback: Function to be called when the action is triggered.</span>
</span><span id="Photosequence-104"><a href="#Photosequence-104"><span class="linenos">104</span></a><span class="sd">        :type callback: function</span>
</span><span id="Photosequence-105"><a href="#Photosequence-105"><span class="linenos">105</span></a>
</span><span id="Photosequence-106"><a href="#Photosequence-106"><span class="linenos">106</span></a><span class="sd">        :param enabled_flag: A flag indicating if the action should be enabled</span>
</span><span id="Photosequence-107"><a href="#Photosequence-107"><span class="linenos">107</span></a><span class="sd">            by default. Defaults to True.</span>
</span><span id="Photosequence-108"><a href="#Photosequence-108"><span class="linenos">108</span></a><span class="sd">        :type enabled_flag: bool</span>
</span><span id="Photosequence-109"><a href="#Photosequence-109"><span class="linenos">109</span></a>
</span><span id="Photosequence-110"><a href="#Photosequence-110"><span class="linenos">110</span></a><span class="sd">        :param add_to_menu: Flag indicating whether the action should also</span>
</span><span id="Photosequence-111"><a href="#Photosequence-111"><span class="linenos">111</span></a><span class="sd">            be added to the menu. Defaults to True.</span>
</span><span id="Photosequence-112"><a href="#Photosequence-112"><span class="linenos">112</span></a><span class="sd">        :type add_to_menu: bool</span>
</span><span id="Photosequence-113"><a href="#Photosequence-113"><span class="linenos">113</span></a>
</span><span id="Photosequence-114"><a href="#Photosequence-114"><span class="linenos">114</span></a><span class="sd">        :param add_to_toolbar: Flag indicating whether the action should also</span>
</span><span id="Photosequence-115"><a href="#Photosequence-115"><span class="linenos">115</span></a><span class="sd">            be added to the toolbar. Defaults to True.</span>
</span><span id="Photosequence-116"><a href="#Photosequence-116"><span class="linenos">116</span></a><span class="sd">        :type add_to_toolbar: bool</span>
</span><span id="Photosequence-117"><a href="#Photosequence-117"><span class="linenos">117</span></a>
</span><span id="Photosequence-118"><a href="#Photosequence-118"><span class="linenos">118</span></a><span class="sd">        :param status_tip: Optional text to show in a popup when mouse pointer</span>
</span><span id="Photosequence-119"><a href="#Photosequence-119"><span class="linenos">119</span></a><span class="sd">            hovers over the action.</span>
</span><span id="Photosequence-120"><a href="#Photosequence-120"><span class="linenos">120</span></a><span class="sd">        :type status_tip: str</span>
</span><span id="Photosequence-121"><a href="#Photosequence-121"><span class="linenos">121</span></a>
</span><span id="Photosequence-122"><a href="#Photosequence-122"><span class="linenos">122</span></a><span class="sd">        :param parent: Parent widget for the new action. Defaults None.</span>
</span><span id="Photosequence-123"><a href="#Photosequence-123"><span class="linenos">123</span></a><span class="sd">        :type parent: QWidget</span>
</span><span id="Photosequence-124"><a href="#Photosequence-124"><span class="linenos">124</span></a>
</span><span id="Photosequence-125"><a href="#Photosequence-125"><span class="linenos">125</span></a><span class="sd">        :param whats_this: Optional text to show in the status bar when the</span>
</span><span id="Photosequence-126"><a href="#Photosequence-126"><span class="linenos">126</span></a><span class="sd">            mouse pointer hovers over the action.</span>
</span><span id="Photosequence-127"><a href="#Photosequence-127"><span class="linenos">127</span></a>
</span><span id="Photosequence-128"><a href="#Photosequence-128"><span class="linenos">128</span></a><span class="sd">        :returns: The action that was created. Note that the action is also</span>
</span><span id="Photosequence-129"><a href="#Photosequence-129"><span class="linenos">129</span></a><span class="sd">            added to self.actions list.</span>
</span><span id="Photosequence-130"><a href="#Photosequence-130"><span class="linenos">130</span></a><span class="sd">        :rtype: QAction</span>
</span><span id="Photosequence-131"><a href="#Photosequence-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-132"><a href="#Photosequence-132"><span class="linenos">132</span></a>
</span><span id="Photosequence-133"><a href="#Photosequence-133"><span class="linenos">133</span></a>        <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
</span><span id="Photosequence-134"><a href="#Photosequence-134"><span class="linenos">134</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span id="Photosequence-135"><a href="#Photosequence-135"><span class="linenos">135</span></a>        <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</span><span id="Photosequence-136"><a href="#Photosequence-136"><span class="linenos">136</span></a>        <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled_flag</span><span class="p">)</span>
</span><span id="Photosequence-137"><a href="#Photosequence-137"><span class="linenos">137</span></a>
</span><span id="Photosequence-138"><a href="#Photosequence-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="n">status_tip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Photosequence-139"><a href="#Photosequence-139"><span class="linenos">139</span></a>            <span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">status_tip</span><span class="p">)</span>
</span><span id="Photosequence-140"><a href="#Photosequence-140"><span class="linenos">140</span></a>
</span><span id="Photosequence-141"><a href="#Photosequence-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">whats_this</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Photosequence-142"><a href="#Photosequence-142"><span class="linenos">142</span></a>            <span class="n">action</span><span class="o">.</span><span class="n">setWhatsThis</span><span class="p">(</span><span class="n">whats_this</span><span class="p">)</span>
</span><span id="Photosequence-143"><a href="#Photosequence-143"><span class="linenos">143</span></a>
</span><span id="Photosequence-144"><a href="#Photosequence-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">add_to_toolbar</span><span class="p">:</span>
</span><span id="Photosequence-145"><a href="#Photosequence-145"><span class="linenos">145</span></a>            <span class="c1"># Adds plugin icon to Plugins toolbar</span>
</span><span id="Photosequence-146"><a href="#Photosequence-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence-147"><a href="#Photosequence-147"><span class="linenos">147</span></a>
</span><span id="Photosequence-148"><a href="#Photosequence-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">add_to_menu</span><span class="p">:</span>
</span><span id="Photosequence-149"><a href="#Photosequence-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addPluginToMenu</span><span class="p">(</span>
</span><span id="Photosequence-150"><a href="#Photosequence-150"><span class="linenos">150</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span>
</span><span id="Photosequence-151"><a href="#Photosequence-151"><span class="linenos">151</span></a>                <span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence-152"><a href="#Photosequence-152"><span class="linenos">152</span></a>
</span><span id="Photosequence-153"><a href="#Photosequence-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence-154"><a href="#Photosequence-154"><span class="linenos">154</span></a>
</span><span id="Photosequence-155"><a href="#Photosequence-155"><span class="linenos">155</span></a>        <span class="k">return</span> <span class="n">action</span>
</span><span id="Photosequence-156"><a href="#Photosequence-156"><span class="linenos">156</span></a>
</span><span id="Photosequence-157"><a href="#Photosequence-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence-158"><a href="#Photosequence-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the menu entries and toolbar icons inside the QGIS GUI.&quot;&quot;&quot;</span>
</span><span id="Photosequence-159"><a href="#Photosequence-159"><span class="linenos">159</span></a>
</span><span id="Photosequence-160"><a href="#Photosequence-160"><span class="linenos">160</span></a>        <span class="n">icon_path</span> <span class="o">=</span> <span class="s1">&#39;:/plugins/photosequence/icon.png&#39;</span>
</span><span id="Photosequence-161"><a href="#Photosequence-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span>
</span><span id="Photosequence-162"><a href="#Photosequence-162"><span class="linenos">162</span></a>            <span class="n">icon_path</span><span class="p">,</span>
</span><span id="Photosequence-163"><a href="#Photosequence-163"><span class="linenos">163</span></a>            <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Photosquence&#39;</span><span class="p">),</span>
</span><span id="Photosequence-164"><a href="#Photosequence-164"><span class="linenos">164</span></a>            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
</span><span id="Photosequence-165"><a href="#Photosequence-165"><span class="linenos">165</span></a>            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
</span><span id="Photosequence-166"><a href="#Photosequence-166"><span class="linenos">166</span></a>
</span><span id="Photosequence-167"><a href="#Photosequence-167"><span class="linenos">167</span></a>        <span class="c1"># will be set False in run()</span>
</span><span id="Photosequence-168"><a href="#Photosequence-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Photosequence-169"><a href="#Photosequence-169"><span class="linenos">169</span></a>
</span><span id="Photosequence-170"><a href="#Photosequence-170"><span class="linenos">170</span></a>    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence-171"><a href="#Photosequence-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes the plugin menu item and icon from QGIS GUI.&quot;&quot;&quot;</span>
</span><span id="Photosequence-172"><a href="#Photosequence-172"><span class="linenos">172</span></a>        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Photosequence-173"><a href="#Photosequence-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removePluginMenu</span><span class="p">(</span>
</span><span id="Photosequence-174"><a href="#Photosequence-174"><span class="linenos">174</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;photosequence&#39;</span><span class="p">),</span>
</span><span id="Photosequence-175"><a href="#Photosequence-175"><span class="linenos">175</span></a>                <span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence-176"><a href="#Photosequence-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removeToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence-177"><a href="#Photosequence-177"><span class="linenos">177</span></a>
</span><span id="Photosequence-178"><a href="#Photosequence-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">,</span> <span class="n">file_type</span><span class="p">):</span>
</span><span id="Photosequence-179"><a href="#Photosequence-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;calibration&#39;</span><span class="p">:</span>
</span><span id="Photosequence-180"><a href="#Photosequence-180"><span class="linenos">180</span></a>            <span class="c1"># pour le fichier de calibration de al camra</span>
</span><span id="Photosequence-181"><a href="#Photosequence-181"><span class="linenos">181</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open Calibration File&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;XML files (*.xml)&#39;</span><span class="p">)</span>
</span><span id="Photosequence-182"><a href="#Photosequence-182"><span class="linenos">182</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence-183"><a href="#Photosequence-183"><span class="linenos">183</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-184"><a href="#Photosequence-184"><span class="linenos">184</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-185"><a href="#Photosequence-185"><span class="linenos">185</span></a>        <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span>
</span><span id="Photosequence-186"><a href="#Photosequence-186"><span class="linenos">186</span></a>            <span class="c1"># pour le fichier d&#39;orientation</span>
</span><span id="Photosequence-187"><a href="#Photosequence-187"><span class="linenos">187</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open Orientation File&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;XML files (*.xml)&#39;</span><span class="p">)</span>
</span><span id="Photosequence-188"><a href="#Photosequence-188"><span class="linenos">188</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence-189"><a href="#Photosequence-189"><span class="linenos">189</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-190"><a href="#Photosequence-190"><span class="linenos">190</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-191"><a href="#Photosequence-191"><span class="linenos">191</span></a>
</span><span id="Photosequence-192"><a href="#Photosequence-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesGPKG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">,</span> <span class="n">file_type</span><span class="p">):</span>
</span><span id="Photosequence-193"><a href="#Photosequence-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
</span><span id="Photosequence-194"><a href="#Photosequence-194"><span class="linenos">194</span></a>            <span class="c1"># pour le fichierde mise en place absolue de camra</span>
</span><span id="Photosequence-195"><a href="#Photosequence-195"><span class="linenos">195</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open line trajectory file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence-196"><a href="#Photosequence-196"><span class="linenos">196</span></a>                                                <span class="s1">&#39;GPKG files (*.gpkg)&#39;</span><span class="p">)</span>
</span><span id="Photosequence-197"><a href="#Photosequence-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence-198"><a href="#Photosequence-198"><span class="linenos">198</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-199"><a href="#Photosequence-199"><span class="linenos">199</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-200"><a href="#Photosequence-200"><span class="linenos">200</span></a>        <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
</span><span id="Photosequence-201"><a href="#Photosequence-201"><span class="linenos">201</span></a>            <span class="c1"># pour le fichier de calibration de al camra</span>
</span><span id="Photosequence-202"><a href="#Photosequence-202"><span class="linenos">202</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open point trajectory file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence-203"><a href="#Photosequence-203"><span class="linenos">203</span></a>                                                <span class="s1">&#39;GPKG files (*.gpkg)&#39;</span><span class="p">)</span>
</span><span id="Photosequence-204"><a href="#Photosequence-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence-205"><a href="#Photosequence-205"><span class="linenos">205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-206"><a href="#Photosequence-206"><span class="linenos">206</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence-207"><a href="#Photosequence-207"><span class="linenos">207</span></a>
</span><span id="Photosequence-208"><a href="#Photosequence-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesIMG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">):</span>
</span><span id="Photosequence-209"><a href="#Photosequence-209"><span class="linenos">209</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Select image(s) directory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence-210"><a href="#Photosequence-210"><span class="linenos">210</span></a>                                                     <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>
</span><span id="Photosequence-211"><a href="#Photosequence-211"><span class="linenos">211</span></a>        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
</span><span id="Photosequence-212"><a href="#Photosequence-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Photosequence-213"><a href="#Photosequence-213"><span class="linenos">213</span></a>            <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="Photosequence-214"><a href="#Photosequence-214"><span class="linenos">214</span></a>
</span><span id="Photosequence-215"><a href="#Photosequence-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="nf">BrowseOutputFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">):</span>
</span><span id="Photosequence-216"><a href="#Photosequence-216"><span class="linenos">216</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Select output directory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence-217"><a href="#Photosequence-217"><span class="linenos">217</span></a>                                                     <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>
</span><span id="Photosequence-218"><a href="#Photosequence-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
</span><span id="Photosequence-219"><a href="#Photosequence-219"><span class="linenos">219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Photosequence-220"><a href="#Photosequence-220"><span class="linenos">220</span></a>            <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="Photosequence-221"><a href="#Photosequence-221"><span class="linenos">221</span></a>
</span><span id="Photosequence-222"><a href="#Photosequence-222"><span class="linenos">222</span></a>    <span class="k">def</span> <span class="nf">add_png_to_qgis_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">,</span> <span class="n">png_path</span><span class="p">,</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">transparence</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Photosequence-223"><a href="#Photosequence-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-224"><a href="#Photosequence-224"><span class="linenos">224</span></a><span class="sd">        Ajoute une couche d&#39;image PNG  un projet QGIS existant et retourne la couche ajoute.</span>
</span><span id="Photosequence-225"><a href="#Photosequence-225"><span class="linenos">225</span></a><span class="sd">        Si &#39;transparence&#39; est True, applique la transparence sur la couche.</span>
</span><span id="Photosequence-226"><a href="#Photosequence-226"><span class="linenos">226</span></a><span class="sd">        </span>
</span><span id="Photosequence-227"><a href="#Photosequence-227"><span class="linenos">227</span></a><span class="sd">        :param project_path: Chemin du projet QGIS existant (.qgs ou .qgz).</span>
</span><span id="Photosequence-228"><a href="#Photosequence-228"><span class="linenos">228</span></a><span class="sd">        :param png_path: Chemin de l&#39;image PNG  ajouter comme couche raster.</span>
</span><span id="Photosequence-229"><a href="#Photosequence-229"><span class="linenos">229</span></a><span class="sd">        :param transparence: Boolen indiquant si la transparence doit tre applique (True ou False).</span>
</span><span id="Photosequence-230"><a href="#Photosequence-230"><span class="linenos">230</span></a><span class="sd">        :return: La couche raster ajoute au projet.</span>
</span><span id="Photosequence-231"><a href="#Photosequence-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-232"><a href="#Photosequence-232"><span class="linenos">232</span></a>        <span class="c1"># Charger le projet existant</span>
</span><span id="Photosequence-233"><a href="#Photosequence-233"><span class="linenos">233</span></a>        <span class="n">project</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
</span><span id="Photosequence-234"><a href="#Photosequence-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="Photosequence-235"><a href="#Photosequence-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de lire le projet QGIS : </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-236"><a href="#Photosequence-236"><span class="linenos">236</span></a>
</span><span id="Photosequence-237"><a href="#Photosequence-237"><span class="linenos">237</span></a>        <span class="c1"># Crer une couche raster  partir du PNG</span>
</span><span id="Photosequence-238"><a href="#Photosequence-238"><span class="linenos">238</span></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">png_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Nom de la couche bas sur le fichier</span>
</span><span id="Photosequence-239"><a href="#Photosequence-239"><span class="linenos">239</span></a>        <span class="n">raster_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">png_path</span><span class="p">,</span> <span class="n">layer_name</span><span class="p">)</span>
</span><span id="Photosequence-240"><a href="#Photosequence-240"><span class="linenos">240</span></a>
</span><span id="Photosequence-241"><a href="#Photosequence-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="Photosequence-242"><a href="#Photosequence-242"><span class="linenos">242</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : La couche raster base sur </span><span class="si">{</span><span class="n">png_path</span><span class="si">}</span><span class="s2"> n&#39;est pas valide.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-243"><a href="#Photosequence-243"><span class="linenos">243</span></a>
</span><span id="Photosequence-244"><a href="#Photosequence-244"><span class="linenos">244</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-245"><a href="#Photosequence-245"><span class="linenos">245</span></a>        <span class="n">raster_layer</span><span class="o">.</span><span class="n">setCrs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="Photosequence-246"><a href="#Photosequence-246"><span class="linenos">246</span></a>
</span><span id="Photosequence-247"><a href="#Photosequence-247"><span class="linenos">247</span></a>        <span class="c1"># Ajouter la couche raster au projet</span>
</span><span id="Photosequence-248"><a href="#Photosequence-248"><span class="linenos">248</span></a>        <span class="n">project</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">raster_layer</span><span class="p">)</span>
</span><span id="Photosequence-249"><a href="#Photosequence-249"><span class="linenos">249</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couche raster ajoute : </span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-250"><a href="#Photosequence-250"><span class="linenos">250</span></a>
</span><span id="Photosequence-251"><a href="#Photosequence-251"><span class="linenos">251</span></a>        <span class="c1"># Si transparence est active, appliquer la transparence  la couche</span>
</span><span id="Photosequence-252"><a href="#Photosequence-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">transparence</span><span class="p">:</span>
</span><span id="Photosequence-253"><a href="#Photosequence-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="n">raster_layer</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raster_layer</span><span class="p">,</span> <span class="n">QgsRasterLayer</span><span class="p">):</span>
</span><span id="Photosequence-254"><a href="#Photosequence-254"><span class="linenos">254</span></a>                <span class="n">transparency</span> <span class="o">=</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">rasterTransparency</span><span class="p">()</span>
</span><span id="Photosequence-255"><a href="#Photosequence-255"><span class="linenos">255</span></a>                <span class="n">transparent_pixel</span> <span class="o">=</span> <span class="n">QgsRasterTransparency</span><span class="o">.</span><span class="n">TransparentThreeValuePixel</span><span class="p">()</span>
</span><span id="Photosequence-256"><a href="#Photosequence-256"><span class="linenos">256</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">blue</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence-257"><a href="#Photosequence-257"><span class="linenos">257</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">green</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence-258"><a href="#Photosequence-258"><span class="linenos">258</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">red</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence-259"><a href="#Photosequence-259"><span class="linenos">259</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">percentTransparent</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Photosequence-260"><a href="#Photosequence-260"><span class="linenos">260</span></a>                <span class="n">transparency</span><span class="o">.</span><span class="n">setTransparentThreeValuePixelList</span><span class="p">([</span><span class="n">transparent_pixel</span><span class="p">])</span>
</span><span id="Photosequence-261"><a href="#Photosequence-261"><span class="linenos">261</span></a>
</span><span id="Photosequence-262"><a href="#Photosequence-262"><span class="linenos">262</span></a>                <span class="c1"># Rafrachir la couche pour que la transparence soit applique</span>
</span><span id="Photosequence-263"><a href="#Photosequence-263"><span class="linenos">263</span></a>                <span class="n">raster_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="Photosequence-264"><a href="#Photosequence-264"><span class="linenos">264</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transparence applique  la couche : </span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-265"><a href="#Photosequence-265"><span class="linenos">265</span></a>
</span><span id="Photosequence-266"><a href="#Photosequence-266"><span class="linenos">266</span></a>        <span class="c1"># Sauvegarder le projet</span>
</span><span id="Photosequence-267"><a href="#Photosequence-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="o">.</span><span class="n">write</span><span class="p">():</span>
</span><span id="Photosequence-268"><a href="#Photosequence-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Erreur lors de la sauvegarde du projet QGIS.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-269"><a href="#Photosequence-269"><span class="linenos">269</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projet sauvegard avec succs : </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-270"><a href="#Photosequence-270"><span class="linenos">270</span></a>
</span><span id="Photosequence-271"><a href="#Photosequence-271"><span class="linenos">271</span></a>        <span class="c1"># Retourner la couche ajoute</span>
</span><span id="Photosequence-272"><a href="#Photosequence-272"><span class="linenos">272</span></a>        <span class="k">return</span> <span class="n">raster_layer</span>
</span><span id="Photosequence-273"><a href="#Photosequence-273"><span class="linenos">273</span></a>
</span><span id="Photosequence-274"><a href="#Photosequence-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">get_attribute_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gpkg_path</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">):</span>
</span><span id="Photosequence-275"><a href="#Photosequence-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-276"><a href="#Photosequence-276"><span class="linenos">276</span></a><span class="sd">        Rcupre les valeurs d&#39;un attribut spcifique dans un fichier GeoPackage.</span>
</span><span id="Photosequence-277"><a href="#Photosequence-277"><span class="linenos">277</span></a><span class="sd">    </span>
</span><span id="Photosequence-278"><a href="#Photosequence-278"><span class="linenos">278</span></a><span class="sd">        :param gpkg_path: Chemin vers le fichier GeoPackage (.gpkg)</span>
</span><span id="Photosequence-279"><a href="#Photosequence-279"><span class="linenos">279</span></a><span class="sd">        :param attribute_name: Nom de l&#39;attribut  rcuprer</span>
</span><span id="Photosequence-280"><a href="#Photosequence-280"><span class="linenos">280</span></a><span class="sd">        :return: Liste des valeurs de l&#39;attribut</span>
</span><span id="Photosequence-281"><a href="#Photosequence-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-282"><a href="#Photosequence-282"><span class="linenos">282</span></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">gpkg_path</span><span class="p">,</span> <span class="s2">&quot;MyLayer&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
</span><span id="Photosequence-283"><a href="#Photosequence-283"><span class="linenos">283</span></a>
</span><span id="Photosequence-284"><a href="#Photosequence-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="Photosequence-285"><a href="#Photosequence-285"><span class="linenos">285</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de charger la couche GeoPackage : </span><span class="si">{</span><span class="n">gpkg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-286"><a href="#Photosequence-286"><span class="linenos">286</span></a>
</span><span id="Photosequence-287"><a href="#Photosequence-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="n">attribute_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
</span><span id="Photosequence-288"><a href="#Photosequence-288"><span class="linenos">288</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;attribut &#39;</span><span class="si">{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">&#39; n&#39;existe pas dans la couche.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-289"><a href="#Photosequence-289"><span class="linenos">289</span></a>
</span><span id="Photosequence-290"><a href="#Photosequence-290"><span class="linenos">290</span></a>        <span class="n">attribute_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()]</span>
</span><span id="Photosequence-291"><a href="#Photosequence-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">attribute_values</span><span class="p">)</span>
</span><span id="Photosequence-292"><a href="#Photosequence-292"><span class="linenos">292</span></a>
</span><span id="Photosequence-293"><a href="#Photosequence-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">list2pts3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">liste_coord</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="Photosequence-294"><a href="#Photosequence-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-295"><a href="#Photosequence-295"><span class="linenos">295</span></a><span class="sd">        Permet de transformer une liste de coordonnes en fichier XML pour MicMac.</span>
</span><span id="Photosequence-296"><a href="#Photosequence-296"><span class="linenos">296</span></a><span class="sd">        </span>
</span><span id="Photosequence-297"><a href="#Photosequence-297"><span class="linenos">297</span></a><span class="sd">        :param liste_coord: Liste de coordonnes x, y, z de taille (3, n), </span>
</span><span id="Photosequence-298"><a href="#Photosequence-298"><span class="linenos">298</span></a><span class="sd">                             par exemple : [[x1, x2, ...], [y1, y2, ...], [z1, z2, ...]].</span>
</span><span id="Photosequence-299"><a href="#Photosequence-299"><span class="linenos">299</span></a><span class="sd">        :param output_file: Chemin du fichier XML  gnrer.</span>
</span><span id="Photosequence-300"><a href="#Photosequence-300"><span class="linenos">300</span></a><span class="sd">        :return: Un fichier xml au format MicMac des points pour utiliser mm3d SimplePredict</span>
</span><span id="Photosequence-301"><a href="#Photosequence-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-302"><a href="#Photosequence-302"><span class="linenos">302</span></a>        <span class="c1"># Vrifier que la liste est dans le bon format</span>
</span><span id="Photosequence-303"><a href="#Photosequence-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">liste_coord</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">liste_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">liste_coord</span><span class="p">):</span>
</span><span id="Photosequence-304"><a href="#Photosequence-304"><span class="linenos">304</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Photosequence-305"><a href="#Photosequence-305"><span class="linenos">305</span></a>                <span class="s2">&quot;La liste des coordonnes doit tre au format [[x1, x2, ...], [y1, y2, ...], [z1, z2, ...]].&quot;</span><span class="p">)</span>
</span><span id="Photosequence-306"><a href="#Photosequence-306"><span class="linenos">306</span></a>
</span><span id="Photosequence-307"><a href="#Photosequence-307"><span class="linenos">307</span></a>        <span class="c1"># Crer l&#39;lment racine XML</span>
</span><span id="Photosequence-308"><a href="#Photosequence-308"><span class="linenos">308</span></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;DicoAppuisFlottant&quot;</span><span class="p">)</span>
</span><span id="Photosequence-309"><a href="#Photosequence-309"><span class="linenos">309</span></a>
</span><span id="Photosequence-310"><a href="#Photosequence-310"><span class="linenos">310</span></a>        <span class="c1"># Ajouter les coordonnes au fichier XML</span>
</span><span id="Photosequence-311"><a href="#Photosequence-311"><span class="linenos">311</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">liste_coord</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Photosequence-312"><a href="#Photosequence-312"><span class="linenos">312</span></a>            <span class="n">one_appuis_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;OneAppuisDAF&quot;</span><span class="p">)</span>
</span><span id="Photosequence-313"><a href="#Photosequence-313"><span class="linenos">313</span></a>
</span><span id="Photosequence-314"><a href="#Photosequence-314"><span class="linenos">314</span></a>            <span class="c1"># Ajouter l&#39;lment Pt avec les coordonnes x, y, z</span>
</span><span id="Photosequence-315"><a href="#Photosequence-315"><span class="linenos">315</span></a>            <span class="n">pt_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;Pt&quot;</span><span class="p">)</span>
</span><span id="Photosequence-316"><a href="#Photosequence-316"><span class="linenos">316</span></a>            <span class="n">pt_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Photosequence-317"><a href="#Photosequence-317"><span class="linenos">317</span></a>
</span><span id="Photosequence-318"><a href="#Photosequence-318"><span class="linenos">318</span></a>            <span class="c1"># Ajouter le nom du point (NamePt)</span>
</span><span id="Photosequence-319"><a href="#Photosequence-319"><span class="linenos">319</span></a>            <span class="n">name_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;NamePt&quot;</span><span class="p">)</span>
</span><span id="Photosequence-320"><a href="#Photosequence-320"><span class="linenos">320</span></a>            <span class="n">name_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Photosequence-321"><a href="#Photosequence-321"><span class="linenos">321</span></a>
</span><span id="Photosequence-322"><a href="#Photosequence-322"><span class="linenos">322</span></a>            <span class="c1"># Ajouter l&#39;incertitude</span>
</span><span id="Photosequence-323"><a href="#Photosequence-323"><span class="linenos">323</span></a>            <span class="n">incertitude_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;Incertitude&quot;</span><span class="p">)</span>
</span><span id="Photosequence-324"><a href="#Photosequence-324"><span class="linenos">324</span></a>            <span class="n">incertitude_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;1 1 1&quot;</span>
</span><span id="Photosequence-325"><a href="#Photosequence-325"><span class="linenos">325</span></a>
</span><span id="Photosequence-326"><a href="#Photosequence-326"><span class="linenos">326</span></a>        <span class="c1"># Crer l&#39;arbre XML et l&#39;crire dans le fichier</span>
</span><span id="Photosequence-327"><a href="#Photosequence-327"><span class="linenos">327</span></a>        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</span><span id="Photosequence-328"><a href="#Photosequence-328"><span class="linenos">328</span></a>        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Photosequence-329"><a href="#Photosequence-329"><span class="linenos">329</span></a>
</span><span id="Photosequence-330"><a href="#Photosequence-330"><span class="linenos">330</span></a>    <span class="k">def</span> <span class="nf">extract_rotation_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_filepath</span><span class="p">):</span>
</span><span id="Photosequence-331"><a href="#Photosequence-331"><span class="linenos">331</span></a>        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml_filepath</span><span class="p">)</span>
</span><span id="Photosequence-332"><a href="#Photosequence-332"><span class="linenos">332</span></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
</span><span id="Photosequence-333"><a href="#Photosequence-333"><span class="linenos">333</span></a>
</span><span id="Photosequence-334"><a href="#Photosequence-334"><span class="linenos">334</span></a>        <span class="c1"># Extraire la matrice de rotation qui est dans la balise externe</span>
</span><span id="Photosequence-335"><a href="#Photosequence-335"><span class="linenos">335</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-336"><a href="#Photosequence-336"><span class="linenos">336</span></a>        <span class="n">param_rotation</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//Externe/ParamRotation/CodageMatr&#39;</span><span class="p">)</span>
</span><span id="Photosequence-337"><a href="#Photosequence-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">param_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Photosequence-338"><a href="#Photosequence-338"><span class="linenos">338</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="Photosequence-339"><a href="#Photosequence-339"><span class="linenos">339</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="Photosequence-340"><a href="#Photosequence-340"><span class="linenos">340</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="Photosequence-341"><a href="#Photosequence-341"><span class="linenos">341</span></a>
</span><span id="Photosequence-342"><a href="#Photosequence-342"><span class="linenos">342</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">)</span>  <span class="c1"># Convertir en array (3, 3)</span>
</span><span id="Photosequence-343"><a href="#Photosequence-343"><span class="linenos">343</span></a>
</span><span id="Photosequence-344"><a href="#Photosequence-344"><span class="linenos">344</span></a>        <span class="c1"># Extraire le vecteur de translation (Centre)</span>
</span><span id="Photosequence-345"><a href="#Photosequence-345"><span class="linenos">345</span></a>        <span class="n">centre</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//Externe/Centre&#39;</span><span class="p">)</span>
</span><span id="Photosequence-346"><a href="#Photosequence-346"><span class="linenos">346</span></a>        <span class="n">translation_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Photosequence-347"><a href="#Photosequence-347"><span class="linenos">347</span></a>            <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">centre</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()))])</span> <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># Convertir en array (1, 3)</span>
</span><span id="Photosequence-348"><a href="#Photosequence-348"><span class="linenos">348</span></a>
</span><span id="Photosequence-349"><a href="#Photosequence-349"><span class="linenos">349</span></a>        <span class="k">return</span> <span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">translation_vector</span><span class="o">.</span><span class="n">T</span>
</span><span id="Photosequence-350"><a href="#Photosequence-350"><span class="linenos">350</span></a>
</span><span id="Photosequence-351"><a href="#Photosequence-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="nf">csv_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
</span><span id="Photosequence-352"><a href="#Photosequence-352"><span class="linenos">352</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Photosequence-353"><a href="#Photosequence-353"><span class="linenos">353</span></a>            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span><span id="Photosequence-354"><a href="#Photosequence-354"><span class="linenos">354</span></a>            <span class="c1"># On retourne le dictionnaire de la premire ligne</span>
</span><span id="Photosequence-355"><a href="#Photosequence-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</span><span id="Photosequence-356"><a href="#Photosequence-356"><span class="linenos">356</span></a>
</span><span id="Photosequence-357"><a href="#Photosequence-357"><span class="linenos">357</span></a>    <span class="k">def</span> <span class="nf">World2Camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
</span><span id="Photosequence-358"><a href="#Photosequence-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span>
</span><span id="Photosequence-359"><a href="#Photosequence-359"><span class="linenos">359</span></a>
</span><span id="Photosequence-360"><a href="#Photosequence-360"><span class="linenos">360</span></a>    <span class="k">def</span> <span class="nf">Cam2Bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt3d</span><span class="p">):</span>
</span><span id="Photosequence-361"><a href="#Photosequence-361"><span class="linenos">361</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">pt3d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence-362"><a href="#Photosequence-362"><span class="linenos">362</span></a>
</span><span id="Photosequence-363"><a href="#Photosequence-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">RadDistOnBundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
</span><span id="Photosequence-364"><a href="#Photosequence-364"><span class="linenos">364</span></a>        <span class="n">rho2</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="Photosequence-365"><a href="#Photosequence-365"><span class="linenos">365</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeffs</span><span class="p">))</span>
</span><span id="Photosequence-366"><a href="#Photosequence-366"><span class="linenos">366</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="p">),</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence-367"><a href="#Photosequence-367"><span class="linenos">367</span></a>
</span><span id="Photosequence-368"><a href="#Photosequence-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">Bundle2Pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">PP_x</span><span class="p">,</span> <span class="n">PP_y</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
</span><span id="Photosequence-369"><a href="#Photosequence-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">PP_x</span><span class="p">,</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">PP_y</span><span class="p">]</span>
</span><span id="Photosequence-370"><a href="#Photosequence-370"><span class="linenos">370</span></a>
</span><span id="Photosequence-371"><a href="#Photosequence-371"><span class="linenos">371</span></a>    <span class="k">def</span> <span class="nf">TransfoCoord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">TablCoord</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
</span><span id="Photosequence-372"><a href="#Photosequence-372"><span class="linenos">372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-373"><a href="#Photosequence-373"><span class="linenos">373</span></a><span class="sd">        Transforme des coordonnes 3D en coordonnes 2D dans une image en appliquant les tapes de la chane</span>
</span><span id="Photosequence-374"><a href="#Photosequence-374"><span class="linenos">374</span></a><span class="sd">        de calibration, de projection et de distorsion.</span>
</span><span id="Photosequence-375"><a href="#Photosequence-375"><span class="linenos">375</span></a><span class="sd">        </span>
</span><span id="Photosequence-376"><a href="#Photosequence-376"><span class="linenos">376</span></a><span class="sd">        Cette mthode prend un fichier de calibration (XML), une orientation (matrices de rotation et de translation),</span>
</span><span id="Photosequence-377"><a href="#Photosequence-377"><span class="linenos">377</span></a><span class="sd">        un tableau de coordonnes 3D, et une image pour produire une liste de points filtrs (en pixels) correspondant</span>
</span><span id="Photosequence-378"><a href="#Photosequence-378"><span class="linenos">378</span></a><span class="sd">        aux coordonnes projetes dans l&#39;image.</span>
</span><span id="Photosequence-379"><a href="#Photosequence-379"><span class="linenos">379</span></a><span class="sd">        </span>
</span><span id="Photosequence-380"><a href="#Photosequence-380"><span class="linenos">380</span></a><span class="sd">        :param calib: Chemin vers le fichier de calibration au format XML.</span>
</span><span id="Photosequence-381"><a href="#Photosequence-381"><span class="linenos">381</span></a><span class="sd">        :type calib: str</span>
</span><span id="Photosequence-382"><a href="#Photosequence-382"><span class="linenos">382</span></a><span class="sd">        :param orientation: Chemin vers le fichier contenant les matrices de rotation et de translation.</span>
</span><span id="Photosequence-383"><a href="#Photosequence-383"><span class="linenos">383</span></a><span class="sd">        :type orientation: str</span>
</span><span id="Photosequence-384"><a href="#Photosequence-384"><span class="linenos">384</span></a><span class="sd">        :param TablCoord: Tableau numpy contenant les coordonnes 3D  transformer (de forme Nx3).</span>
</span><span id="Photosequence-385"><a href="#Photosequence-385"><span class="linenos">385</span></a><span class="sd">        :type TablCoord: numpy.ndarray</span>
</span><span id="Photosequence-386"><a href="#Photosequence-386"><span class="linenos">386</span></a><span class="sd">        :param img: Chemin vers l&#39;image utilise pour filtrer les points en dehors des dimensions de l&#39;image.</span>
</span><span id="Photosequence-387"><a href="#Photosequence-387"><span class="linenos">387</span></a><span class="sd">        :type img: str</span>
</span><span id="Photosequence-388"><a href="#Photosequence-388"><span class="linenos">388</span></a><span class="sd">        </span>
</span><span id="Photosequence-389"><a href="#Photosequence-389"><span class="linenos">389</span></a><span class="sd">        :return: Un tuple contenant :</span>
</span><span id="Photosequence-390"><a href="#Photosequence-390"><span class="linenos">390</span></a><span class="sd">            - list: Liste des coordonnes 2D filtres (QgsPointXY) qui se trouvent  l&#39;intrieur des dimensions de l&#39;image.</span>
</span><span id="Photosequence-391"><a href="#Photosequence-391"><span class="linenos">391</span></a><span class="sd">            - list: Liste complte des coordonnes 2D projetes (incluant les outliers).</span>
</span><span id="Photosequence-392"><a href="#Photosequence-392"><span class="linenos">392</span></a><span class="sd">        :rtype: tuple</span>
</span><span id="Photosequence-393"><a href="#Photosequence-393"><span class="linenos">393</span></a><span class="sd">        </span>
</span><span id="Photosequence-394"><a href="#Photosequence-394"><span class="linenos">394</span></a><span class="sd">        :notes:</span>
</span><span id="Photosequence-395"><a href="#Photosequence-395"><span class="linenos">395</span></a><span class="sd">            - Les tapes de transformation incluent :</span>
</span><span id="Photosequence-396"><a href="#Photosequence-396"><span class="linenos">396</span></a><span class="sd">                1. Transformation du fichier de calibration XML en CSV.</span>
</span><span id="Photosequence-397"><a href="#Photosequence-397"><span class="linenos">397</span></a><span class="sd">                2. Extraction des matrices de rotation et du vecteur de translation.</span>
</span><span id="Photosequence-398"><a href="#Photosequence-398"><span class="linenos">398</span></a><span class="sd">                3. Application des distorsions radiales.</span>
</span><span id="Photosequence-399"><a href="#Photosequence-399"><span class="linenos">399</span></a><span class="sd">                4. Filtrage des points projets pour ne garder que ceux dans les limites de l&#39;image.</span>
</span><span id="Photosequence-400"><a href="#Photosequence-400"><span class="linenos">400</span></a><span class="sd">            - Les points hors des dimensions de l&#39;image sont exclus du rsultat final.</span>
</span><span id="Photosequence-401"><a href="#Photosequence-401"><span class="linenos">401</span></a><span class="sd">            - Les coordonnes retournes sont inverses en Y, pour correspondre au coordones image sur qgis.</span>
</span><span id="Photosequence-402"><a href="#Photosequence-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-403"><a href="#Photosequence-403"><span class="linenos">403</span></a>
</span><span id="Photosequence-404"><a href="#Photosequence-404"><span class="linenos">404</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 0 pour Incertitudes, 1 pour Angles</span>
</span><span id="Photosequence-405"><a href="#Photosequence-405"><span class="linenos">405</span></a>    
</span><span id="Photosequence-406"><a href="#Photosequence-406"><span class="linenos">406</span></a>        <span class="c1"># Convertir le fichier de calibration XML en CSV</span>
</span><span id="Photosequence-407"><a href="#Photosequence-407"><span class="linenos">407</span></a>        <span class="n">calib_converter</span> <span class="o">=</span> <span class="n">Calib2CSV</span><span class="p">(</span><span class="n">calib</span><span class="p">)</span>
</span><span id="Photosequence-408"><a href="#Photosequence-408"><span class="linenos">408</span></a>        <span class="n">calib_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>  <span class="c1"># Convertir le fichier XML en CSV</span>
</span><span id="Photosequence-409"><a href="#Photosequence-409"><span class="linenos">409</span></a>    
</span><span id="Photosequence-410"><a href="#Photosequence-410"><span class="linenos">410</span></a>        <span class="n">calib_camera_csv</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="Photosequence-411"><a href="#Photosequence-411"><span class="linenos">411</span></a>    
</span><span id="Photosequence-412"><a href="#Photosequence-412"><span class="linenos">412</span></a>        <span class="c1"># Dictionnaire des variables de calibrations</span>
</span><span id="Photosequence-413"><a href="#Photosequence-413"><span class="linenos">413</span></a>        <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_to_dict</span><span class="p">(</span><span class="n">calib_camera_csv</span><span class="p">)</span>
</span><span id="Photosequence-414"><a href="#Photosequence-414"><span class="linenos">414</span></a>    
</span><span id="Photosequence-415"><a href="#Photosequence-415"><span class="linenos">415</span></a>        <span class="n">R</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_rotation_translation</span><span class="p">(</span>
</span><span id="Photosequence-416"><a href="#Photosequence-416"><span class="linenos">416</span></a>            <span class="n">orientation</span><span class="p">)</span>  <span class="c1"># Rcupration des matrices de rotation et vecteurs de translation</span>
</span><span id="Photosequence-417"><a href="#Photosequence-417"><span class="linenos">417</span></a>        <span class="n">coeffs_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_1&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_2&#39;</span><span class="p">]),</span>
</span><span id="Photosequence-418"><a href="#Photosequence-418"><span class="linenos">418</span></a>                               <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_3&#39;</span><span class="p">])])</span>  <span class="c1"># Cration du vecteur K1, K2, K3</span>
</span><span id="Photosequence-419"><a href="#Photosequence-419"><span class="linenos">419</span></a>        <span class="n">coeffs_rad_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Photosequence-420"><a href="#Photosequence-420"><span class="linenos">420</span></a>            <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_1&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_2&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_3&#39;</span><span class="p">]),</span>
</span><span id="Photosequence-421"><a href="#Photosequence-421"><span class="linenos">421</span></a>             <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_4&#39;</span><span class="p">])])</span>
</span><span id="Photosequence-422"><a href="#Photosequence-422"><span class="linenos">422</span></a>    
</span><span id="Photosequence-423"><a href="#Photosequence-423"><span class="linenos">423</span></a>        <span class="n">L_Coord</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-424"><a href="#Photosequence-424"><span class="linenos">424</span></a>    
</span><span id="Photosequence-425"><a href="#Photosequence-425"><span class="linenos">425</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TablCoord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># Boucle sur tous les points  transformer</span>
</span><span id="Photosequence-426"><a href="#Photosequence-426"><span class="linenos">426</span></a>            <span class="c1"># World to camera frame</span>
</span><span id="Photosequence-427"><a href="#Photosequence-427"><span class="linenos">427</span></a>            <span class="n">ptCam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">World2Camera</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">TablCoord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># Reshape pour vecteurs</span>
</span><span id="Photosequence-428"><a href="#Photosequence-428"><span class="linenos">428</span></a>            <span class="c1"># Camera frame to bundle</span>
</span><span id="Photosequence-429"><a href="#Photosequence-429"><span class="linenos">429</span></a>            <span class="n">ptBun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cam2Bundle</span><span class="p">(</span><span class="n">ptCam</span><span class="p">)</span>
</span><span id="Photosequence-430"><a href="#Photosequence-430"><span class="linenos">430</span></a>            <span class="c1"># Application des distorsions radiales</span>
</span><span id="Photosequence-431"><a href="#Photosequence-431"><span class="linenos">431</span></a>            <span class="n">ptDist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadDistOnBundle</span><span class="p">(</span><span class="n">coeffs_rad</span><span class="p">,</span> <span class="n">ptBun</span><span class="p">)</span>
</span><span id="Photosequence-432"><a href="#Photosequence-432"><span class="linenos">432</span></a>            <span class="c1"># Bundle to pixel</span>
</span><span id="Photosequence-433"><a href="#Photosequence-433"><span class="linenos">433</span></a>            <span class="n">pt2Dproj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bundle2Pixel</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CDist_X&#39;</span><span class="p">]),</span>
</span><span id="Photosequence-434"><a href="#Photosequence-434"><span class="linenos">434</span></a>                                         <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CDist_Y&#39;</span><span class="p">]),</span> <span class="n">ptDist</span><span class="p">)</span>
</span><span id="Photosequence-435"><a href="#Photosequence-435"><span class="linenos">435</span></a>            <span class="n">L_Coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt2Dproj</span><span class="p">)</span>
</span><span id="Photosequence-436"><a href="#Photosequence-436"><span class="linenos">436</span></a>    
</span><span id="Photosequence-437"><a href="#Photosequence-437"><span class="linenos">437</span></a>        <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Photosequence-438"><a href="#Photosequence-438"><span class="linenos">438</span></a>        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence-439"><a href="#Photosequence-439"><span class="linenos">439</span></a>    
</span><span id="Photosequence-440"><a href="#Photosequence-440"><span class="linenos">440</span></a>        <span class="c1"># Filtrer les points pour ne garder que ceux dans les dimensions de l&#39;image</span>
</span><span id="Photosequence-441"><a href="#Photosequence-441"><span class="linenos">441</span></a>        <span class="n">coord_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">L_Coord</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">]</span>
</span><span id="Photosequence-442"><a href="#Photosequence-442"><span class="linenos">442</span></a>    
</span><span id="Photosequence-443"><a href="#Photosequence-443"><span class="linenos">443</span></a>        <span class="c1"># Traiter les coordonnes sans outliers</span>
</span><span id="Photosequence-444"><a href="#Photosequence-444"><span class="linenos">444</span></a>        <span class="n">coord_wo_outliers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-445"><a href="#Photosequence-445"><span class="linenos">445</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">)):</span>
</span><span id="Photosequence-446"><a href="#Photosequence-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">L_Coord</span><span class="p">[</span><span class="n">L_Coord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">coord_filtered</span><span class="p">):</span>
</span><span id="Photosequence-447"><a href="#Photosequence-447"><span class="linenos">447</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_Coord</span><span class="p">[</span><span class="n">L_Coord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Photosequence-448"><a href="#Photosequence-448"><span class="linenos">448</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Photosequence-449"><a href="#Photosequence-449"><span class="linenos">449</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Photosequence-450"><a href="#Photosequence-450"><span class="linenos">450</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Photosequence-451"><a href="#Photosequence-451"><span class="linenos">451</span></a>    
</span><span id="Photosequence-452"><a href="#Photosequence-452"><span class="linenos">452</span></a>        <span class="c1"># Transformation des coordonnes en QgsPointXY</span>
</span><span id="Photosequence-453"><a href="#Photosequence-453"><span class="linenos">453</span></a>        <span class="n">coord_XY</span> <span class="o">=</span> <span class="p">[</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_wo_outliers</span><span class="p">]</span>
</span><span id="Photosequence-454"><a href="#Photosequence-454"><span class="linenos">454</span></a>    
</span><span id="Photosequence-455"><a href="#Photosequence-455"><span class="linenos">455</span></a>        <span class="k">return</span> <span class="n">coord_XY</span><span class="p">,</span> <span class="n">L_Coord</span>
</span><span id="Photosequence-456"><a href="#Photosequence-456"><span class="linenos">456</span></a>
</span><span id="Photosequence-457"><a href="#Photosequence-457"><span class="linenos">457</span></a>
</span><span id="Photosequence-458"><a href="#Photosequence-458"><span class="linenos">458</span></a>    <span class="k">def</span> <span class="nf">execute_mm3d_simplepredict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence-459"><a href="#Photosequence-459"><span class="linenos">459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-460"><a href="#Photosequence-460"><span class="linenos">460</span></a><span class="sd">        Excute la commande MicMac `mm3d SimplePredict`.</span>
</span><span id="Photosequence-461"><a href="#Photosequence-461"><span class="linenos">461</span></a><span class="sd">        </span>
</span><span id="Photosequence-462"><a href="#Photosequence-462"><span class="linenos">462</span></a><span class="sd">        Commande excute : </span>
</span><span id="Photosequence-463"><a href="#Photosequence-463"><span class="linenos">463</span></a><span class="sd">            mm3d SimplePredict &quot;*.JPG&quot; Ori-Absolut/ Points3D.xml</span>
</span><span id="Photosequence-464"><a href="#Photosequence-464"><span class="linenos">464</span></a><span class="sd">        </span>
</span><span id="Photosequence-465"><a href="#Photosequence-465"><span class="linenos">465</span></a><span class="sd">        :return: La sortie standard de la commande si elle s&#39;excute avec succs, ou None si une erreur survient.</span>
</span><span id="Photosequence-466"><a href="#Photosequence-466"><span class="linenos">466</span></a><span class="sd">        :rtype: str | None</span>
</span><span id="Photosequence-467"><a href="#Photosequence-467"><span class="linenos">467</span></a><span class="sd">        </span>
</span><span id="Photosequence-468"><a href="#Photosequence-468"><span class="linenos">468</span></a><span class="sd">        :raises subprocess.CalledProcessError: Si la commande choue et que `check=True` est activ.</span>
</span><span id="Photosequence-469"><a href="#Photosequence-469"><span class="linenos">469</span></a><span class="sd">        </span>
</span><span id="Photosequence-470"><a href="#Photosequence-470"><span class="linenos">470</span></a><span class="sd">        :notes:</span>
</span><span id="Photosequence-471"><a href="#Photosequence-471"><span class="linenos">471</span></a><span class="sd">            - Les fichiers requis doivent tre prsents dans les rpertoires appropris pour que la commande aboutisse</span>
</span><span id="Photosequence-472"><a href="#Photosequence-472"><span class="linenos">472</span></a><span class="sd">              (images JPG, orientation absolue et fichier Points3D.xml).</span>
</span><span id="Photosequence-473"><a href="#Photosequence-473"><span class="linenos">473</span></a><span class="sd">            - Les logs sont crits dans la console de QGIS via `QgsMessageLog`.</span>
</span><span id="Photosequence-474"><a href="#Photosequence-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-475"><a href="#Photosequence-475"><span class="linenos">475</span></a>
</span><span id="Photosequence-476"><a href="#Photosequence-476"><span class="linenos">476</span></a>
</span><span id="Photosequence-477"><a href="#Photosequence-477"><span class="linenos">477</span></a>        <span class="c1"># commande micmac </span>
</span><span id="Photosequence-478"><a href="#Photosequence-478"><span class="linenos">478</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mm3d&#39;</span><span class="p">,</span> <span class="s1">&#39;SimplePredict&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;.*.JPG&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;Ori-Absolut/&#39;</span><span class="p">,</span> <span class="s1">&#39;Points3D.xml&#39;</span><span class="p">]</span>
</span><span id="Photosequence-479"><a href="#Photosequence-479"><span class="linenos">479</span></a>    
</span><span id="Photosequence-480"><a href="#Photosequence-480"><span class="linenos">480</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Photosequence-481"><a href="#Photosequence-481"><span class="linenos">481</span></a>            <span class="c1"># Excuter la commande et sauver la sortie</span>
</span><span id="Photosequence-482"><a href="#Photosequence-482"><span class="linenos">482</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Photosequence-483"><a href="#Photosequence-483"><span class="linenos">483</span></a>    
</span><span id="Photosequence-484"><a href="#Photosequence-484"><span class="linenos">484</span></a>            <span class="c1"># Log de la sortie standard</span>
</span><span id="Photosequence-485"><a href="#Photosequence-485"><span class="linenos">485</span></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</span><span id="Photosequence-486"><a href="#Photosequence-486"><span class="linenos">486</span></a>            <span class="n">QgsMessageLog</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Commande excute avec succs : </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;PhotosequenceGen&quot;</span><span class="p">,</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
</span><span id="Photosequence-487"><a href="#Photosequence-487"><span class="linenos">487</span></a>            <span class="k">return</span> <span class="n">output</span>
</span><span id="Photosequence-488"><a href="#Photosequence-488"><span class="linenos">488</span></a>        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Photosequence-489"><a href="#Photosequence-489"><span class="linenos">489</span></a>            <span class="c1"># Log en cas d&#39;erreur</span>
</span><span id="Photosequence-490"><a href="#Photosequence-490"><span class="linenos">490</span></a>            <span class="n">QgsMessageLog</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur lors de l&#39;excution : </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;PhotosequenceGen&quot;</span><span class="p">,</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
</span><span id="Photosequence-491"><a href="#Photosequence-491"><span class="linenos">491</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Photosequence-492"><a href="#Photosequence-492"><span class="linenos">492</span></a>
</span><span id="Photosequence-493"><a href="#Photosequence-493"><span class="linenos">493</span></a>
</span><span id="Photosequence-494"><a href="#Photosequence-494"><span class="linenos">494</span></a>    <span class="k">def</span> <span class="nf">creer_projet_qgis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputdir</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence-495"><a href="#Photosequence-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-496"><a href="#Photosequence-496"><span class="linenos">496</span></a><span class="sd">        Cre un projet QGIS  et retourne le chemin d&#39;accs au fichier cr.</span>
</span><span id="Photosequence-497"><a href="#Photosequence-497"><span class="linenos">497</span></a><span class="sd">    </span>
</span><span id="Photosequence-498"><a href="#Photosequence-498"><span class="linenos">498</span></a><span class="sd">        Parameters</span>
</span><span id="Photosequence-499"><a href="#Photosequence-499"><span class="linenos">499</span></a><span class="sd">        ----------</span>
</span><span id="Photosequence-500"><a href="#Photosequence-500"><span class="linenos">500</span></a><span class="sd">        self : instance</span>
</span><span id="Photosequence-501"><a href="#Photosequence-501"><span class="linenos">501</span></a><span class="sd">            Instance de la classe qui contient cette mthode.</span>
</span><span id="Photosequence-502"><a href="#Photosequence-502"><span class="linenos">502</span></a><span class="sd">        outputdir : str</span>
</span><span id="Photosequence-503"><a href="#Photosequence-503"><span class="linenos">503</span></a><span class="sd">            Chemin du rpertoire o le projet QGIS sera cr.</span>
</span><span id="Photosequence-504"><a href="#Photosequence-504"><span class="linenos">504</span></a><span class="sd">    </span>
</span><span id="Photosequence-505"><a href="#Photosequence-505"><span class="linenos">505</span></a><span class="sd">        Returns</span>
</span><span id="Photosequence-506"><a href="#Photosequence-506"><span class="linenos">506</span></a><span class="sd">        -------</span>
</span><span id="Photosequence-507"><a href="#Photosequence-507"><span class="linenos">507</span></a><span class="sd">        str</span>
</span><span id="Photosequence-508"><a href="#Photosequence-508"><span class="linenos">508</span></a><span class="sd">            Chemin complet du fichier projet QGIS cr, ou None en cas d&#39;erreur.</span>
</span><span id="Photosequence-509"><a href="#Photosequence-509"><span class="linenos">509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-510"><a href="#Photosequence-510"><span class="linenos">510</span></a>        <span class="c1"># Vrifier si le dossier de sortie existe</span>
</span><span id="Photosequence-511"><a href="#Photosequence-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputdir</span><span class="p">):</span>
</span><span id="Photosequence-512"><a href="#Photosequence-512"><span class="linenos">512</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : Le dossier </span><span class="si">{</span><span class="n">outputdir</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-513"><a href="#Photosequence-513"><span class="linenos">513</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Photosequence-514"><a href="#Photosequence-514"><span class="linenos">514</span></a>
</span><span id="Photosequence-515"><a href="#Photosequence-515"><span class="linenos">515</span></a>        <span class="c1"># Vrifier si le chemin est un rpertoire</span>
</span><span id="Photosequence-516"><a href="#Photosequence-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outputdir</span><span class="p">):</span>
</span><span id="Photosequence-517"><a href="#Photosequence-517"><span class="linenos">517</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : </span><span class="si">{</span><span class="n">outputdir</span><span class="si">}</span><span class="s2"> n&#39;est pas un rpertoire.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-518"><a href="#Photosequence-518"><span class="linenos">518</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Photosequence-519"><a href="#Photosequence-519"><span class="linenos">519</span></a>
</span><span id="Photosequence-520"><a href="#Photosequence-520"><span class="linenos">520</span></a>        <span class="c1"># Nom et chemin complet du fichier projet</span>
</span><span id="Photosequence-521"><a href="#Photosequence-521"><span class="linenos">521</span></a>        <span class="n">nom_projet</span> <span class="o">=</span> <span class="s2">&quot;photosequence.qgz&quot;</span>
</span><span id="Photosequence-522"><a href="#Photosequence-522"><span class="linenos">522</span></a>        <span class="n">chemin_projet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputdir</span><span class="p">,</span> <span class="n">nom_projet</span><span class="p">)</span>
</span><span id="Photosequence-523"><a href="#Photosequence-523"><span class="linenos">523</span></a>
</span><span id="Photosequence-524"><a href="#Photosequence-524"><span class="linenos">524</span></a>        <span class="c1"># Crer un projet QGIS vierge</span>
</span><span id="Photosequence-525"><a href="#Photosequence-525"><span class="linenos">525</span></a>        <span class="n">projet</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
</span><span id="Photosequence-526"><a href="#Photosequence-526"><span class="linenos">526</span></a>        <span class="n">projet</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Nettoyer le projet actuel pour garantir qu&#39;il est vierge</span>
</span><span id="Photosequence-527"><a href="#Photosequence-527"><span class="linenos">527</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-528"><a href="#Photosequence-528"><span class="linenos">528</span></a>        <span class="n">projet</span><span class="o">.</span><span class="n">setCrs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="Photosequence-529"><a href="#Photosequence-529"><span class="linenos">529</span></a>
</span><span id="Photosequence-530"><a href="#Photosequence-530"><span class="linenos">530</span></a>        <span class="c1"># Enregistrer le projet dans le rpertoire spcifi</span>
</span><span id="Photosequence-531"><a href="#Photosequence-531"><span class="linenos">531</span></a>        <span class="k">if</span> <span class="n">projet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chemin_projet</span><span class="p">):</span>
</span><span id="Photosequence-532"><a href="#Photosequence-532"><span class="linenos">532</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projet QGIS vierge cr avec succs : </span><span class="si">{</span><span class="n">chemin_projet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-533"><a href="#Photosequence-533"><span class="linenos">533</span></a>            <span class="k">return</span> <span class="n">chemin_projet</span>
</span><span id="Photosequence-534"><a href="#Photosequence-534"><span class="linenos">534</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Photosequence-535"><a href="#Photosequence-535"><span class="linenos">535</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : Impossible de crer le projet QGIS dans </span><span class="si">{</span><span class="n">chemin_projet</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-536"><a href="#Photosequence-536"><span class="linenos">536</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Photosequence-537"><a href="#Photosequence-537"><span class="linenos">537</span></a>
</span><span id="Photosequence-538"><a href="#Photosequence-538"><span class="linenos">538</span></a>    <span class="k">def</span> <span class="nf">creer_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory_file</span><span class="p">,</span> <span class="n">OutputDir</span><span class="p">,</span> <span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence-539"><a href="#Photosequence-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-540"><a href="#Photosequence-540"><span class="linenos">540</span></a><span class="sd">        Permet de crer une couche de points contenant les pinules et les labels de certains points de la trajectoire de l&#39;avion.</span>
</span><span id="Photosequence-541"><a href="#Photosequence-541"><span class="linenos">541</span></a><span class="sd">        </span>
</span><span id="Photosequence-542"><a href="#Photosequence-542"><span class="linenos">542</span></a><span class="sd">        :param trajectory_file: Couche vectorielle contenant les donnes de la trajectoire de vol avec des champs comme &#39;longitude&#39;, &#39;latitude&#39; et &#39;alt_m&#39;.</span>
</span><span id="Photosequence-543"><a href="#Photosequence-543"><span class="linenos">543</span></a><span class="sd">        :type trajectory_file: QgsVectorLayer</span>
</span><span id="Photosequence-544"><a href="#Photosequence-544"><span class="linenos">544</span></a><span class="sd">        :param OutputDir: Rpertoire de sortie o seront enregistres les donnes (non utilis dans cette fonction mais pass par convention).</span>
</span><span id="Photosequence-545"><a href="#Photosequence-545"><span class="linenos">545</span></a><span class="sd">        :type OutputDir: str</span>
</span><span id="Photosequence-546"><a href="#Photosequence-546"><span class="linenos">546</span></a><span class="sd">        :param calib: Chemin vers le fichier contenant les paramtres de calibration de la camra.</span>
</span><span id="Photosequence-547"><a href="#Photosequence-547"><span class="linenos">547</span></a><span class="sd">        :type calib: str</span>
</span><span id="Photosequence-548"><a href="#Photosequence-548"><span class="linenos">548</span></a><span class="sd">        :param orientation: Dictionnaire contenant les paramtres d&#39;orientation de la camra.</span>
</span><span id="Photosequence-549"><a href="#Photosequence-549"><span class="linenos">549</span></a><span class="sd">        :type orientation: dict</span>
</span><span id="Photosequence-550"><a href="#Photosequence-550"><span class="linenos">550</span></a><span class="sd">        :param img: Chemin du fichier image  utiliser pour la projection des points.</span>
</span><span id="Photosequence-551"><a href="#Photosequence-551"><span class="linenos">551</span></a><span class="sd">        :type img: str</span>
</span><span id="Photosequence-552"><a href="#Photosequence-552"><span class="linenos">552</span></a><span class="sd">        </span>
</span><span id="Photosequence-553"><a href="#Photosequence-553"><span class="linenos">553</span></a><span class="sd">        :return: Couche vectorielle contenant les points projets, ajoute au projet QGIS.</span>
</span><span id="Photosequence-554"><a href="#Photosequence-554"><span class="linenos">554</span></a><span class="sd">        :rtype: QgsVectorLayer</span>
</span><span id="Photosequence-555"><a href="#Photosequence-555"><span class="linenos">555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-556"><a href="#Photosequence-556"><span class="linenos">556</span></a>
</span><span id="Photosequence-557"><a href="#Photosequence-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">:</span>
</span><span id="Photosequence-558"><a href="#Photosequence-558"><span class="linenos">558</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_transformer</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence-559"><a href="#Photosequence-559"><span class="linenos">559</span></a>
</span><span id="Photosequence-560"><a href="#Photosequence-560"><span class="linenos">560</span></a>        <span class="c1"># Cration de la couche temporaire en mmoire</span>
</span><span id="Photosequence-561"><a href="#Photosequence-561"><span class="linenos">561</span></a>        <span class="n">point_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Point?crs=EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;points_photosequence&#39;</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span><span class="p">)</span>
</span><span id="Photosequence-562"><a href="#Photosequence-562"><span class="linenos">562</span></a>        <span class="n">provider</span> <span class="o">=</span> <span class="n">point_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
</span><span id="Photosequence-563"><a href="#Photosequence-563"><span class="linenos">563</span></a>
</span><span id="Photosequence-564"><a href="#Photosequence-564"><span class="linenos">564</span></a>        <span class="c1"># Ajout des champs provenant de la couche trajectory_file</span>
</span><span id="Photosequence-565"><a href="#Photosequence-565"><span class="linenos">565</span></a>        <span class="n">qgsfields</span> <span class="o">=</span> <span class="n">trajectory_file</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
</span><span id="Photosequence-566"><a href="#Photosequence-566"><span class="linenos">566</span></a>        <span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">(</span><span class="n">qgsfields</span><span class="p">)</span>
</span><span id="Photosequence-567"><a href="#Photosequence-567"><span class="linenos">567</span></a>        <span class="n">point_layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</span><span id="Photosequence-568"><a href="#Photosequence-568"><span class="linenos">568</span></a>
</span><span id="Photosequence-569"><a href="#Photosequence-569"><span class="linenos">569</span></a>        <span class="c1"># Boucle pour ajouter les points  la couche</span>
</span><span id="Photosequence-570"><a href="#Photosequence-570"><span class="linenos">570</span></a>        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">trajectory_file</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
</span><span id="Photosequence-571"><a href="#Photosequence-571"><span class="linenos">571</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Photosequence-572"><a href="#Photosequence-572"><span class="linenos">572</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Photosequence-573"><a href="#Photosequence-573"><span class="linenos">573</span></a>            <span class="n">altitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">]</span>
</span><span id="Photosequence-574"><a href="#Photosequence-574"><span class="linenos">574</span></a>
</span><span id="Photosequence-575"><a href="#Photosequence-575"><span class="linenos">575</span></a>            <span class="c1"># Transformation des coordonnes en systme RGF93</span>
</span><span id="Photosequence-576"><a href="#Photosequence-576"><span class="linenos">576</span></a>            <span class="n">point_wgs84</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
</span><span id="Photosequence-577"><a href="#Photosequence-577"><span class="linenos">577</span></a>            <span class="n">point_proj_wo_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point_wgs84</span><span class="p">)</span>
</span><span id="Photosequence-578"><a href="#Photosequence-578"><span class="linenos">578</span></a>            <span class="n">point_proj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">point_proj_wo_z</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj_wo_z</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">altitude</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Photosequence-579"><a href="#Photosequence-579"><span class="linenos">579</span></a>
</span><span id="Photosequence-580"><a href="#Photosequence-580"><span class="linenos">580</span></a>            <span class="c1"># Transformation en coordonnes d&#39;image</span>
</span><span id="Photosequence-581"><a href="#Photosequence-581"><span class="linenos">581</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">coord_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">point_proj</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="Photosequence-582"><a href="#Photosequence-582"><span class="linenos">582</span></a>
</span><span id="Photosequence-583"><a href="#Photosequence-583"><span class="linenos">583</span></a>            <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Photosequence-584"><a href="#Photosequence-584"><span class="linenos">584</span></a>            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence-585"><a href="#Photosequence-585"><span class="linenos">585</span></a>
</span><span id="Photosequence-586"><a href="#Photosequence-586"><span class="linenos">586</span></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">:</span>
</span><span id="Photosequence-587"><a href="#Photosequence-587"><span class="linenos">587</span></a>                <span class="c1"># Cration de l&#39;entit avec les coordonnes de l&#39;image</span>
</span><span id="Photosequence-588"><a href="#Photosequence-588"><span class="linenos">588</span></a>                <span class="n">new_feature</span> <span class="o">=</span> <span class="n">feature</span>
</span><span id="Photosequence-589"><a href="#Photosequence-589"><span class="linenos">589</span></a>                <span class="n">new_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Photosequence-590"><a href="#Photosequence-590"><span class="linenos">590</span></a>
</span><span id="Photosequence-591"><a href="#Photosequence-591"><span class="linenos">591</span></a>                <span class="c1"># Copie des attributs de trajecto_layer</span>
</span><span id="Photosequence-592"><a href="#Photosequence-592"><span class="linenos">592</span></a>                <span class="c1"># new_feature.setAttributes([feature[field.name()] for field in qgsfields])</span>
</span><span id="Photosequence-593"><a href="#Photosequence-593"><span class="linenos">593</span></a>
</span><span id="Photosequence-594"><a href="#Photosequence-594"><span class="linenos">594</span></a>                <span class="n">new_feature</span><span class="p">[</span><span class="s1">&#39;label_posx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span>
</span><span id="Photosequence-595"><a href="#Photosequence-595"><span class="linenos">595</span></a>                <span class="n">new_feature</span><span class="p">[</span><span class="s1">&#39;label_posy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span>
</span><span id="Photosequence-596"><a href="#Photosequence-596"><span class="linenos">596</span></a>
</span><span id="Photosequence-597"><a href="#Photosequence-597"><span class="linenos">597</span></a>                <span class="c1"># Ajout de l&#39;entit  la couche</span>
</span><span id="Photosequence-598"><a href="#Photosequence-598"><span class="linenos">598</span></a>                <span class="n">provider</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">new_feature</span><span class="p">)</span>
</span><span id="Photosequence-599"><a href="#Photosequence-599"><span class="linenos">599</span></a>
</span><span id="Photosequence-600"><a href="#Photosequence-600"><span class="linenos">600</span></a>        <span class="c1"># Application du style  la couche (si le fichier de style existe)</span>
</span><span id="Photosequence-601"><a href="#Photosequence-601"><span class="linenos">601</span></a>        <span class="n">style_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;style_bea.qml&quot;</span><span class="p">)</span>
</span><span id="Photosequence-602"><a href="#Photosequence-602"><span class="linenos">602</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">style_path</span><span class="p">):</span>
</span><span id="Photosequence-603"><a href="#Photosequence-603"><span class="linenos">603</span></a>            <span class="n">point_layer</span><span class="o">.</span><span class="n">loadNamedStyle</span><span class="p">(</span><span class="n">style_path</span><span class="p">)</span>
</span><span id="Photosequence-604"><a href="#Photosequence-604"><span class="linenos">604</span></a>            <span class="n">point_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="Photosequence-605"><a href="#Photosequence-605"><span class="linenos">605</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Photosequence-606"><a href="#Photosequence-606"><span class="linenos">606</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : le fichier de style </span><span class="si">{</span><span class="n">style_path</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-607"><a href="#Photosequence-607"><span class="linenos">607</span></a>
</span><span id="Photosequence-608"><a href="#Photosequence-608"><span class="linenos">608</span></a>        <span class="c1"># Ajouter la couche au projet QGIS</span>
</span><span id="Photosequence-609"><a href="#Photosequence-609"><span class="linenos">609</span></a>        <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">point_layer</span><span class="p">)</span>
</span><span id="Photosequence-610"><a href="#Photosequence-610"><span class="linenos">610</span></a>
</span><span id="Photosequence-611"><a href="#Photosequence-611"><span class="linenos">611</span></a>        <span class="c1"># Retourner la couche cre</span>
</span><span id="Photosequence-612"><a href="#Photosequence-612"><span class="linenos">612</span></a>        <span class="k">return</span> <span class="n">point_layer</span>
</span><span id="Photosequence-613"><a href="#Photosequence-613"><span class="linenos">613</span></a>
</span><span id="Photosequence-614"><a href="#Photosequence-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">creer_polygone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points_sol</span><span class="p">,</span> <span class="n">points_air</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence-615"><a href="#Photosequence-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-616"><a href="#Photosequence-616"><span class="linenos">616</span></a><span class="sd">        Permet de crer des polygones pour les points 2  2.</span>
</span><span id="Photosequence-617"><a href="#Photosequence-617"><span class="linenos">617</span></a><span class="sd">        </span>
</span><span id="Photosequence-618"><a href="#Photosequence-618"><span class="linenos">618</span></a><span class="sd">        Les polygones auront un contour rouge, et leur intrieur sera d&#39;un rouge plus clair. </span>
</span><span id="Photosequence-619"><a href="#Photosequence-619"><span class="linenos">619</span></a><span class="sd">        La table attributaire est remplie avec le numro du point et les coordonnes des points dans les airs.</span>
</span><span id="Photosequence-620"><a href="#Photosequence-620"><span class="linenos">620</span></a><span class="sd">        </span>
</span><span id="Photosequence-621"><a href="#Photosequence-621"><span class="linenos">621</span></a><span class="sd">        :param points_sol: Liste des positions de l&#39;avion au sol sous forme de QgsPointXY.</span>
</span><span id="Photosequence-622"><a href="#Photosequence-622"><span class="linenos">622</span></a><span class="sd">        :type points_sol: List[QgsPointXY]</span>
</span><span id="Photosequence-623"><a href="#Photosequence-623"><span class="linenos">623</span></a><span class="sd">        :param points_air: Liste des positions de la trace arienne de l&#39;avion sous forme de QgsPointXY.</span>
</span><span id="Photosequence-624"><a href="#Photosequence-624"><span class="linenos">624</span></a><span class="sd">        :type points_air: List[QgsPointXY]</span>
</span><span id="Photosequence-625"><a href="#Photosequence-625"><span class="linenos">625</span></a><span class="sd">        </span>
</span><span id="Photosequence-626"><a href="#Photosequence-626"><span class="linenos">626</span></a><span class="sd">        :return: Une couche de polygone</span>
</span><span id="Photosequence-627"><a href="#Photosequence-627"><span class="linenos">627</span></a><span class="sd">        :rtype: QgsVectorLayer</span>
</span><span id="Photosequence-628"><a href="#Photosequence-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-629"><a href="#Photosequence-629"><span class="linenos">629</span></a>
</span><span id="Photosequence-630"><a href="#Photosequence-630"><span class="linenos">630</span></a>        <span class="c1"># Crer une couche de polygones vide</span>
</span><span id="Photosequence-631"><a href="#Photosequence-631"><span class="linenos">631</span></a>        <span class="n">polygone_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Polygon?crs=EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Polygones&#39;</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span><span class="p">)</span>
</span><span id="Photosequence-632"><a href="#Photosequence-632"><span class="linenos">632</span></a>        <span class="n">provider</span> <span class="o">=</span> <span class="n">polygone_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
</span><span id="Photosequence-633"><a href="#Photosequence-633"><span class="linenos">633</span></a>
</span><span id="Photosequence-634"><a href="#Photosequence-634"><span class="linenos">634</span></a>        <span class="c1"># Ajouter les champs pour la table d&#39;attributs</span>
</span><span id="Photosequence-635"><a href="#Photosequence-635"><span class="linenos">635</span></a>        <span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span>
</span><span id="Photosequence-636"><a href="#Photosequence-636"><span class="linenos">636</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;num_point&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span>
</span><span id="Photosequence-637"><a href="#Photosequence-637"><span class="linenos">637</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;x_air1&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence-638"><a href="#Photosequence-638"><span class="linenos">638</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;y_air1&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence-639"><a href="#Photosequence-639"><span class="linenos">639</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;x_air2&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence-640"><a href="#Photosequence-640"><span class="linenos">640</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;y_air2&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence-641"><a href="#Photosequence-641"><span class="linenos">641</span></a>        <span class="p">])</span>
</span><span id="Photosequence-642"><a href="#Photosequence-642"><span class="linenos">642</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</span><span id="Photosequence-643"><a href="#Photosequence-643"><span class="linenos">643</span></a>
</span><span id="Photosequence-644"><a href="#Photosequence-644"><span class="linenos">644</span></a>        <span class="c1"># Ajouter les polygones pour chaque paire de points</span>
</span><span id="Photosequence-645"><a href="#Photosequence-645"><span class="linenos">645</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points_sol</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_air</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Photosequence-646"><a href="#Photosequence-646"><span class="linenos">646</span></a>            <span class="n">point_sol1</span> <span class="o">=</span> <span class="n">points_sol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Photosequence-647"><a href="#Photosequence-647"><span class="linenos">647</span></a>            <span class="n">point_sol2</span> <span class="o">=</span> <span class="n">points_sol</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence-648"><a href="#Photosequence-648"><span class="linenos">648</span></a>            <span class="n">point_air1</span> <span class="o">=</span> <span class="n">points_air</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Photosequence-649"><a href="#Photosequence-649"><span class="linenos">649</span></a>            <span class="n">point_air2</span> <span class="o">=</span> <span class="n">points_air</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence-650"><a href="#Photosequence-650"><span class="linenos">650</span></a>
</span><span id="Photosequence-651"><a href="#Photosequence-651"><span class="linenos">651</span></a>            <span class="c1"># Crer le polygone</span>
</span><span id="Photosequence-652"><a href="#Photosequence-652"><span class="linenos">652</span></a>            <span class="n">polygone</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPolygonXY</span><span class="p">([</span>
</span><span id="Photosequence-653"><a href="#Photosequence-653"><span class="linenos">653</span></a>                <span class="p">[</span><span class="n">point_sol1</span><span class="p">,</span> <span class="n">point_air1</span><span class="p">,</span> <span class="n">point_air2</span><span class="p">,</span> <span class="n">point_sol2</span><span class="p">]</span>
</span><span id="Photosequence-654"><a href="#Photosequence-654"><span class="linenos">654</span></a>            <span class="p">])</span>
</span><span id="Photosequence-655"><a href="#Photosequence-655"><span class="linenos">655</span></a>
</span><span id="Photosequence-656"><a href="#Photosequence-656"><span class="linenos">656</span></a>            <span class="c1"># Crer une entit avec les attributs</span>
</span><span id="Photosequence-657"><a href="#Photosequence-657"><span class="linenos">657</span></a>            <span class="n">feature</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
</span><span id="Photosequence-658"><a href="#Photosequence-658"><span class="linenos">658</span></a>            <span class="n">feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">polygone</span><span class="p">)</span>
</span><span id="Photosequence-659"><a href="#Photosequence-659"><span class="linenos">659</span></a>            <span class="n">feature</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span>
</span><span id="Photosequence-660"><a href="#Photosequence-660"><span class="linenos">660</span></a>                <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Numro du point</span>
</span><span id="Photosequence-661"><a href="#Photosequence-661"><span class="linenos">661</span></a>                <span class="n">point_air1</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_air1</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span>  <span class="c1"># Coordonnes du premier point arien</span>
</span><span id="Photosequence-662"><a href="#Photosequence-662"><span class="linenos">662</span></a>                <span class="n">point_air2</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_air2</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>  <span class="c1"># Coordonnes du deuxime point arien</span>
</span><span id="Photosequence-663"><a href="#Photosequence-663"><span class="linenos">663</span></a>            <span class="p">])</span>
</span><span id="Photosequence-664"><a href="#Photosequence-664"><span class="linenos">664</span></a>            <span class="n">provider</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="Photosequence-665"><a href="#Photosequence-665"><span class="linenos">665</span></a>
</span><span id="Photosequence-666"><a href="#Photosequence-666"><span class="linenos">666</span></a>        <span class="n">chemin_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</span><span id="Photosequence-667"><a href="#Photosequence-667"><span class="linenos">667</span></a>        <span class="n">repertoire_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">chemin_script</span><span class="p">)</span>
</span><span id="Photosequence-668"><a href="#Photosequence-668"><span class="linenos">668</span></a>        <span class="n">style_path</span> <span class="o">=</span> <span class="n">repertoire_script</span> <span class="o">+</span> <span class="s1">&#39;/Polygones.qml&#39;</span>
</span><span id="Photosequence-669"><a href="#Photosequence-669"><span class="linenos">669</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">style_path</span><span class="p">):</span>
</span><span id="Photosequence-670"><a href="#Photosequence-670"><span class="linenos">670</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : le fichier de style </span><span class="si">{</span><span class="n">style_path</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-671"><a href="#Photosequence-671"><span class="linenos">671</span></a>
</span><span id="Photosequence-672"><a href="#Photosequence-672"><span class="linenos">672</span></a>            <span class="k">return</span>
</span><span id="Photosequence-673"><a href="#Photosequence-673"><span class="linenos">673</span></a>
</span><span id="Photosequence-674"><a href="#Photosequence-674"><span class="linenos">674</span></a>        <span class="c1"># Charger le style .qml</span>
</span><span id="Photosequence-675"><a href="#Photosequence-675"><span class="linenos">675</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">loadNamedStyle</span><span class="p">(</span><span class="n">style_path</span><span class="p">)</span>
</span><span id="Photosequence-676"><a href="#Photosequence-676"><span class="linenos">676</span></a>
</span><span id="Photosequence-677"><a href="#Photosequence-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">polygone_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="Photosequence-678"><a href="#Photosequence-678"><span class="linenos">678</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erreur : le style n&#39;a pas pu tre appliqu.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-679"><a href="#Photosequence-679"><span class="linenos">679</span></a>            <span class="k">return</span>
</span><span id="Photosequence-680"><a href="#Photosequence-680"><span class="linenos">680</span></a>
</span><span id="Photosequence-681"><a href="#Photosequence-681"><span class="linenos">681</span></a>        <span class="c1"># Appliquer le style et redessiner la couche</span>
</span><span id="Photosequence-682"><a href="#Photosequence-682"><span class="linenos">682</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="Photosequence-683"><a href="#Photosequence-683"><span class="linenos">683</span></a>
</span><span id="Photosequence-684"><a href="#Photosequence-684"><span class="linenos">684</span></a>        <span class="c1"># Confirmer que le style a t appliqu</span>
</span><span id="Photosequence-685"><a href="#Photosequence-685"><span class="linenos">685</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Style appliqu avec succs.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-686"><a href="#Photosequence-686"><span class="linenos">686</span></a>
</span><span id="Photosequence-687"><a href="#Photosequence-687"><span class="linenos">687</span></a>        <span class="c1"># Ajouter la couche au projet</span>
</span><span id="Photosequence-688"><a href="#Photosequence-688"><span class="linenos">688</span></a>        <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">polygone_layer</span><span class="p">)</span>
</span><span id="Photosequence-689"><a href="#Photosequence-689"><span class="linenos">689</span></a>
</span><span id="Photosequence-690"><a href="#Photosequence-690"><span class="linenos">690</span></a>        <span class="c1"># Retourner la couche cre</span>
</span><span id="Photosequence-691"><a href="#Photosequence-691"><span class="linenos">691</span></a>        <span class="k">return</span> <span class="n">polygone_layer</span>
</span><span id="Photosequence-692"><a href="#Photosequence-692"><span class="linenos">692</span></a>
</span><span id="Photosequence-693"><a href="#Photosequence-693"><span class="linenos">693</span></a>    <span class="k">def</span> <span class="nf">reset_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence-694"><a href="#Photosequence-694"><span class="linenos">694</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rinitialise les champs de la bote de dialogue.&quot;&quot;&quot;</span>
</span><span id="Photosequence-695"><a href="#Photosequence-695"><span class="linenos">695</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier de calibration</span>
</span><span id="Photosequence-696"><a href="#Photosequence-696"><span class="linenos">696</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier d&#39;orientation</span>
</span><span id="Photosequence-697"><a href="#Photosequence-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier image</span>
</span><span id="Photosequence-698"><a href="#Photosequence-698"><span class="linenos">698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser la trajectoire des points</span>
</span><span id="Photosequence-699"><a href="#Photosequence-699"><span class="linenos">699</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le rpertoire de sortie</span>
</span><span id="Photosequence-700"><a href="#Photosequence-700"><span class="linenos">700</span></a>
</span><span id="Photosequence-701"><a href="#Photosequence-701"><span class="linenos">701</span></a>    <span class="k">def</span> <span class="nf">disconnect_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence-702"><a href="#Photosequence-702"><span class="linenos">702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dconnecte les signaux pour viter les doublons.&quot;&quot;&quot;</span>
</span><span id="Photosequence-703"><a href="#Photosequence-703"><span class="linenos">703</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Photosequence-704"><a href="#Photosequence-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence-705"><a href="#Photosequence-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence-706"><a href="#Photosequence-706"><span class="linenos">706</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence-707"><a href="#Photosequence-707"><span class="linenos">707</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence-708"><a href="#Photosequence-708"><span class="linenos">708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence-709"><a href="#Photosequence-709"><span class="linenos">709</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_micmac</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence-710"><a href="#Photosequence-710"><span class="linenos">710</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_classic</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence-711"><a href="#Photosequence-711"><span class="linenos">711</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="Photosequence-712"><a href="#Photosequence-712"><span class="linenos">712</span></a>            <span class="c1"># Si les signaux ne sont pas connects, ignorer les erreurs</span>
</span><span id="Photosequence-713"><a href="#Photosequence-713"><span class="linenos">713</span></a>            <span class="k">pass</span>
</span><span id="Photosequence-714"><a href="#Photosequence-714"><span class="linenos">714</span></a>
</span><span id="Photosequence-715"><a href="#Photosequence-715"><span class="linenos">715</span></a>    <span class="k">def</span> <span class="nf">get_image_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence-716"><a href="#Photosequence-716"><span class="linenos">716</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-717"><a href="#Photosequence-717"><span class="linenos">717</span></a><span class="sd">        Parcourt tous les fichiers dans le rpertoire spcifi et retourne une liste des chemins des fichiers image</span>
</span><span id="Photosequence-718"><a href="#Photosequence-718"><span class="linenos">718</span></a><span class="sd">        (avec les extensions .JPG, .PNG, .TIF), trie par ordre alphabtique des noms de fichiers,</span>
</span><span id="Photosequence-719"><a href="#Photosequence-719"><span class="linenos">719</span></a><span class="sd">        en excluant ceux dont le nom se termine par &quot;_Masq&quot; ou &quot;_masq_merged&quot;.</span>
</span><span id="Photosequence-720"><a href="#Photosequence-720"><span class="linenos">720</span></a><span class="sd">        </span>
</span><span id="Photosequence-721"><a href="#Photosequence-721"><span class="linenos">721</span></a><span class="sd">        :param directory: Le chemin du rpertoire  parcourir.</span>
</span><span id="Photosequence-722"><a href="#Photosequence-722"><span class="linenos">722</span></a><span class="sd">        :type directory: str</span>
</span><span id="Photosequence-723"><a href="#Photosequence-723"><span class="linenos">723</span></a><span class="sd">        </span>
</span><span id="Photosequence-724"><a href="#Photosequence-724"><span class="linenos">724</span></a><span class="sd">        :return: Liste des chemins de fichiers image trie par ordre alphabtique, avec exclusions.</span>
</span><span id="Photosequence-725"><a href="#Photosequence-725"><span class="linenos">725</span></a><span class="sd">        :rtype: list</span>
</span><span id="Photosequence-726"><a href="#Photosequence-726"><span class="linenos">726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-727"><a href="#Photosequence-727"><span class="linenos">727</span></a>
</span><span id="Photosequence-728"><a href="#Photosequence-728"><span class="linenos">728</span></a>        <span class="c1"># Vrifier si le rpertoire existe</span>
</span><span id="Photosequence-729"><a href="#Photosequence-729"><span class="linenos">729</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence-730"><a href="#Photosequence-730"><span class="linenos">730</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Le rpertoire spcifi n&#39;existe pas : </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-731"><a href="#Photosequence-731"><span class="linenos">731</span></a>
</span><span id="Photosequence-732"><a href="#Photosequence-732"><span class="linenos">732</span></a>        <span class="c1"># Initialiser une liste pour les fichiers image</span>
</span><span id="Photosequence-733"><a href="#Photosequence-733"><span class="linenos">733</span></a>        <span class="n">image_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-734"><a href="#Photosequence-734"><span class="linenos">734</span></a>
</span><span id="Photosequence-735"><a href="#Photosequence-735"><span class="linenos">735</span></a>        <span class="c1"># Extensions d&#39;image acceptes</span>
</span><span id="Photosequence-736"><a href="#Photosequence-736"><span class="linenos">736</span></a>        <span class="n">valid_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">]</span>
</span><span id="Photosequence-737"><a href="#Photosequence-737"><span class="linenos">737</span></a>
</span><span id="Photosequence-738"><a href="#Photosequence-738"><span class="linenos">738</span></a>        <span class="c1"># Parcourir les fichiers dans le rpertoire</span>
</span><span id="Photosequence-739"><a href="#Photosequence-739"><span class="linenos">739</span></a>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence-740"><a href="#Photosequence-740"><span class="linenos">740</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="Photosequence-741"><a href="#Photosequence-741"><span class="linenos">741</span></a>            <span class="n">file_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence-742"><a href="#Photosequence-742"><span class="linenos">742</span></a>
</span><span id="Photosequence-743"><a href="#Photosequence-743"><span class="linenos">743</span></a>            <span class="c1"># Vrifier si c&#39;est un fichier et si l&#39;extension est valide</span>
</span><span id="Photosequence-744"><a href="#Photosequence-744"><span class="linenos">744</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">valid_extensions</span><span class="p">:</span>
</span><span id="Photosequence-745"><a href="#Photosequence-745"><span class="linenos">745</span></a>                <span class="c1"># Exclure les fichiers dont le nom se termine par &quot;_Masq.ext&quot; ou &quot;_masq_merged.ext&quot;</span>
</span><span id="Photosequence-746"><a href="#Photosequence-746"><span class="linenos">746</span></a>                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_Masq&quot;</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_masq_merged&quot;</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">):</span>
</span><span id="Photosequence-747"><a href="#Photosequence-747"><span class="linenos">747</span></a>                    <span class="k">continue</span>
</span><span id="Photosequence-748"><a href="#Photosequence-748"><span class="linenos">748</span></a>                <span class="n">image_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="Photosequence-749"><a href="#Photosequence-749"><span class="linenos">749</span></a>
</span><span id="Photosequence-750"><a href="#Photosequence-750"><span class="linenos">750</span></a>        <span class="c1"># Trier la liste par ordre alphabtique des noms de fichiers</span>
</span><span id="Photosequence-751"><a href="#Photosequence-751"><span class="linenos">751</span></a>        <span class="n">image_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="Photosequence-752"><a href="#Photosequence-752"><span class="linenos">752</span></a>
</span><span id="Photosequence-753"><a href="#Photosequence-753"><span class="linenos">753</span></a>        <span class="k">return</span> <span class="n">image_files</span>
</span><span id="Photosequence-754"><a href="#Photosequence-754"><span class="linenos">754</span></a>
</span><span id="Photosequence-755"><a href="#Photosequence-755"><span class="linenos">755</span></a>    <span class="k">def</span> <span class="nf">get_merged_mask_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence-756"><a href="#Photosequence-756"><span class="linenos">756</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence-757"><a href="#Photosequence-757"><span class="linenos">757</span></a><span class="sd">        Rcupre les fichiers d&#39;image dans un rpertoire qui se terminent par &quot;_masq_merged.png&quot;.</span>
</span><span id="Photosequence-758"><a href="#Photosequence-758"><span class="linenos">758</span></a><span class="sd">        </span>
</span><span id="Photosequence-759"><a href="#Photosequence-759"><span class="linenos">759</span></a><span class="sd">        :param directory: Le chemin du rpertoire  parcourir.</span>
</span><span id="Photosequence-760"><a href="#Photosequence-760"><span class="linenos">760</span></a><span class="sd">        :type directory: str</span>
</span><span id="Photosequence-761"><a href="#Photosequence-761"><span class="linenos">761</span></a><span class="sd">        </span>
</span><span id="Photosequence-762"><a href="#Photosequence-762"><span class="linenos">762</span></a><span class="sd">        :return: Liste des chemins des fichiers image se terminant par &quot;_masq_merged.png&quot;.</span>
</span><span id="Photosequence-763"><a href="#Photosequence-763"><span class="linenos">763</span></a><span class="sd">        :rtype: list</span>
</span><span id="Photosequence-764"><a href="#Photosequence-764"><span class="linenos">764</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence-765"><a href="#Photosequence-765"><span class="linenos">765</span></a>
</span><span id="Photosequence-766"><a href="#Photosequence-766"><span class="linenos">766</span></a>        <span class="c1"># Vrifier si le rpertoire existe</span>
</span><span id="Photosequence-767"><a href="#Photosequence-767"><span class="linenos">767</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence-768"><a href="#Photosequence-768"><span class="linenos">768</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Le rpertoire spcifi n&#39;existe pas : </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence-769"><a href="#Photosequence-769"><span class="linenos">769</span></a>
</span><span id="Photosequence-770"><a href="#Photosequence-770"><span class="linenos">770</span></a>        <span class="c1"># Initialiser une liste pour les fichiers image</span>
</span><span id="Photosequence-771"><a href="#Photosequence-771"><span class="linenos">771</span></a>        <span class="n">merged_mask_images</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-772"><a href="#Photosequence-772"><span class="linenos">772</span></a>
</span><span id="Photosequence-773"><a href="#Photosequence-773"><span class="linenos">773</span></a>        <span class="c1"># Parcourir les fichiers dans le rpertoire</span>
</span><span id="Photosequence-774"><a href="#Photosequence-774"><span class="linenos">774</span></a>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence-775"><a href="#Photosequence-775"><span class="linenos">775</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="Photosequence-776"><a href="#Photosequence-776"><span class="linenos">776</span></a>
</span><span id="Photosequence-777"><a href="#Photosequence-777"><span class="linenos">777</span></a>            <span class="c1"># Vrifier si c&#39;est un fichier et si le nom se termine par &quot;_masq_merged.png&quot;</span>
</span><span id="Photosequence-778"><a href="#Photosequence-778"><span class="linenos">778</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_masq_merged.png&quot;</span><span class="p">):</span>
</span><span id="Photosequence-779"><a href="#Photosequence-779"><span class="linenos">779</span></a>                <span class="n">merged_mask_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="Photosequence-780"><a href="#Photosequence-780"><span class="linenos">780</span></a>
</span><span id="Photosequence-781"><a href="#Photosequence-781"><span class="linenos">781</span></a>        <span class="k">return</span> <span class="n">merged_mask_images</span>
</span><span id="Photosequence-782"><a href="#Photosequence-782"><span class="linenos">782</span></a>
</span><span id="Photosequence-783"><a href="#Photosequence-783"><span class="linenos">783</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence-784"><a href="#Photosequence-784"><span class="linenos">784</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run method that performs all the real work&quot;&quot;&quot;</span>
</span><span id="Photosequence-785"><a href="#Photosequence-785"><span class="linenos">785</span></a>
</span><span id="Photosequence-786"><a href="#Photosequence-786"><span class="linenos">786</span></a>        <span class="c1"># Create the dialog with elements (after translation) and keep reference</span>
</span><span id="Photosequence-787"><a href="#Photosequence-787"><span class="linenos">787</span></a>        <span class="c1"># Only create GUI ONCE in callback, so that it will only load when the plugin is started</span>
</span><span id="Photosequence-788"><a href="#Photosequence-788"><span class="linenos">788</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Photosequence-789"><a href="#Photosequence-789"><span class="linenos">789</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Photosequence-790"><a href="#Photosequence-790"><span class="linenos">790</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">PhotosequenceDialog</span><span class="p">()</span>
</span><span id="Photosequence-791"><a href="#Photosequence-791"><span class="linenos">791</span></a>
</span><span id="Photosequence-792"><a href="#Photosequence-792"><span class="linenos">792</span></a>        <span class="c1"># show the dialog</span>
</span><span id="Photosequence-793"><a href="#Photosequence-793"><span class="linenos">793</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset_dialog</span><span class="p">()</span>
</span><span id="Photosequence-794"><a href="#Photosequence-794"><span class="linenos">794</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Photosequence-795"><a href="#Photosequence-795"><span class="linenos">795</span></a>
</span><span id="Photosequence-796"><a href="#Photosequence-796"><span class="linenos">796</span></a>        <span class="c1">#permet d&#39;viter les doublons</span>
</span><span id="Photosequence-797"><a href="#Photosequence-797"><span class="linenos">797</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_signals</span><span class="p">()</span>
</span><span id="Photosequence-798"><a href="#Photosequence-798"><span class="linenos">798</span></a>
</span><span id="Photosequence-799"><a href="#Photosequence-799"><span class="linenos">799</span></a>        <span class="c1"># Connecter les boutons au fichier XML correspondant</span>
</span><span id="Photosequence-800"><a href="#Photosequence-800"><span class="linenos">800</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="Photosequence-801"><a href="#Photosequence-801"><span class="linenos">801</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="p">,</span> <span class="s1">&#39;calibration&#39;</span><span class="p">))</span>  <span class="c1"># Bouton pour le fichier de calibration</span>
</span><span id="Photosequence-802"><a href="#Photosequence-802"><span class="linenos">802</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="Photosequence-803"><a href="#Photosequence-803"><span class="linenos">803</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">))</span>  <span class="c1"># Bouton pour le fichier d&#39;orientation</span>
</span><span id="Photosequence-804"><a href="#Photosequence-804"><span class="linenos">804</span></a>
</span><span id="Photosequence-805"><a href="#Photosequence-805"><span class="linenos">805</span></a>        <span class="c1">#connecter les boutons pour les fichiers images</span>
</span><span id="Photosequence-806"><a href="#Photosequence-806"><span class="linenos">806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesIMG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="p">))</span>
</span><span id="Photosequence-807"><a href="#Photosequence-807"><span class="linenos">807</span></a>        <span class="c1">#connecter les boutons pour les fichiers trajecto</span>
</span><span id="Photosequence-808"><a href="#Photosequence-808"><span class="linenos">808</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesGPKG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">))</span>
</span><span id="Photosequence-809"><a href="#Photosequence-809"><span class="linenos">809</span></a>
</span><span id="Photosequence-810"><a href="#Photosequence-810"><span class="linenos">810</span></a>        <span class="c1"># connecter le bouton repertoire de sortie</span>
</span><span id="Photosequence-811"><a href="#Photosequence-811"><span class="linenos">811</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseOutputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="p">))</span>
</span><span id="Photosequence-812"><a href="#Photosequence-812"><span class="linenos">812</span></a>
</span><span id="Photosequence-813"><a href="#Photosequence-813"><span class="linenos">813</span></a>        <span class="c1"># Run the dialog event loop</span>
</span><span id="Photosequence-814"><a href="#Photosequence-814"><span class="linenos">814</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</span><span id="Photosequence-815"><a href="#Photosequence-815"><span class="linenos">815</span></a>        <span class="c1"># See if OK was pressed</span>
</span><span id="Photosequence-816"><a href="#Photosequence-816"><span class="linenos">816</span></a>        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Photosequence-817"><a href="#Photosequence-817"><span class="linenos">817</span></a>
</span><span id="Photosequence-818"><a href="#Photosequence-818"><span class="linenos">818</span></a>            <span class="n">calibration_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence-819"><a href="#Photosequence-819"><span class="linenos">819</span></a>            <span class="n">orientation_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence-820"><a href="#Photosequence-820"><span class="linenos">820</span></a>            <span class="n">image_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence-821"><a href="#Photosequence-821"><span class="linenos">821</span></a>            <span class="n">point_trajectory_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence-822"><a href="#Photosequence-822"><span class="linenos">822</span></a>            <span class="n">OutputDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence-823"><a href="#Photosequence-823"><span class="linenos">823</span></a>            <span class="n">epsg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">le_epsg</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence-824"><a href="#Photosequence-824"><span class="linenos">824</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">:</span>
</span><span id="Photosequence-825"><a href="#Photosequence-825"><span class="linenos">825</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">init_transformer</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence-826"><a href="#Photosequence-826"><span class="linenos">826</span></a>
</span><span id="Photosequence-827"><a href="#Photosequence-827"><span class="linenos">827</span></a>            <span class="c1"># Rcuperer les coordonnes de l&#39;aronef dans la BDD de la trajectoire en .gpkg</span>
</span><span id="Photosequence-828"><a href="#Photosequence-828"><span class="linenos">828</span></a>            <span class="n">posx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">)</span>
</span><span id="Photosequence-829"><a href="#Photosequence-829"><span class="linenos">829</span></a>            <span class="n">posy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
</span><span id="Photosequence-830"><a href="#Photosequence-830"><span class="linenos">830</span></a>            <span class="n">posz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;alt_m&#39;</span><span class="p">)</span>
</span><span id="Photosequence-831"><a href="#Photosequence-831"><span class="linenos">831</span></a>            <span class="n">posz_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;mnt_m&#39;</span><span class="p">)</span>
</span><span id="Photosequence-832"><a href="#Photosequence-832"><span class="linenos">832</span></a>
</span><span id="Photosequence-833"><a href="#Photosequence-833"><span class="linenos">833</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-834"><a href="#Photosequence-834"><span class="linenos">834</span></a>            <span class="c1"># crer le projet QGIS</span>
</span><span id="Photosequence-835"><a href="#Photosequence-835"><span class="linenos">835</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-836"><a href="#Photosequence-836"><span class="linenos">836</span></a>
</span><span id="Photosequence-837"><a href="#Photosequence-837"><span class="linenos">837</span></a>            <span class="n">project_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_projet_qgis</span><span class="p">(</span><span class="n">OutputDir</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence-838"><a href="#Photosequence-838"><span class="linenos">838</span></a>
</span><span id="Photosequence-839"><a href="#Photosequence-839"><span class="linenos">839</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-840"><a href="#Photosequence-840"><span class="linenos">840</span></a>            <span class="c1"># gestion de la banque d&#39;image</span>
</span><span id="Photosequence-841"><a href="#Photosequence-841"><span class="linenos">841</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-842"><a href="#Photosequence-842"><span class="linenos">842</span></a>
</span><span id="Photosequence-843"><a href="#Photosequence-843"><span class="linenos">843</span></a>            <span class="n">images_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
</span><span id="Photosequence-844"><a href="#Photosequence-844"><span class="linenos">844</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">images_list</span><span class="p">)</span>
</span><span id="Photosequence-845"><a href="#Photosequence-845"><span class="linenos">845</span></a>
</span><span id="Photosequence-846"><a href="#Photosequence-846"><span class="linenos">846</span></a>            <span class="n">base_img</span> <span class="o">=</span> <span class="n">images_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Photosequence-847"><a href="#Photosequence-847"><span class="linenos">847</span></a>            <span class="n">base_img_lyr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_png_to_qgis_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">base_img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence-848"><a href="#Photosequence-848"><span class="linenos">848</span></a>
</span><span id="Photosequence-849"><a href="#Photosequence-849"><span class="linenos">849</span></a>            <span class="c1"># Zoom to first raster layer extent</span>
</span><span id="Photosequence-850"><a href="#Photosequence-850"><span class="linenos">850</span></a>            <span class="n">extent</span> <span class="o">=</span> <span class="n">base_img_lyr</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
</span><span id="Photosequence-851"><a href="#Photosequence-851"><span class="linenos">851</span></a>            <span class="n">projection</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">base_img_lyr</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
</span><span id="Photosequence-852"><a href="#Photosequence-852"><span class="linenos">852</span></a>                                                <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
</span><span id="Photosequence-853"><a href="#Photosequence-853"><span class="linenos">853</span></a>                                                <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">())</span>
</span><span id="Photosequence-854"><a href="#Photosequence-854"><span class="linenos">854</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">setExtent</span><span class="p">(</span><span class="n">projection</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">extent</span><span class="p">))</span>
</span><span id="Photosequence-855"><a href="#Photosequence-855"><span class="linenos">855</span></a>
</span><span id="Photosequence-856"><a href="#Photosequence-856"><span class="linenos">856</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-857"><a href="#Photosequence-857"><span class="linenos">857</span></a>            <span class="c1"># Gestion des masques</span>
</span><span id="Photosequence-858"><a href="#Photosequence-858"><span class="linenos">858</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-859"><a href="#Photosequence-859"><span class="linenos">859</span></a>
</span><span id="Photosequence-860"><a href="#Photosequence-860"><span class="linenos">860</span></a>            <span class="c1"># Boucle permettant de fusionner les masque micmac des images aux images.</span>
</span><span id="Photosequence-861"><a href="#Photosequence-861"><span class="linenos">861</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_list</span><span class="p">)):</span>
</span><span id="Photosequence-862"><a href="#Photosequence-862"><span class="linenos">862</span></a>                <span class="c1"># Charger l&#39;image en couleur et le masque</span>
</span><span id="Photosequence-863"><a href="#Photosequence-863"><span class="linenos">863</span></a>                <span class="n">path_in</span> <span class="o">=</span> <span class="n">images_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Photosequence-864"><a href="#Photosequence-864"><span class="linenos">864</span></a>                <span class="n">path_mask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_Masq.tif&quot;</span>
</span><span id="Photosequence-865"><a href="#Photosequence-865"><span class="linenos">865</span></a>                <span class="c1"># print(path_mask)</span>
</span><span id="Photosequence-866"><a href="#Photosequence-866"><span class="linenos">866</span></a>                <span class="n">image_color</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
</span><span id="Photosequence-867"><a href="#Photosequence-867"><span class="linenos">867</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span><span id="Photosequence-868"><a href="#Photosequence-868"><span class="linenos">868</span></a>
</span><span id="Photosequence-869"><a href="#Photosequence-869"><span class="linenos">869</span></a>                <span class="c1"># Vrifier que les dimensions correspondent</span>
</span><span id="Photosequence-870"><a href="#Photosequence-870"><span class="linenos">870</span></a>                <span class="k">if</span> <span class="n">image_color</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="Photosequence-871"><a href="#Photosequence-871"><span class="linenos">871</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Les dimensions de l&#39;image couleur et du masque ne correspondent pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence-872"><a href="#Photosequence-872"><span class="linenos">872</span></a>
</span><span id="Photosequence-873"><a href="#Photosequence-873"><span class="linenos">873</span></a>                <span class="c1"># Convertir le masque en 3 canaux pour l&#39;appliquer sur l&#39;image couleur</span>
</span><span id="Photosequence-874"><a href="#Photosequence-874"><span class="linenos">874</span></a>                <span class="n">mask_3channel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="Photosequence-875"><a href="#Photosequence-875"><span class="linenos">875</span></a>
</span><span id="Photosequence-876"><a href="#Photosequence-876"><span class="linenos">876</span></a>                <span class="c1"># Appliquer le masque  l&#39;image couleur</span>
</span><span id="Photosequence-877"><a href="#Photosequence-877"><span class="linenos">877</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">image_color</span><span class="p">,</span> <span class="n">mask_3channel</span><span class="p">)</span>
</span><span id="Photosequence-878"><a href="#Photosequence-878"><span class="linenos">878</span></a>
</span><span id="Photosequence-879"><a href="#Photosequence-879"><span class="linenos">879</span></a>                <span class="c1"># Sauvegarder ou afficher le rsultat</span>
</span><span id="Photosequence-880"><a href="#Photosequence-880"><span class="linenos">880</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_masq_merged.png&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="Photosequence-881"><a href="#Photosequence-881"><span class="linenos">881</span></a>            <span class="c1"># Boucle permettant de fusionner les masque micmac des images aux images.</span>
</span><span id="Photosequence-882"><a href="#Photosequence-882"><span class="linenos">882</span></a>            <span class="n">merged_mask_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_mask_images</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
</span><span id="Photosequence-883"><a href="#Photosequence-883"><span class="linenos">883</span></a>
</span><span id="Photosequence-884"><a href="#Photosequence-884"><span class="linenos">884</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">merged_mask_list</span><span class="p">)):</span>
</span><span id="Photosequence-885"><a href="#Photosequence-885"><span class="linenos">885</span></a>                <span class="c1"># Ajouter l&#39;image PNG au projet et rcuprer la couche</span>
</span><span id="Photosequence-886"><a href="#Photosequence-886"><span class="linenos">886</span></a>                <span class="n">transparence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Photosequence-887"><a href="#Photosequence-887"><span class="linenos">887</span></a>                <span class="n">raster_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_png_to_qgis_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">merged_mask_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">transparence</span><span class="p">)</span>
</span><span id="Photosequence-888"><a href="#Photosequence-888"><span class="linenos">888</span></a>
</span><span id="Photosequence-889"><a href="#Photosequence-889"><span class="linenos">889</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-890"><a href="#Photosequence-890"><span class="linenos">890</span></a>            <span class="c1"># ALGORITHME &quot;MAISON&quot;</span>
</span><span id="Photosequence-891"><a href="#Photosequence-891"><span class="linenos">891</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-892"><a href="#Photosequence-892"><span class="linenos">892</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_classic</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="Photosequence-893"><a href="#Photosequence-893"><span class="linenos">893</span></a>
</span><span id="Photosequence-894"><a href="#Photosequence-894"><span class="linenos">894</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-895"><a href="#Photosequence-895"><span class="linenos">895</span></a>                <span class="c1">#             Trajectoire de l&#39;avion</span>
</span><span id="Photosequence-896"><a href="#Photosequence-896"><span class="linenos">896</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-897"><a href="#Photosequence-897"><span class="linenos">897</span></a>                <span class="c1"># Rcuprer les indices des valeurs non NULL et transformer les coordonnes en flottants</span>
</span><span id="Photosequence-898"><a href="#Photosequence-898"><span class="linenos">898</span></a>                <span class="n">indices_posx_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">posx</span><span class="p">)</span> <span class="k">if</span>
</span><span id="Photosequence-899"><a href="#Photosequence-899"><span class="linenos">899</span></a>                                         <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence-900"><a href="#Photosequence-900"><span class="linenos">900</span></a>                <span class="n">indices_posy_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">posy</span><span class="p">)</span> <span class="k">if</span>
</span><span id="Photosequence-901"><a href="#Photosequence-901"><span class="linenos">901</span></a>                                         <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence-902"><a href="#Photosequence-902"><span class="linenos">902</span></a>
</span><span id="Photosequence-903"><a href="#Photosequence-903"><span class="linenos">903</span></a>                <span class="c1"># Permet de trier les valeurs de la BDD pour enlever les valeurs NULL et aussi transformer les coordonnes en flottant</span>
</span><span id="Photosequence-904"><a href="#Photosequence-904"><span class="linenos">904</span></a>                <span class="n">posx_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posx</span> <span class="k">if</span>
</span><span id="Photosequence-905"><a href="#Photosequence-905"><span class="linenos">905</span></a>                                 <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence-906"><a href="#Photosequence-906"><span class="linenos">906</span></a>                <span class="n">posy_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posy</span> <span class="k">if</span>
</span><span id="Photosequence-907"><a href="#Photosequence-907"><span class="linenos">907</span></a>                                 <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence-908"><a href="#Photosequence-908"><span class="linenos">908</span></a>                <span class="n">posz_not_null</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-909"><a href="#Photosequence-909"><span class="linenos">909</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">)):</span>
</span><span id="Photosequence-910"><a href="#Photosequence-910"><span class="linenos">910</span></a>                    <span class="n">posz_not_null</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posz</span><span class="p">[</span><span class="n">indices_posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="Photosequence-911"><a href="#Photosequence-911"><span class="linenos">911</span></a>
</span><span id="Photosequence-912"><a href="#Photosequence-912"><span class="linenos">912</span></a>                <span class="n">coord_XY_qgs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-913"><a href="#Photosequence-913"><span class="linenos">913</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">))):</span>
</span><span id="Photosequence-914"><a href="#Photosequence-914"><span class="linenos">914</span></a>                    <span class="n">coord_XY_qgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">posy_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="Photosequence-915"><a href="#Photosequence-915"><span class="linenos">915</span></a>
</span><span id="Photosequence-916"><a href="#Photosequence-916"><span class="linenos">916</span></a>                <span class="n">coord_proj_air</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Photosequence-917"><a href="#Photosequence-917"><span class="linenos">917</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence-918"><a href="#Photosequence-918"><span class="linenos">918</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">coord_XY_qgs</span><span class="p">:</span>
</span><span id="Photosequence-919"><a href="#Photosequence-919"><span class="linenos">919</span></a>                    <span class="n">point_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="Photosequence-920"><a href="#Photosequence-920"><span class="linenos">920</span></a>                    <span class="n">coord_proj_air</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_proj</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">posz_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="Photosequence-921"><a href="#Photosequence-921"><span class="linenos">921</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Photosequence-922"><a href="#Photosequence-922"><span class="linenos">922</span></a>                <span class="c1"># print(&quot;coord_proj_air: &quot;,coord_proj_air)</span>
</span><span id="Photosequence-923"><a href="#Photosequence-923"><span class="linenos">923</span></a>
</span><span id="Photosequence-924"><a href="#Photosequence-924"><span class="linenos">924</span></a>                <span class="n">L_coord_image_air</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span> <span class="n">coord_proj_air</span><span class="p">,</span> <span class="n">base_img</span><span class="p">)</span>
</span><span id="Photosequence-925"><a href="#Photosequence-925"><span class="linenos">925</span></a>                <span class="c1"># print(&quot;L_coord_image_air: &quot;,L_coord_image_air)</span>
</span><span id="Photosequence-926"><a href="#Photosequence-926"><span class="linenos">926</span></a>                <span class="c1"># self.creer_ligne(L_coord_image_air)</span>
</span><span id="Photosequence-927"><a href="#Photosequence-927"><span class="linenos">927</span></a>
</span><span id="Photosequence-928"><a href="#Photosequence-928"><span class="linenos">928</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-929"><a href="#Photosequence-929"><span class="linenos">929</span></a>                <span class="c1">#             Trace au sol</span>
</span><span id="Photosequence-930"><a href="#Photosequence-930"><span class="linenos">930</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-931"><a href="#Photosequence-931"><span class="linenos">931</span></a>                <span class="n">posz_not_null_tr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence-932"><a href="#Photosequence-932"><span class="linenos">932</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">)):</span>
</span><span id="Photosequence-933"><a href="#Photosequence-933"><span class="linenos">933</span></a>                    <span class="n">posz_not_null_tr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posz_tr</span><span class="p">[</span><span class="n">indices_posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="Photosequence-934"><a href="#Photosequence-934"><span class="linenos">934</span></a>
</span><span id="Photosequence-935"><a href="#Photosequence-935"><span class="linenos">935</span></a>                <span class="n">coord_proj_tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Photosequence-936"><a href="#Photosequence-936"><span class="linenos">936</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence-937"><a href="#Photosequence-937"><span class="linenos">937</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">coord_XY_qgs</span><span class="p">:</span>
</span><span id="Photosequence-938"><a href="#Photosequence-938"><span class="linenos">938</span></a>                    <span class="n">point_proj_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="Photosequence-939"><a href="#Photosequence-939"><span class="linenos">939</span></a>                    <span class="n">coord_proj_tr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_proj_tr</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj_tr</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">posz_not_null_tr</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="Photosequence-940"><a href="#Photosequence-940"><span class="linenos">940</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Photosequence-941"><a href="#Photosequence-941"><span class="linenos">941</span></a>
</span><span id="Photosequence-942"><a href="#Photosequence-942"><span class="linenos">942</span></a>                <span class="n">L_coord_image_tr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span> <span class="n">coord_proj_tr</span><span class="p">,</span> <span class="n">base_img</span><span class="p">)</span>
</span><span id="Photosequence-943"><a href="#Photosequence-943"><span class="linenos">943</span></a>                <span class="c1"># print(&quot;L_coord_image_tr: &quot;,L_coord_image_tr)</span>
</span><span id="Photosequence-944"><a href="#Photosequence-944"><span class="linenos">944</span></a>
</span><span id="Photosequence-945"><a href="#Photosequence-945"><span class="linenos">945</span></a>                <span class="n">layer_polygone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_polygone</span><span class="p">(</span><span class="n">L_coord_image_tr</span><span class="p">,</span> <span class="n">L_coord_image_air</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence-946"><a href="#Photosequence-946"><span class="linenos">946</span></a>
</span><span id="Photosequence-947"><a href="#Photosequence-947"><span class="linenos">947</span></a>                <span class="n">trajectory_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s2">&quot;trajecto_fictive&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
</span><span id="Photosequence-948"><a href="#Photosequence-948"><span class="linenos">948</span></a>                <span class="n">point_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_points</span><span class="p">(</span><span class="n">trajectory_layer</span><span class="p">,</span> <span class="n">OutputDir</span><span class="p">,</span> <span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span>
</span><span id="Photosequence-949"><a href="#Photosequence-949"><span class="linenos">949</span></a>                                                <span class="n">base_img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence-950"><a href="#Photosequence-950"><span class="linenos">950</span></a>
</span><span id="Photosequence-951"><a href="#Photosequence-951"><span class="linenos">951</span></a>
</span><span id="Photosequence-952"><a href="#Photosequence-952"><span class="linenos">952</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-953"><a href="#Photosequence-953"><span class="linenos">953</span></a>            <span class="c1"># si MicMac est choisi</span>
</span><span id="Photosequence-954"><a href="#Photosequence-954"><span class="linenos">954</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence-955"><a href="#Photosequence-955"><span class="linenos">955</span></a>
</span><span id="Photosequence-956"><a href="#Photosequence-956"><span class="linenos">956</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_micmac</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="Photosequence-957"><a href="#Photosequence-957"><span class="linenos">957</span></a>                <span class="c1"># TODO</span>
</span><span id="Photosequence-958"><a href="#Photosequence-958"><span class="linenos">958</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;oui&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>QGIS Plugin Implementation.</p>
</div>


                            <div id="Photosequence.__init__" class="classattr">
                                        <input id="Photosequence.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Photosequence</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">iface</span></span>)</span>

                <label class="view-source-button" for="Photosequence.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.__init__-28"><a href="#Photosequence.__init__-28"><span class="linenos">28</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
</span><span id="Photosequence.__init__-29"><a href="#Photosequence.__init__-29"><span class="linenos">29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.__init__-30"><a href="#Photosequence.__init__-30"><span class="linenos">30</span></a><span class="sd">        Constructor.</span>
</span><span id="Photosequence.__init__-31"><a href="#Photosequence.__init__-31"><span class="linenos">31</span></a><span class="sd">        </span>
</span><span id="Photosequence.__init__-32"><a href="#Photosequence.__init__-32"><span class="linenos">32</span></a><span class="sd">        :param iface: An interface instance that will be passed to this class,</span>
</span><span id="Photosequence.__init__-33"><a href="#Photosequence.__init__-33"><span class="linenos">33</span></a><span class="sd">            which provides the hook by which you can manipulate the QGIS</span>
</span><span id="Photosequence.__init__-34"><a href="#Photosequence.__init__-34"><span class="linenos">34</span></a><span class="sd">            application at run time.</span>
</span><span id="Photosequence.__init__-35"><a href="#Photosequence.__init__-35"><span class="linenos">35</span></a><span class="sd">        :type iface: QgsInterface</span>
</span><span id="Photosequence.__init__-36"><a href="#Photosequence.__init__-36"><span class="linenos">36</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.__init__-37"><a href="#Photosequence.__init__-37"><span class="linenos">37</span></a>        <span class="c1"># Save reference to the QGIS interface</span>
</span><span id="Photosequence.__init__-38"><a href="#Photosequence.__init__-38"><span class="linenos">38</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>
</span><span id="Photosequence.__init__-39"><a href="#Photosequence.__init__-39"><span class="linenos">39</span></a>        <span class="c1"># initialize plugin directory</span>
</span><span id="Photosequence.__init__-40"><a href="#Photosequence.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</span><span id="Photosequence.__init__-41"><a href="#Photosequence.__init__-41"><span class="linenos">41</span></a>        <span class="c1"># initialize locale</span>
</span><span id="Photosequence.__init__-42"><a href="#Photosequence.__init__-42"><span class="linenos">42</span></a>        <span class="n">locale</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;locale/userLocale&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Photosequence.__init__-43"><a href="#Photosequence.__init__-43"><span class="linenos">43</span></a>        <span class="n">locale_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Photosequence.__init__-44"><a href="#Photosequence.__init__-44"><span class="linenos">44</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">,</span>
</span><span id="Photosequence.__init__-45"><a href="#Photosequence.__init__-45"><span class="linenos">45</span></a>            <span class="s1">&#39;i18n&#39;</span><span class="p">,</span>
</span><span id="Photosequence.__init__-46"><a href="#Photosequence.__init__-46"><span class="linenos">46</span></a>            <span class="s1">&#39;Photosequence_</span><span class="si">{}</span><span class="s1">.qm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locale</span><span class="p">))</span>
</span><span id="Photosequence.__init__-47"><a href="#Photosequence.__init__-47"><span class="linenos">47</span></a>
</span><span id="Photosequence.__init__-48"><a href="#Photosequence.__init__-48"><span class="linenos">48</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">locale_path</span><span class="p">):</span>
</span><span id="Photosequence.__init__-49"><a href="#Photosequence.__init__-49"><span class="linenos">49</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="n">QTranslator</span><span class="p">()</span>
</span><span id="Photosequence.__init__-50"><a href="#Photosequence.__init__-50"><span class="linenos">50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">locale_path</span><span class="p">)</span>
</span><span id="Photosequence.__init__-51"><a href="#Photosequence.__init__-51"><span class="linenos">51</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">)</span>
</span><span id="Photosequence.__init__-52"><a href="#Photosequence.__init__-52"><span class="linenos">52</span></a>
</span><span id="Photosequence.__init__-53"><a href="#Photosequence.__init__-53"><span class="linenos">53</span></a>        <span class="c1"># Declare instance attributes</span>
</span><span id="Photosequence.__init__-54"><a href="#Photosequence.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.__init__-55"><a href="#Photosequence.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;photosequence&#39;</span><span class="p">)</span>
</span><span id="Photosequence.__init__-56"><a href="#Photosequence.__init__-56"><span class="linenos">56</span></a>
</span><span id="Photosequence.__init__-57"><a href="#Photosequence.__init__-57"><span class="linenos">57</span></a>        <span class="c1"># Check if plugin was started the first time in current QGIS session</span>
</span><span id="Photosequence.__init__-58"><a href="#Photosequence.__init__-58"><span class="linenos">58</span></a>        <span class="c1"># Must be set in initGui() to survive plugin reloads</span>
</span><span id="Photosequence.__init__-59"><a href="#Photosequence.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Photosequence.__init__-60"><a href="#Photosequence.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Photosequence.__init__-61"><a href="#Photosequence.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Constructor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>iface</strong>:  An interface instance that will be passed to this class,
which provides the hook by which you can manipulate the QGIS
application at run time.</li>
</ul>
</div>


                            </div>
                            <div id="Photosequence.iface" class="classattr">
                                <div class="attr variable">
            <span class="name">iface</span>

        
    </div>
    <a class="headerlink" href="#Photosequence.iface"></a>
    
    

                            </div>
                            <div id="Photosequence.plugin_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">plugin_dir</span>

        
    </div>
    <a class="headerlink" href="#Photosequence.plugin_dir"></a>
    
    

                            </div>
                            <div id="Photosequence.actions" class="classattr">
                                <div class="attr variable">
            <span class="name">actions</span>

        
    </div>
    <a class="headerlink" href="#Photosequence.actions"></a>
    
    

                            </div>
                            <div id="Photosequence.menu" class="classattr">
                                <div class="attr variable">
            <span class="name">menu</span>

        
    </div>
    <a class="headerlink" href="#Photosequence.menu"></a>
    
    

                            </div>
                            <div id="Photosequence.first_start" class="classattr">
                                <div class="attr variable">
            <span class="name">first_start</span>

        
    </div>
    <a class="headerlink" href="#Photosequence.first_start"></a>
    
    

                            </div>
                            <div id="Photosequence.transformer" class="classattr">
                                <div class="attr variable">
            <span class="name">transformer</span>

        
    </div>
    <a class="headerlink" href="#Photosequence.transformer"></a>
    
    

                            </div>
                            <div id="Photosequence.data_path" class="classattr">
                                <div class="attr variable">
            <span class="name">data_path</span>

        
    </div>
    <a class="headerlink" href="#Photosequence.data_path"></a>
    
    

                            </div>
                            <div id="Photosequence.init_transformer" class="classattr">
                                        <input id="Photosequence.init_transformer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_transformer</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">epsg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.init_transformer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.init_transformer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.init_transformer-63"><a href="#Photosequence.init_transformer-63"><span class="linenos">63</span></a>    <span class="k">def</span> <span class="nf">init_transformer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence.init_transformer-64"><a href="#Photosequence.init_transformer-64"><span class="linenos">64</span></a>        <span class="n">source_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
</span><span id="Photosequence.init_transformer-65"><a href="#Photosequence.init_transformer-65"><span class="linenos">65</span></a>        <span class="n">target_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.init_transformer-66"><a href="#Photosequence.init_transformer-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">source_crs</span><span class="p">,</span> <span class="n">target_crs</span><span class="p">,</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.tr" class="classattr">
                                        <input id="Photosequence.tr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">message</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.tr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.tr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.tr-69"><a href="#Photosequence.tr-69"><span class="linenos">69</span></a>    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="Photosequence.tr-70"><a href="#Photosequence.tr-70"><span class="linenos">70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the translation for a string using Qt translation API.</span>
</span><span id="Photosequence.tr-71"><a href="#Photosequence.tr-71"><span class="linenos">71</span></a>
</span><span id="Photosequence.tr-72"><a href="#Photosequence.tr-72"><span class="linenos">72</span></a><span class="sd">        We implement this ourselves since we do not inherit QObject.</span>
</span><span id="Photosequence.tr-73"><a href="#Photosequence.tr-73"><span class="linenos">73</span></a>
</span><span id="Photosequence.tr-74"><a href="#Photosequence.tr-74"><span class="linenos">74</span></a><span class="sd">        :param message: String for translation.</span>
</span><span id="Photosequence.tr-75"><a href="#Photosequence.tr-75"><span class="linenos">75</span></a><span class="sd">        :type message: str, QString</span>
</span><span id="Photosequence.tr-76"><a href="#Photosequence.tr-76"><span class="linenos">76</span></a>
</span><span id="Photosequence.tr-77"><a href="#Photosequence.tr-77"><span class="linenos">77</span></a><span class="sd">        :returns: Translated version of message.</span>
</span><span id="Photosequence.tr-78"><a href="#Photosequence.tr-78"><span class="linenos">78</span></a><span class="sd">        :rtype: QString</span>
</span><span id="Photosequence.tr-79"><a href="#Photosequence.tr-79"><span class="linenos">79</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.tr-80"><a href="#Photosequence.tr-80"><span class="linenos">80</span></a>        <span class="c1"># noinspection PyTypeChecker,PyArgumentList,PyCallByClass</span>
</span><span id="Photosequence.tr-81"><a href="#Photosequence.tr-81"><span class="linenos">81</span></a>        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;Photosequence&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the translation for a string using Qt translation API.</p>

<p>We implement this ourselves since we do not inherit QObject.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>message</strong>:  String for translation.</li>
</ul>

<p>:returns: Translated version of message.</p>
</div>


                            </div>
                            <div id="Photosequence.add_action" class="classattr">
                                        <input id="Photosequence.add_action-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_action</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">icon_path</span>,</span><span class="param">	<span class="n">text</span>,</span><span class="param">	<span class="n">callback</span>,</span><span class="param">	<span class="n">enabled_flag</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">add_to_menu</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">add_to_toolbar</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">status_tip</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">whats_this</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parent</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.add_action-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.add_action"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.add_action-83"><a href="#Photosequence.add_action-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="nf">add_action</span><span class="p">(</span>
</span><span id="Photosequence.add_action-84"><a href="#Photosequence.add_action-84"><span class="linenos"> 84</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Photosequence.add_action-85"><a href="#Photosequence.add_action-85"><span class="linenos"> 85</span></a>            <span class="n">icon_path</span><span class="p">,</span>
</span><span id="Photosequence.add_action-86"><a href="#Photosequence.add_action-86"><span class="linenos"> 86</span></a>            <span class="n">text</span><span class="p">,</span>
</span><span id="Photosequence.add_action-87"><a href="#Photosequence.add_action-87"><span class="linenos"> 87</span></a>            <span class="n">callback</span><span class="p">,</span>
</span><span id="Photosequence.add_action-88"><a href="#Photosequence.add_action-88"><span class="linenos"> 88</span></a>            <span class="n">enabled_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Photosequence.add_action-89"><a href="#Photosequence.add_action-89"><span class="linenos"> 89</span></a>            <span class="n">add_to_menu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Photosequence.add_action-90"><a href="#Photosequence.add_action-90"><span class="linenos"> 90</span></a>            <span class="n">add_to_toolbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Photosequence.add_action-91"><a href="#Photosequence.add_action-91"><span class="linenos"> 91</span></a>            <span class="n">status_tip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Photosequence.add_action-92"><a href="#Photosequence.add_action-92"><span class="linenos"> 92</span></a>            <span class="n">whats_this</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Photosequence.add_action-93"><a href="#Photosequence.add_action-93"><span class="linenos"> 93</span></a>            <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Photosequence.add_action-94"><a href="#Photosequence.add_action-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a toolbar icon to the toolbar.</span>
</span><span id="Photosequence.add_action-95"><a href="#Photosequence.add_action-95"><span class="linenos"> 95</span></a>
</span><span id="Photosequence.add_action-96"><a href="#Photosequence.add_action-96"><span class="linenos"> 96</span></a><span class="sd">        :param icon_path: Path to the icon for this action. Can be a resource</span>
</span><span id="Photosequence.add_action-97"><a href="#Photosequence.add_action-97"><span class="linenos"> 97</span></a><span class="sd">            path (e.g. &#39;:/plugins/foo/bar.png&#39;) or a normal file system path.</span>
</span><span id="Photosequence.add_action-98"><a href="#Photosequence.add_action-98"><span class="linenos"> 98</span></a><span class="sd">        :type icon_path: str</span>
</span><span id="Photosequence.add_action-99"><a href="#Photosequence.add_action-99"><span class="linenos"> 99</span></a>
</span><span id="Photosequence.add_action-100"><a href="#Photosequence.add_action-100"><span class="linenos">100</span></a><span class="sd">        :param text: Text that should be shown in menu items for this action.</span>
</span><span id="Photosequence.add_action-101"><a href="#Photosequence.add_action-101"><span class="linenos">101</span></a><span class="sd">        :type text: str</span>
</span><span id="Photosequence.add_action-102"><a href="#Photosequence.add_action-102"><span class="linenos">102</span></a>
</span><span id="Photosequence.add_action-103"><a href="#Photosequence.add_action-103"><span class="linenos">103</span></a><span class="sd">        :param callback: Function to be called when the action is triggered.</span>
</span><span id="Photosequence.add_action-104"><a href="#Photosequence.add_action-104"><span class="linenos">104</span></a><span class="sd">        :type callback: function</span>
</span><span id="Photosequence.add_action-105"><a href="#Photosequence.add_action-105"><span class="linenos">105</span></a>
</span><span id="Photosequence.add_action-106"><a href="#Photosequence.add_action-106"><span class="linenos">106</span></a><span class="sd">        :param enabled_flag: A flag indicating if the action should be enabled</span>
</span><span id="Photosequence.add_action-107"><a href="#Photosequence.add_action-107"><span class="linenos">107</span></a><span class="sd">            by default. Defaults to True.</span>
</span><span id="Photosequence.add_action-108"><a href="#Photosequence.add_action-108"><span class="linenos">108</span></a><span class="sd">        :type enabled_flag: bool</span>
</span><span id="Photosequence.add_action-109"><a href="#Photosequence.add_action-109"><span class="linenos">109</span></a>
</span><span id="Photosequence.add_action-110"><a href="#Photosequence.add_action-110"><span class="linenos">110</span></a><span class="sd">        :param add_to_menu: Flag indicating whether the action should also</span>
</span><span id="Photosequence.add_action-111"><a href="#Photosequence.add_action-111"><span class="linenos">111</span></a><span class="sd">            be added to the menu. Defaults to True.</span>
</span><span id="Photosequence.add_action-112"><a href="#Photosequence.add_action-112"><span class="linenos">112</span></a><span class="sd">        :type add_to_menu: bool</span>
</span><span id="Photosequence.add_action-113"><a href="#Photosequence.add_action-113"><span class="linenos">113</span></a>
</span><span id="Photosequence.add_action-114"><a href="#Photosequence.add_action-114"><span class="linenos">114</span></a><span class="sd">        :param add_to_toolbar: Flag indicating whether the action should also</span>
</span><span id="Photosequence.add_action-115"><a href="#Photosequence.add_action-115"><span class="linenos">115</span></a><span class="sd">            be added to the toolbar. Defaults to True.</span>
</span><span id="Photosequence.add_action-116"><a href="#Photosequence.add_action-116"><span class="linenos">116</span></a><span class="sd">        :type add_to_toolbar: bool</span>
</span><span id="Photosequence.add_action-117"><a href="#Photosequence.add_action-117"><span class="linenos">117</span></a>
</span><span id="Photosequence.add_action-118"><a href="#Photosequence.add_action-118"><span class="linenos">118</span></a><span class="sd">        :param status_tip: Optional text to show in a popup when mouse pointer</span>
</span><span id="Photosequence.add_action-119"><a href="#Photosequence.add_action-119"><span class="linenos">119</span></a><span class="sd">            hovers over the action.</span>
</span><span id="Photosequence.add_action-120"><a href="#Photosequence.add_action-120"><span class="linenos">120</span></a><span class="sd">        :type status_tip: str</span>
</span><span id="Photosequence.add_action-121"><a href="#Photosequence.add_action-121"><span class="linenos">121</span></a>
</span><span id="Photosequence.add_action-122"><a href="#Photosequence.add_action-122"><span class="linenos">122</span></a><span class="sd">        :param parent: Parent widget for the new action. Defaults None.</span>
</span><span id="Photosequence.add_action-123"><a href="#Photosequence.add_action-123"><span class="linenos">123</span></a><span class="sd">        :type parent: QWidget</span>
</span><span id="Photosequence.add_action-124"><a href="#Photosequence.add_action-124"><span class="linenos">124</span></a>
</span><span id="Photosequence.add_action-125"><a href="#Photosequence.add_action-125"><span class="linenos">125</span></a><span class="sd">        :param whats_this: Optional text to show in the status bar when the</span>
</span><span id="Photosequence.add_action-126"><a href="#Photosequence.add_action-126"><span class="linenos">126</span></a><span class="sd">            mouse pointer hovers over the action.</span>
</span><span id="Photosequence.add_action-127"><a href="#Photosequence.add_action-127"><span class="linenos">127</span></a>
</span><span id="Photosequence.add_action-128"><a href="#Photosequence.add_action-128"><span class="linenos">128</span></a><span class="sd">        :returns: The action that was created. Note that the action is also</span>
</span><span id="Photosequence.add_action-129"><a href="#Photosequence.add_action-129"><span class="linenos">129</span></a><span class="sd">            added to self.actions list.</span>
</span><span id="Photosequence.add_action-130"><a href="#Photosequence.add_action-130"><span class="linenos">130</span></a><span class="sd">        :rtype: QAction</span>
</span><span id="Photosequence.add_action-131"><a href="#Photosequence.add_action-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.add_action-132"><a href="#Photosequence.add_action-132"><span class="linenos">132</span></a>
</span><span id="Photosequence.add_action-133"><a href="#Photosequence.add_action-133"><span class="linenos">133</span></a>        <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
</span><span id="Photosequence.add_action-134"><a href="#Photosequence.add_action-134"><span class="linenos">134</span></a>        <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span id="Photosequence.add_action-135"><a href="#Photosequence.add_action-135"><span class="linenos">135</span></a>        <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</span><span id="Photosequence.add_action-136"><a href="#Photosequence.add_action-136"><span class="linenos">136</span></a>        <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled_flag</span><span class="p">)</span>
</span><span id="Photosequence.add_action-137"><a href="#Photosequence.add_action-137"><span class="linenos">137</span></a>
</span><span id="Photosequence.add_action-138"><a href="#Photosequence.add_action-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="n">status_tip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Photosequence.add_action-139"><a href="#Photosequence.add_action-139"><span class="linenos">139</span></a>            <span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">status_tip</span><span class="p">)</span>
</span><span id="Photosequence.add_action-140"><a href="#Photosequence.add_action-140"><span class="linenos">140</span></a>
</span><span id="Photosequence.add_action-141"><a href="#Photosequence.add_action-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">whats_this</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Photosequence.add_action-142"><a href="#Photosequence.add_action-142"><span class="linenos">142</span></a>            <span class="n">action</span><span class="o">.</span><span class="n">setWhatsThis</span><span class="p">(</span><span class="n">whats_this</span><span class="p">)</span>
</span><span id="Photosequence.add_action-143"><a href="#Photosequence.add_action-143"><span class="linenos">143</span></a>
</span><span id="Photosequence.add_action-144"><a href="#Photosequence.add_action-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">add_to_toolbar</span><span class="p">:</span>
</span><span id="Photosequence.add_action-145"><a href="#Photosequence.add_action-145"><span class="linenos">145</span></a>            <span class="c1"># Adds plugin icon to Plugins toolbar</span>
</span><span id="Photosequence.add_action-146"><a href="#Photosequence.add_action-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence.add_action-147"><a href="#Photosequence.add_action-147"><span class="linenos">147</span></a>
</span><span id="Photosequence.add_action-148"><a href="#Photosequence.add_action-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">add_to_menu</span><span class="p">:</span>
</span><span id="Photosequence.add_action-149"><a href="#Photosequence.add_action-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addPluginToMenu</span><span class="p">(</span>
</span><span id="Photosequence.add_action-150"><a href="#Photosequence.add_action-150"><span class="linenos">150</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span>
</span><span id="Photosequence.add_action-151"><a href="#Photosequence.add_action-151"><span class="linenos">151</span></a>                <span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence.add_action-152"><a href="#Photosequence.add_action-152"><span class="linenos">152</span></a>
</span><span id="Photosequence.add_action-153"><a href="#Photosequence.add_action-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence.add_action-154"><a href="#Photosequence.add_action-154"><span class="linenos">154</span></a>
</span><span id="Photosequence.add_action-155"><a href="#Photosequence.add_action-155"><span class="linenos">155</span></a>        <span class="k">return</span> <span class="n">action</span>
</span></pre></div>


            <div class="docstring"><p>Add a toolbar icon to the toolbar.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>icon_path</strong>:  Path to the icon for this action. Can be a resource
path (e.g. ':/plugins/foo/bar.png') or a normal file system path.</p></li>
<li><p><strong>text</strong>:  Text that should be shown in menu items for this action.</p></li>
<li><p><strong>callback</strong>:  Function to be called when the action is triggered.</p></li>
<li><p><strong>enabled_flag</strong>:  A flag indicating if the action should be enabled
by default. Defaults to True.</p></li>
<li><p><strong>add_to_menu</strong>:  Flag indicating whether the action should also
be added to the menu. Defaults to True.</p></li>
<li><p><strong>add_to_toolbar</strong>:  Flag indicating whether the action should also
be added to the toolbar. Defaults to True.</p></li>
<li><p><strong>status_tip</strong>:  Optional text to show in a popup when mouse pointer
hovers over the action.</p></li>
<li><p><strong>parent</strong>:  Parent widget for the new action. Defaults None.</p></li>
<li><p><strong>whats_this</strong>:  Optional text to show in the status bar when the
mouse pointer hovers over the action.</p></li>
</ul>

<p>:returns: The action that was created. Note that the action is also
    added to self.actions list.</p>
</div>


                            </div>
                            <div id="Photosequence.initGui" class="classattr">
                                        <input id="Photosequence.initGui-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initGui</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.initGui-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.initGui"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.initGui-157"><a href="#Photosequence.initGui-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence.initGui-158"><a href="#Photosequence.initGui-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the menu entries and toolbar icons inside the QGIS GUI.&quot;&quot;&quot;</span>
</span><span id="Photosequence.initGui-159"><a href="#Photosequence.initGui-159"><span class="linenos">159</span></a>
</span><span id="Photosequence.initGui-160"><a href="#Photosequence.initGui-160"><span class="linenos">160</span></a>        <span class="n">icon_path</span> <span class="o">=</span> <span class="s1">&#39;:/plugins/photosequence/icon.png&#39;</span>
</span><span id="Photosequence.initGui-161"><a href="#Photosequence.initGui-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span>
</span><span id="Photosequence.initGui-162"><a href="#Photosequence.initGui-162"><span class="linenos">162</span></a>            <span class="n">icon_path</span><span class="p">,</span>
</span><span id="Photosequence.initGui-163"><a href="#Photosequence.initGui-163"><span class="linenos">163</span></a>            <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Photosquence&#39;</span><span class="p">),</span>
</span><span id="Photosequence.initGui-164"><a href="#Photosequence.initGui-164"><span class="linenos">164</span></a>            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
</span><span id="Photosequence.initGui-165"><a href="#Photosequence.initGui-165"><span class="linenos">165</span></a>            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
</span><span id="Photosequence.initGui-166"><a href="#Photosequence.initGui-166"><span class="linenos">166</span></a>
</span><span id="Photosequence.initGui-167"><a href="#Photosequence.initGui-167"><span class="linenos">167</span></a>        <span class="c1"># will be set False in run()</span>
</span><span id="Photosequence.initGui-168"><a href="#Photosequence.initGui-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Create the menu entries and toolbar icons inside the QGIS GUI.</p>
</div>


                            </div>
                            <div id="Photosequence.unload" class="classattr">
                                        <input id="Photosequence.unload-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unload</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.unload-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.unload"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.unload-170"><a href="#Photosequence.unload-170"><span class="linenos">170</span></a>    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence.unload-171"><a href="#Photosequence.unload-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes the plugin menu item and icon from QGIS GUI.&quot;&quot;&quot;</span>
</span><span id="Photosequence.unload-172"><a href="#Photosequence.unload-172"><span class="linenos">172</span></a>        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
</span><span id="Photosequence.unload-173"><a href="#Photosequence.unload-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removePluginMenu</span><span class="p">(</span>
</span><span id="Photosequence.unload-174"><a href="#Photosequence.unload-174"><span class="linenos">174</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;photosequence&#39;</span><span class="p">),</span>
</span><span id="Photosequence.unload-175"><a href="#Photosequence.unload-175"><span class="linenos">175</span></a>                <span class="n">action</span><span class="p">)</span>
</span><span id="Photosequence.unload-176"><a href="#Photosequence.unload-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removeToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes the plugin menu item and icon from QGIS GUI.</p>
</div>


                            </div>
                            <div id="Photosequence.BrowseFilesXml" class="classattr">
                                        <input id="Photosequence.BrowseFilesXml-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">BrowseFilesXml</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lineEdit</span>, </span><span class="param"><span class="n">file_type</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.BrowseFilesXml-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.BrowseFilesXml"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.BrowseFilesXml-178"><a href="#Photosequence.BrowseFilesXml-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">,</span> <span class="n">file_type</span><span class="p">):</span>
</span><span id="Photosequence.BrowseFilesXml-179"><a href="#Photosequence.BrowseFilesXml-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;calibration&#39;</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesXml-180"><a href="#Photosequence.BrowseFilesXml-180"><span class="linenos">180</span></a>            <span class="c1"># pour le fichier de calibration de al camra</span>
</span><span id="Photosequence.BrowseFilesXml-181"><a href="#Photosequence.BrowseFilesXml-181"><span class="linenos">181</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open Calibration File&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;XML files (*.xml)&#39;</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesXml-182"><a href="#Photosequence.BrowseFilesXml-182"><span class="linenos">182</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesXml-183"><a href="#Photosequence.BrowseFilesXml-183"><span class="linenos">183</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesXml-184"><a href="#Photosequence.BrowseFilesXml-184"><span class="linenos">184</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesXml-185"><a href="#Photosequence.BrowseFilesXml-185"><span class="linenos">185</span></a>        <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesXml-186"><a href="#Photosequence.BrowseFilesXml-186"><span class="linenos">186</span></a>            <span class="c1"># pour le fichier d&#39;orientation</span>
</span><span id="Photosequence.BrowseFilesXml-187"><a href="#Photosequence.BrowseFilesXml-187"><span class="linenos">187</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open Orientation File&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;XML files (*.xml)&#39;</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesXml-188"><a href="#Photosequence.BrowseFilesXml-188"><span class="linenos">188</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesXml-189"><a href="#Photosequence.BrowseFilesXml-189"><span class="linenos">189</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesXml-190"><a href="#Photosequence.BrowseFilesXml-190"><span class="linenos">190</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.BrowseFilesGPKG" class="classattr">
                                        <input id="Photosequence.BrowseFilesGPKG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">BrowseFilesGPKG</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lineEdit</span>, </span><span class="param"><span class="n">file_type</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.BrowseFilesGPKG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.BrowseFilesGPKG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.BrowseFilesGPKG-192"><a href="#Photosequence.BrowseFilesGPKG-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesGPKG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">,</span> <span class="n">file_type</span><span class="p">):</span>
</span><span id="Photosequence.BrowseFilesGPKG-193"><a href="#Photosequence.BrowseFilesGPKG-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesGPKG-194"><a href="#Photosequence.BrowseFilesGPKG-194"><span class="linenos">194</span></a>            <span class="c1"># pour le fichierde mise en place absolue de camra</span>
</span><span id="Photosequence.BrowseFilesGPKG-195"><a href="#Photosequence.BrowseFilesGPKG-195"><span class="linenos">195</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open line trajectory file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence.BrowseFilesGPKG-196"><a href="#Photosequence.BrowseFilesGPKG-196"><span class="linenos">196</span></a>                                                <span class="s1">&#39;GPKG files (*.gpkg)&#39;</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesGPKG-197"><a href="#Photosequence.BrowseFilesGPKG-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesGPKG-198"><a href="#Photosequence.BrowseFilesGPKG-198"><span class="linenos">198</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesGPKG-199"><a href="#Photosequence.BrowseFilesGPKG-199"><span class="linenos">199</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesGPKG-200"><a href="#Photosequence.BrowseFilesGPKG-200"><span class="linenos">200</span></a>        <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesGPKG-201"><a href="#Photosequence.BrowseFilesGPKG-201"><span class="linenos">201</span></a>            <span class="c1"># pour le fichier de calibration de al camra</span>
</span><span id="Photosequence.BrowseFilesGPKG-202"><a href="#Photosequence.BrowseFilesGPKG-202"><span class="linenos">202</span></a>            <span class="n">fname</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Open point trajectory file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence.BrowseFilesGPKG-203"><a href="#Photosequence.BrowseFilesGPKG-203"><span class="linenos">203</span></a>                                                <span class="s1">&#39;GPKG files (*.gpkg)&#39;</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesGPKG-204"><a href="#Photosequence.BrowseFilesGPKG-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="n">fname</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesGPKG-205"><a href="#Photosequence.BrowseFilesGPKG-205"><span class="linenos">205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesGPKG-206"><a href="#Photosequence.BrowseFilesGPKG-206"><span class="linenos">206</span></a>                <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.BrowseFilesIMG" class="classattr">
                                        <input id="Photosequence.BrowseFilesIMG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">BrowseFilesIMG</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lineEdit</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.BrowseFilesIMG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.BrowseFilesIMG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.BrowseFilesIMG-208"><a href="#Photosequence.BrowseFilesIMG-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">BrowseFilesIMG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">):</span>
</span><span id="Photosequence.BrowseFilesIMG-209"><a href="#Photosequence.BrowseFilesIMG-209"><span class="linenos">209</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Select image(s) directory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence.BrowseFilesIMG-210"><a href="#Photosequence.BrowseFilesIMG-210"><span class="linenos">210</span></a>                                                     <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>
</span><span id="Photosequence.BrowseFilesIMG-211"><a href="#Photosequence.BrowseFilesIMG-211"><span class="linenos">211</span></a>        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
</span><span id="Photosequence.BrowseFilesIMG-212"><a href="#Photosequence.BrowseFilesIMG-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Photosequence.BrowseFilesIMG-213"><a href="#Photosequence.BrowseFilesIMG-213"><span class="linenos">213</span></a>            <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.BrowseOutputFile" class="classattr">
                                        <input id="Photosequence.BrowseOutputFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">BrowseOutputFile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lineEdit</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.BrowseOutputFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.BrowseOutputFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.BrowseOutputFile-215"><a href="#Photosequence.BrowseOutputFile-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="nf">BrowseOutputFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineEdit</span><span class="p">):</span>
</span><span id="Photosequence.BrowseOutputFile-216"><a href="#Photosequence.BrowseOutputFile-216"><span class="linenos">216</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s1">&#39;Select output directory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Photosequence.BrowseOutputFile-217"><a href="#Photosequence.BrowseOutputFile-217"><span class="linenos">217</span></a>                                                     <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>
</span><span id="Photosequence.BrowseOutputFile-218"><a href="#Photosequence.BrowseOutputFile-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
</span><span id="Photosequence.BrowseOutputFile-219"><a href="#Photosequence.BrowseOutputFile-219"><span class="linenos">219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Photosequence.BrowseOutputFile-220"><a href="#Photosequence.BrowseOutputFile-220"><span class="linenos">220</span></a>            <span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.add_png_to_qgis_project" class="classattr">
                                        <input id="Photosequence.add_png_to_qgis_project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_png_to_qgis_project</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">project_path</span>, </span><span class="param"><span class="n">png_path</span>, </span><span class="param"><span class="n">epsg</span>, </span><span class="param"><span class="n">transparence</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.add_png_to_qgis_project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.add_png_to_qgis_project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.add_png_to_qgis_project-222"><a href="#Photosequence.add_png_to_qgis_project-222"><span class="linenos">222</span></a>    <span class="k">def</span> <span class="nf">add_png_to_qgis_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">,</span> <span class="n">png_path</span><span class="p">,</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">transparence</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Photosequence.add_png_to_qgis_project-223"><a href="#Photosequence.add_png_to_qgis_project-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.add_png_to_qgis_project-224"><a href="#Photosequence.add_png_to_qgis_project-224"><span class="linenos">224</span></a><span class="sd">        Ajoute une couche d&#39;image PNG  un projet QGIS existant et retourne la couche ajoute.</span>
</span><span id="Photosequence.add_png_to_qgis_project-225"><a href="#Photosequence.add_png_to_qgis_project-225"><span class="linenos">225</span></a><span class="sd">        Si &#39;transparence&#39; est True, applique la transparence sur la couche.</span>
</span><span id="Photosequence.add_png_to_qgis_project-226"><a href="#Photosequence.add_png_to_qgis_project-226"><span class="linenos">226</span></a><span class="sd">        </span>
</span><span id="Photosequence.add_png_to_qgis_project-227"><a href="#Photosequence.add_png_to_qgis_project-227"><span class="linenos">227</span></a><span class="sd">        :param project_path: Chemin du projet QGIS existant (.qgs ou .qgz).</span>
</span><span id="Photosequence.add_png_to_qgis_project-228"><a href="#Photosequence.add_png_to_qgis_project-228"><span class="linenos">228</span></a><span class="sd">        :param png_path: Chemin de l&#39;image PNG  ajouter comme couche raster.</span>
</span><span id="Photosequence.add_png_to_qgis_project-229"><a href="#Photosequence.add_png_to_qgis_project-229"><span class="linenos">229</span></a><span class="sd">        :param transparence: Boolen indiquant si la transparence doit tre applique (True ou False).</span>
</span><span id="Photosequence.add_png_to_qgis_project-230"><a href="#Photosequence.add_png_to_qgis_project-230"><span class="linenos">230</span></a><span class="sd">        :return: La couche raster ajoute au projet.</span>
</span><span id="Photosequence.add_png_to_qgis_project-231"><a href="#Photosequence.add_png_to_qgis_project-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.add_png_to_qgis_project-232"><a href="#Photosequence.add_png_to_qgis_project-232"><span class="linenos">232</span></a>        <span class="c1"># Charger le projet existant</span>
</span><span id="Photosequence.add_png_to_qgis_project-233"><a href="#Photosequence.add_png_to_qgis_project-233"><span class="linenos">233</span></a>        <span class="n">project</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
</span><span id="Photosequence.add_png_to_qgis_project-234"><a href="#Photosequence.add_png_to_qgis_project-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="Photosequence.add_png_to_qgis_project-235"><a href="#Photosequence.add_png_to_qgis_project-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de lire le projet QGIS : </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-236"><a href="#Photosequence.add_png_to_qgis_project-236"><span class="linenos">236</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-237"><a href="#Photosequence.add_png_to_qgis_project-237"><span class="linenos">237</span></a>        <span class="c1"># Crer une couche raster  partir du PNG</span>
</span><span id="Photosequence.add_png_to_qgis_project-238"><a href="#Photosequence.add_png_to_qgis_project-238"><span class="linenos">238</span></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">png_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Nom de la couche bas sur le fichier</span>
</span><span id="Photosequence.add_png_to_qgis_project-239"><a href="#Photosequence.add_png_to_qgis_project-239"><span class="linenos">239</span></a>        <span class="n">raster_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">png_path</span><span class="p">,</span> <span class="n">layer_name</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-240"><a href="#Photosequence.add_png_to_qgis_project-240"><span class="linenos">240</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-241"><a href="#Photosequence.add_png_to_qgis_project-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="Photosequence.add_png_to_qgis_project-242"><a href="#Photosequence.add_png_to_qgis_project-242"><span class="linenos">242</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : La couche raster base sur </span><span class="si">{</span><span class="n">png_path</span><span class="si">}</span><span class="s2"> n&#39;est pas valide.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-243"><a href="#Photosequence.add_png_to_qgis_project-243"><span class="linenos">243</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-244"><a href="#Photosequence.add_png_to_qgis_project-244"><span class="linenos">244</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-245"><a href="#Photosequence.add_png_to_qgis_project-245"><span class="linenos">245</span></a>        <span class="n">raster_layer</span><span class="o">.</span><span class="n">setCrs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-246"><a href="#Photosequence.add_png_to_qgis_project-246"><span class="linenos">246</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-247"><a href="#Photosequence.add_png_to_qgis_project-247"><span class="linenos">247</span></a>        <span class="c1"># Ajouter la couche raster au projet</span>
</span><span id="Photosequence.add_png_to_qgis_project-248"><a href="#Photosequence.add_png_to_qgis_project-248"><span class="linenos">248</span></a>        <span class="n">project</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">raster_layer</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-249"><a href="#Photosequence.add_png_to_qgis_project-249"><span class="linenos">249</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couche raster ajoute : </span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-250"><a href="#Photosequence.add_png_to_qgis_project-250"><span class="linenos">250</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-251"><a href="#Photosequence.add_png_to_qgis_project-251"><span class="linenos">251</span></a>        <span class="c1"># Si transparence est active, appliquer la transparence  la couche</span>
</span><span id="Photosequence.add_png_to_qgis_project-252"><a href="#Photosequence.add_png_to_qgis_project-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">transparence</span><span class="p">:</span>
</span><span id="Photosequence.add_png_to_qgis_project-253"><a href="#Photosequence.add_png_to_qgis_project-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="n">raster_layer</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raster_layer</span><span class="p">,</span> <span class="n">QgsRasterLayer</span><span class="p">):</span>
</span><span id="Photosequence.add_png_to_qgis_project-254"><a href="#Photosequence.add_png_to_qgis_project-254"><span class="linenos">254</span></a>                <span class="n">transparency</span> <span class="o">=</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">renderer</span><span class="p">()</span><span class="o">.</span><span class="n">rasterTransparency</span><span class="p">()</span>
</span><span id="Photosequence.add_png_to_qgis_project-255"><a href="#Photosequence.add_png_to_qgis_project-255"><span class="linenos">255</span></a>                <span class="n">transparent_pixel</span> <span class="o">=</span> <span class="n">QgsRasterTransparency</span><span class="o">.</span><span class="n">TransparentThreeValuePixel</span><span class="p">()</span>
</span><span id="Photosequence.add_png_to_qgis_project-256"><a href="#Photosequence.add_png_to_qgis_project-256"><span class="linenos">256</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">blue</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence.add_png_to_qgis_project-257"><a href="#Photosequence.add_png_to_qgis_project-257"><span class="linenos">257</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">green</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence.add_png_to_qgis_project-258"><a href="#Photosequence.add_png_to_qgis_project-258"><span class="linenos">258</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">red</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence.add_png_to_qgis_project-259"><a href="#Photosequence.add_png_to_qgis_project-259"><span class="linenos">259</span></a>                <span class="n">transparent_pixel</span><span class="o">.</span><span class="n">percentTransparent</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Photosequence.add_png_to_qgis_project-260"><a href="#Photosequence.add_png_to_qgis_project-260"><span class="linenos">260</span></a>                <span class="n">transparency</span><span class="o">.</span><span class="n">setTransparentThreeValuePixelList</span><span class="p">([</span><span class="n">transparent_pixel</span><span class="p">])</span>
</span><span id="Photosequence.add_png_to_qgis_project-261"><a href="#Photosequence.add_png_to_qgis_project-261"><span class="linenos">261</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-262"><a href="#Photosequence.add_png_to_qgis_project-262"><span class="linenos">262</span></a>                <span class="c1"># Rafrachir la couche pour que la transparence soit applique</span>
</span><span id="Photosequence.add_png_to_qgis_project-263"><a href="#Photosequence.add_png_to_qgis_project-263"><span class="linenos">263</span></a>                <span class="n">raster_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="Photosequence.add_png_to_qgis_project-264"><a href="#Photosequence.add_png_to_qgis_project-264"><span class="linenos">264</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transparence applique  la couche : </span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-265"><a href="#Photosequence.add_png_to_qgis_project-265"><span class="linenos">265</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-266"><a href="#Photosequence.add_png_to_qgis_project-266"><span class="linenos">266</span></a>        <span class="c1"># Sauvegarder le projet</span>
</span><span id="Photosequence.add_png_to_qgis_project-267"><a href="#Photosequence.add_png_to_qgis_project-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="o">.</span><span class="n">write</span><span class="p">():</span>
</span><span id="Photosequence.add_png_to_qgis_project-268"><a href="#Photosequence.add_png_to_qgis_project-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Erreur lors de la sauvegarde du projet QGIS.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-269"><a href="#Photosequence.add_png_to_qgis_project-269"><span class="linenos">269</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projet sauvegard avec succs : </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.add_png_to_qgis_project-270"><a href="#Photosequence.add_png_to_qgis_project-270"><span class="linenos">270</span></a>
</span><span id="Photosequence.add_png_to_qgis_project-271"><a href="#Photosequence.add_png_to_qgis_project-271"><span class="linenos">271</span></a>        <span class="c1"># Retourner la couche ajoute</span>
</span><span id="Photosequence.add_png_to_qgis_project-272"><a href="#Photosequence.add_png_to_qgis_project-272"><span class="linenos">272</span></a>        <span class="k">return</span> <span class="n">raster_layer</span>
</span></pre></div>


            <div class="docstring"><p>Ajoute une couche d'image PNG  un projet QGIS existant et retourne la couche ajoute.
Si 'transparence' est True, applique la transparence sur la couche.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>project_path</strong>:  Chemin du projet QGIS existant (.qgs ou .qgz).</li>
<li><strong>png_path</strong>:  Chemin de l'image PNG  ajouter comme couche raster.</li>
<li><strong>transparence</strong>:  Boolen indiquant si la transparence doit tre applique (True ou False).</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>La couche raster ajoute au projet.</p>
</blockquote>
</div>


                            </div>
                            <div id="Photosequence.get_attribute_values" class="classattr">
                                        <input id="Photosequence.get_attribute_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_attribute_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">gpkg_path</span>, </span><span class="param"><span class="n">attribute_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.get_attribute_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.get_attribute_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.get_attribute_values-274"><a href="#Photosequence.get_attribute_values-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">get_attribute_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gpkg_path</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">):</span>
</span><span id="Photosequence.get_attribute_values-275"><a href="#Photosequence.get_attribute_values-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.get_attribute_values-276"><a href="#Photosequence.get_attribute_values-276"><span class="linenos">276</span></a><span class="sd">        Rcupre les valeurs d&#39;un attribut spcifique dans un fichier GeoPackage.</span>
</span><span id="Photosequence.get_attribute_values-277"><a href="#Photosequence.get_attribute_values-277"><span class="linenos">277</span></a><span class="sd">    </span>
</span><span id="Photosequence.get_attribute_values-278"><a href="#Photosequence.get_attribute_values-278"><span class="linenos">278</span></a><span class="sd">        :param gpkg_path: Chemin vers le fichier GeoPackage (.gpkg)</span>
</span><span id="Photosequence.get_attribute_values-279"><a href="#Photosequence.get_attribute_values-279"><span class="linenos">279</span></a><span class="sd">        :param attribute_name: Nom de l&#39;attribut  rcuprer</span>
</span><span id="Photosequence.get_attribute_values-280"><a href="#Photosequence.get_attribute_values-280"><span class="linenos">280</span></a><span class="sd">        :return: Liste des valeurs de l&#39;attribut</span>
</span><span id="Photosequence.get_attribute_values-281"><a href="#Photosequence.get_attribute_values-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.get_attribute_values-282"><a href="#Photosequence.get_attribute_values-282"><span class="linenos">282</span></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">gpkg_path</span><span class="p">,</span> <span class="s2">&quot;MyLayer&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
</span><span id="Photosequence.get_attribute_values-283"><a href="#Photosequence.get_attribute_values-283"><span class="linenos">283</span></a>
</span><span id="Photosequence.get_attribute_values-284"><a href="#Photosequence.get_attribute_values-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="Photosequence.get_attribute_values-285"><a href="#Photosequence.get_attribute_values-285"><span class="linenos">285</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de charger la couche GeoPackage : </span><span class="si">{</span><span class="n">gpkg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.get_attribute_values-286"><a href="#Photosequence.get_attribute_values-286"><span class="linenos">286</span></a>
</span><span id="Photosequence.get_attribute_values-287"><a href="#Photosequence.get_attribute_values-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="n">attribute_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
</span><span id="Photosequence.get_attribute_values-288"><a href="#Photosequence.get_attribute_values-288"><span class="linenos">288</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;attribut &#39;</span><span class="si">{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2">&#39; n&#39;existe pas dans la couche.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.get_attribute_values-289"><a href="#Photosequence.get_attribute_values-289"><span class="linenos">289</span></a>
</span><span id="Photosequence.get_attribute_values-290"><a href="#Photosequence.get_attribute_values-290"><span class="linenos">290</span></a>        <span class="n">attribute_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()]</span>
</span><span id="Photosequence.get_attribute_values-291"><a href="#Photosequence.get_attribute_values-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">attribute_values</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rcupre les valeurs d'un attribut spcifique dans un fichier GeoPackage.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>gpkg_path</strong>:  Chemin vers le fichier GeoPackage (.gpkg)</li>
<li><strong>attribute_name</strong>:  Nom de l'attribut  rcuprer</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Liste des valeurs de l'attribut</p>
</blockquote>
</div>


                            </div>
                            <div id="Photosequence.list2pts3D" class="classattr">
                                        <input id="Photosequence.list2pts3D-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list2pts3D</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">liste_coord</span>, </span><span class="param"><span class="n">output_file</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.list2pts3D-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.list2pts3D"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.list2pts3D-293"><a href="#Photosequence.list2pts3D-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">list2pts3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">liste_coord</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
</span><span id="Photosequence.list2pts3D-294"><a href="#Photosequence.list2pts3D-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.list2pts3D-295"><a href="#Photosequence.list2pts3D-295"><span class="linenos">295</span></a><span class="sd">        Permet de transformer une liste de coordonnes en fichier XML pour MicMac.</span>
</span><span id="Photosequence.list2pts3D-296"><a href="#Photosequence.list2pts3D-296"><span class="linenos">296</span></a><span class="sd">        </span>
</span><span id="Photosequence.list2pts3D-297"><a href="#Photosequence.list2pts3D-297"><span class="linenos">297</span></a><span class="sd">        :param liste_coord: Liste de coordonnes x, y, z de taille (3, n), </span>
</span><span id="Photosequence.list2pts3D-298"><a href="#Photosequence.list2pts3D-298"><span class="linenos">298</span></a><span class="sd">                             par exemple : [[x1, x2, ...], [y1, y2, ...], [z1, z2, ...]].</span>
</span><span id="Photosequence.list2pts3D-299"><a href="#Photosequence.list2pts3D-299"><span class="linenos">299</span></a><span class="sd">        :param output_file: Chemin du fichier XML  gnrer.</span>
</span><span id="Photosequence.list2pts3D-300"><a href="#Photosequence.list2pts3D-300"><span class="linenos">300</span></a><span class="sd">        :return: Un fichier xml au format MicMac des points pour utiliser mm3d SimplePredict</span>
</span><span id="Photosequence.list2pts3D-301"><a href="#Photosequence.list2pts3D-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.list2pts3D-302"><a href="#Photosequence.list2pts3D-302"><span class="linenos">302</span></a>        <span class="c1"># Vrifier que la liste est dans le bon format</span>
</span><span id="Photosequence.list2pts3D-303"><a href="#Photosequence.list2pts3D-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">liste_coord</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">liste_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">liste_coord</span><span class="p">):</span>
</span><span id="Photosequence.list2pts3D-304"><a href="#Photosequence.list2pts3D-304"><span class="linenos">304</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Photosequence.list2pts3D-305"><a href="#Photosequence.list2pts3D-305"><span class="linenos">305</span></a>                <span class="s2">&quot;La liste des coordonnes doit tre au format [[x1, x2, ...], [y1, y2, ...], [z1, z2, ...]].&quot;</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-306"><a href="#Photosequence.list2pts3D-306"><span class="linenos">306</span></a>
</span><span id="Photosequence.list2pts3D-307"><a href="#Photosequence.list2pts3D-307"><span class="linenos">307</span></a>        <span class="c1"># Crer l&#39;lment racine XML</span>
</span><span id="Photosequence.list2pts3D-308"><a href="#Photosequence.list2pts3D-308"><span class="linenos">308</span></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;DicoAppuisFlottant&quot;</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-309"><a href="#Photosequence.list2pts3D-309"><span class="linenos">309</span></a>
</span><span id="Photosequence.list2pts3D-310"><a href="#Photosequence.list2pts3D-310"><span class="linenos">310</span></a>        <span class="c1"># Ajouter les coordonnes au fichier XML</span>
</span><span id="Photosequence.list2pts3D-311"><a href="#Photosequence.list2pts3D-311"><span class="linenos">311</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">liste_coord</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Photosequence.list2pts3D-312"><a href="#Photosequence.list2pts3D-312"><span class="linenos">312</span></a>            <span class="n">one_appuis_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;OneAppuisDAF&quot;</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-313"><a href="#Photosequence.list2pts3D-313"><span class="linenos">313</span></a>
</span><span id="Photosequence.list2pts3D-314"><a href="#Photosequence.list2pts3D-314"><span class="linenos">314</span></a>            <span class="c1"># Ajouter l&#39;lment Pt avec les coordonnes x, y, z</span>
</span><span id="Photosequence.list2pts3D-315"><a href="#Photosequence.list2pts3D-315"><span class="linenos">315</span></a>            <span class="n">pt_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;Pt&quot;</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-316"><a href="#Photosequence.list2pts3D-316"><span class="linenos">316</span></a>            <span class="n">pt_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Photosequence.list2pts3D-317"><a href="#Photosequence.list2pts3D-317"><span class="linenos">317</span></a>
</span><span id="Photosequence.list2pts3D-318"><a href="#Photosequence.list2pts3D-318"><span class="linenos">318</span></a>            <span class="c1"># Ajouter le nom du point (NamePt)</span>
</span><span id="Photosequence.list2pts3D-319"><a href="#Photosequence.list2pts3D-319"><span class="linenos">319</span></a>            <span class="n">name_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;NamePt&quot;</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-320"><a href="#Photosequence.list2pts3D-320"><span class="linenos">320</span></a>            <span class="n">name_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-321"><a href="#Photosequence.list2pts3D-321"><span class="linenos">321</span></a>
</span><span id="Photosequence.list2pts3D-322"><a href="#Photosequence.list2pts3D-322"><span class="linenos">322</span></a>            <span class="c1"># Ajouter l&#39;incertitude</span>
</span><span id="Photosequence.list2pts3D-323"><a href="#Photosequence.list2pts3D-323"><span class="linenos">323</span></a>            <span class="n">incertitude_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">one_appuis_elem</span><span class="p">,</span> <span class="s2">&quot;Incertitude&quot;</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-324"><a href="#Photosequence.list2pts3D-324"><span class="linenos">324</span></a>            <span class="n">incertitude_elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;1 1 1&quot;</span>
</span><span id="Photosequence.list2pts3D-325"><a href="#Photosequence.list2pts3D-325"><span class="linenos">325</span></a>
</span><span id="Photosequence.list2pts3D-326"><a href="#Photosequence.list2pts3D-326"><span class="linenos">326</span></a>        <span class="c1"># Crer l&#39;arbre XML et l&#39;crire dans le fichier</span>
</span><span id="Photosequence.list2pts3D-327"><a href="#Photosequence.list2pts3D-327"><span class="linenos">327</span></a>        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</span><span id="Photosequence.list2pts3D-328"><a href="#Photosequence.list2pts3D-328"><span class="linenos">328</span></a>        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Permet de transformer une liste de coordonnes en fichier XML pour MicMac.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>liste_coord</strong>:  Liste de coordonnes x, y, z de taille (3, n), 
par exemple : [[x1, x2, ...], [y1, y2, ...], [z1, z2, ...]].</li>
<li><strong>output_file</strong>:  Chemin du fichier XML  gnrer.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Un fichier xml au format MicMac des points pour utiliser mm3d SimplePredict</p>
</blockquote>
</div>


                            </div>
                            <div id="Photosequence.extract_rotation_translation" class="classattr">
                                        <input id="Photosequence.extract_rotation_translation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_rotation_translation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xml_filepath</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.extract_rotation_translation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.extract_rotation_translation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.extract_rotation_translation-330"><a href="#Photosequence.extract_rotation_translation-330"><span class="linenos">330</span></a>    <span class="k">def</span> <span class="nf">extract_rotation_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_filepath</span><span class="p">):</span>
</span><span id="Photosequence.extract_rotation_translation-331"><a href="#Photosequence.extract_rotation_translation-331"><span class="linenos">331</span></a>        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml_filepath</span><span class="p">)</span>
</span><span id="Photosequence.extract_rotation_translation-332"><a href="#Photosequence.extract_rotation_translation-332"><span class="linenos">332</span></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
</span><span id="Photosequence.extract_rotation_translation-333"><a href="#Photosequence.extract_rotation_translation-333"><span class="linenos">333</span></a>
</span><span id="Photosequence.extract_rotation_translation-334"><a href="#Photosequence.extract_rotation_translation-334"><span class="linenos">334</span></a>        <span class="c1"># Extraire la matrice de rotation qui est dans la balise externe</span>
</span><span id="Photosequence.extract_rotation_translation-335"><a href="#Photosequence.extract_rotation_translation-335"><span class="linenos">335</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.extract_rotation_translation-336"><a href="#Photosequence.extract_rotation_translation-336"><span class="linenos">336</span></a>        <span class="n">param_rotation</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//Externe/ParamRotation/CodageMatr&#39;</span><span class="p">)</span>
</span><span id="Photosequence.extract_rotation_translation-337"><a href="#Photosequence.extract_rotation_translation-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">param_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Photosequence.extract_rotation_translation-338"><a href="#Photosequence.extract_rotation_translation-338"><span class="linenos">338</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="Photosequence.extract_rotation_translation-339"><a href="#Photosequence.extract_rotation_translation-339"><span class="linenos">339</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="Photosequence.extract_rotation_translation-340"><a href="#Photosequence.extract_rotation_translation-340"><span class="linenos">340</span></a>            <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">param_rotation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;L3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
</span><span id="Photosequence.extract_rotation_translation-341"><a href="#Photosequence.extract_rotation_translation-341"><span class="linenos">341</span></a>
</span><span id="Photosequence.extract_rotation_translation-342"><a href="#Photosequence.extract_rotation_translation-342"><span class="linenos">342</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">)</span>  <span class="c1"># Convertir en array (3, 3)</span>
</span><span id="Photosequence.extract_rotation_translation-343"><a href="#Photosequence.extract_rotation_translation-343"><span class="linenos">343</span></a>
</span><span id="Photosequence.extract_rotation_translation-344"><a href="#Photosequence.extract_rotation_translation-344"><span class="linenos">344</span></a>        <span class="c1"># Extraire le vecteur de translation (Centre)</span>
</span><span id="Photosequence.extract_rotation_translation-345"><a href="#Photosequence.extract_rotation_translation-345"><span class="linenos">345</span></a>        <span class="n">centre</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//Externe/Centre&#39;</span><span class="p">)</span>
</span><span id="Photosequence.extract_rotation_translation-346"><a href="#Photosequence.extract_rotation_translation-346"><span class="linenos">346</span></a>        <span class="n">translation_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Photosequence.extract_rotation_translation-347"><a href="#Photosequence.extract_rotation_translation-347"><span class="linenos">347</span></a>            <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">centre</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()))])</span> <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># Convertir en array (1, 3)</span>
</span><span id="Photosequence.extract_rotation_translation-348"><a href="#Photosequence.extract_rotation_translation-348"><span class="linenos">348</span></a>
</span><span id="Photosequence.extract_rotation_translation-349"><a href="#Photosequence.extract_rotation_translation-349"><span class="linenos">349</span></a>        <span class="k">return</span> <span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">translation_vector</span><span class="o">.</span><span class="n">T</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.csv_to_dict" class="classattr">
                                        <input id="Photosequence.csv_to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">csv_to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filepath</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.csv_to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.csv_to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.csv_to_dict-351"><a href="#Photosequence.csv_to_dict-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="nf">csv_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
</span><span id="Photosequence.csv_to_dict-352"><a href="#Photosequence.csv_to_dict-352"><span class="linenos">352</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Photosequence.csv_to_dict-353"><a href="#Photosequence.csv_to_dict-353"><span class="linenos">353</span></a>            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span><span id="Photosequence.csv_to_dict-354"><a href="#Photosequence.csv_to_dict-354"><span class="linenos">354</span></a>            <span class="c1"># On retourne le dictionnaire de la premire ligne</span>
</span><span id="Photosequence.csv_to_dict-355"><a href="#Photosequence.csv_to_dict-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.World2Camera" class="classattr">
                                        <input id="Photosequence.World2Camera-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">World2Camera</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">R</span>, </span><span class="param"><span class="n">C</span>, </span><span class="param"><span class="n">P</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.World2Camera-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.World2Camera"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.World2Camera-357"><a href="#Photosequence.World2Camera-357"><span class="linenos">357</span></a>    <span class="k">def</span> <span class="nf">World2Camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
</span><span id="Photosequence.World2Camera-358"><a href="#Photosequence.World2Camera-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.Cam2Bundle" class="classattr">
                                        <input id="Photosequence.Cam2Bundle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Cam2Bundle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pt3d</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.Cam2Bundle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.Cam2Bundle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.Cam2Bundle-360"><a href="#Photosequence.Cam2Bundle-360"><span class="linenos">360</span></a>    <span class="k">def</span> <span class="nf">Cam2Bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt3d</span><span class="p">):</span>
</span><span id="Photosequence.Cam2Bundle-361"><a href="#Photosequence.Cam2Bundle-361"><span class="linenos">361</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">pt3d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">pt3d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.RadDistOnBundle" class="classattr">
                                        <input id="Photosequence.RadDistOnBundle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">RadDistOnBundle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">coeffs</span>, </span><span class="param"><span class="n">bundle</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.RadDistOnBundle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.RadDistOnBundle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.RadDistOnBundle-363"><a href="#Photosequence.RadDistOnBundle-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">RadDistOnBundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
</span><span id="Photosequence.RadDistOnBundle-364"><a href="#Photosequence.RadDistOnBundle-364"><span class="linenos">364</span></a>        <span class="n">rho2</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="Photosequence.RadDistOnBundle-365"><a href="#Photosequence.RadDistOnBundle-365"><span class="linenos">365</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeffs</span><span class="p">))</span>
</span><span id="Photosequence.RadDistOnBundle-366"><a href="#Photosequence.RadDistOnBundle-366"><span class="linenos">366</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="p">),</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.Bundle2Pixel" class="classattr">
                                        <input id="Photosequence.Bundle2Pixel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Bundle2Pixel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">f</span>, </span><span class="param"><span class="n">PP_x</span>, </span><span class="param"><span class="n">PP_y</span>, </span><span class="param"><span class="n">bundle</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.Bundle2Pixel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.Bundle2Pixel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.Bundle2Pixel-368"><a href="#Photosequence.Bundle2Pixel-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">Bundle2Pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">PP_x</span><span class="p">,</span> <span class="n">PP_y</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
</span><span id="Photosequence.Bundle2Pixel-369"><a href="#Photosequence.Bundle2Pixel-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">PP_x</span><span class="p">,</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">PP_y</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="Photosequence.TransfoCoord" class="classattr">
                                        <input id="Photosequence.TransfoCoord-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">TransfoCoord</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">calib</span>, </span><span class="param"><span class="n">orientation</span>, </span><span class="param"><span class="n">TablCoord</span>, </span><span class="param"><span class="n">img</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.TransfoCoord-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.TransfoCoord"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.TransfoCoord-371"><a href="#Photosequence.TransfoCoord-371"><span class="linenos">371</span></a>    <span class="k">def</span> <span class="nf">TransfoCoord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">TablCoord</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
</span><span id="Photosequence.TransfoCoord-372"><a href="#Photosequence.TransfoCoord-372"><span class="linenos">372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.TransfoCoord-373"><a href="#Photosequence.TransfoCoord-373"><span class="linenos">373</span></a><span class="sd">        Transforme des coordonnes 3D en coordonnes 2D dans une image en appliquant les tapes de la chane</span>
</span><span id="Photosequence.TransfoCoord-374"><a href="#Photosequence.TransfoCoord-374"><span class="linenos">374</span></a><span class="sd">        de calibration, de projection et de distorsion.</span>
</span><span id="Photosequence.TransfoCoord-375"><a href="#Photosequence.TransfoCoord-375"><span class="linenos">375</span></a><span class="sd">        </span>
</span><span id="Photosequence.TransfoCoord-376"><a href="#Photosequence.TransfoCoord-376"><span class="linenos">376</span></a><span class="sd">        Cette mthode prend un fichier de calibration (XML), une orientation (matrices de rotation et de translation),</span>
</span><span id="Photosequence.TransfoCoord-377"><a href="#Photosequence.TransfoCoord-377"><span class="linenos">377</span></a><span class="sd">        un tableau de coordonnes 3D, et une image pour produire une liste de points filtrs (en pixels) correspondant</span>
</span><span id="Photosequence.TransfoCoord-378"><a href="#Photosequence.TransfoCoord-378"><span class="linenos">378</span></a><span class="sd">        aux coordonnes projetes dans l&#39;image.</span>
</span><span id="Photosequence.TransfoCoord-379"><a href="#Photosequence.TransfoCoord-379"><span class="linenos">379</span></a><span class="sd">        </span>
</span><span id="Photosequence.TransfoCoord-380"><a href="#Photosequence.TransfoCoord-380"><span class="linenos">380</span></a><span class="sd">        :param calib: Chemin vers le fichier de calibration au format XML.</span>
</span><span id="Photosequence.TransfoCoord-381"><a href="#Photosequence.TransfoCoord-381"><span class="linenos">381</span></a><span class="sd">        :type calib: str</span>
</span><span id="Photosequence.TransfoCoord-382"><a href="#Photosequence.TransfoCoord-382"><span class="linenos">382</span></a><span class="sd">        :param orientation: Chemin vers le fichier contenant les matrices de rotation et de translation.</span>
</span><span id="Photosequence.TransfoCoord-383"><a href="#Photosequence.TransfoCoord-383"><span class="linenos">383</span></a><span class="sd">        :type orientation: str</span>
</span><span id="Photosequence.TransfoCoord-384"><a href="#Photosequence.TransfoCoord-384"><span class="linenos">384</span></a><span class="sd">        :param TablCoord: Tableau numpy contenant les coordonnes 3D  transformer (de forme Nx3).</span>
</span><span id="Photosequence.TransfoCoord-385"><a href="#Photosequence.TransfoCoord-385"><span class="linenos">385</span></a><span class="sd">        :type TablCoord: numpy.ndarray</span>
</span><span id="Photosequence.TransfoCoord-386"><a href="#Photosequence.TransfoCoord-386"><span class="linenos">386</span></a><span class="sd">        :param img: Chemin vers l&#39;image utilise pour filtrer les points en dehors des dimensions de l&#39;image.</span>
</span><span id="Photosequence.TransfoCoord-387"><a href="#Photosequence.TransfoCoord-387"><span class="linenos">387</span></a><span class="sd">        :type img: str</span>
</span><span id="Photosequence.TransfoCoord-388"><a href="#Photosequence.TransfoCoord-388"><span class="linenos">388</span></a><span class="sd">        </span>
</span><span id="Photosequence.TransfoCoord-389"><a href="#Photosequence.TransfoCoord-389"><span class="linenos">389</span></a><span class="sd">        :return: Un tuple contenant :</span>
</span><span id="Photosequence.TransfoCoord-390"><a href="#Photosequence.TransfoCoord-390"><span class="linenos">390</span></a><span class="sd">            - list: Liste des coordonnes 2D filtres (QgsPointXY) qui se trouvent  l&#39;intrieur des dimensions de l&#39;image.</span>
</span><span id="Photosequence.TransfoCoord-391"><a href="#Photosequence.TransfoCoord-391"><span class="linenos">391</span></a><span class="sd">            - list: Liste complte des coordonnes 2D projetes (incluant les outliers).</span>
</span><span id="Photosequence.TransfoCoord-392"><a href="#Photosequence.TransfoCoord-392"><span class="linenos">392</span></a><span class="sd">        :rtype: tuple</span>
</span><span id="Photosequence.TransfoCoord-393"><a href="#Photosequence.TransfoCoord-393"><span class="linenos">393</span></a><span class="sd">        </span>
</span><span id="Photosequence.TransfoCoord-394"><a href="#Photosequence.TransfoCoord-394"><span class="linenos">394</span></a><span class="sd">        :notes:</span>
</span><span id="Photosequence.TransfoCoord-395"><a href="#Photosequence.TransfoCoord-395"><span class="linenos">395</span></a><span class="sd">            - Les tapes de transformation incluent :</span>
</span><span id="Photosequence.TransfoCoord-396"><a href="#Photosequence.TransfoCoord-396"><span class="linenos">396</span></a><span class="sd">                1. Transformation du fichier de calibration XML en CSV.</span>
</span><span id="Photosequence.TransfoCoord-397"><a href="#Photosequence.TransfoCoord-397"><span class="linenos">397</span></a><span class="sd">                2. Extraction des matrices de rotation et du vecteur de translation.</span>
</span><span id="Photosequence.TransfoCoord-398"><a href="#Photosequence.TransfoCoord-398"><span class="linenos">398</span></a><span class="sd">                3. Application des distorsions radiales.</span>
</span><span id="Photosequence.TransfoCoord-399"><a href="#Photosequence.TransfoCoord-399"><span class="linenos">399</span></a><span class="sd">                4. Filtrage des points projets pour ne garder que ceux dans les limites de l&#39;image.</span>
</span><span id="Photosequence.TransfoCoord-400"><a href="#Photosequence.TransfoCoord-400"><span class="linenos">400</span></a><span class="sd">            - Les points hors des dimensions de l&#39;image sont exclus du rsultat final.</span>
</span><span id="Photosequence.TransfoCoord-401"><a href="#Photosequence.TransfoCoord-401"><span class="linenos">401</span></a><span class="sd">            - Les coordonnes retournes sont inverses en Y, pour correspondre au coordones image sur qgis.</span>
</span><span id="Photosequence.TransfoCoord-402"><a href="#Photosequence.TransfoCoord-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.TransfoCoord-403"><a href="#Photosequence.TransfoCoord-403"><span class="linenos">403</span></a>
</span><span id="Photosequence.TransfoCoord-404"><a href="#Photosequence.TransfoCoord-404"><span class="linenos">404</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 0 pour Incertitudes, 1 pour Angles</span>
</span><span id="Photosequence.TransfoCoord-405"><a href="#Photosequence.TransfoCoord-405"><span class="linenos">405</span></a>    
</span><span id="Photosequence.TransfoCoord-406"><a href="#Photosequence.TransfoCoord-406"><span class="linenos">406</span></a>        <span class="c1"># Convertir le fichier de calibration XML en CSV</span>
</span><span id="Photosequence.TransfoCoord-407"><a href="#Photosequence.TransfoCoord-407"><span class="linenos">407</span></a>        <span class="n">calib_converter</span> <span class="o">=</span> <span class="n">Calib2CSV</span><span class="p">(</span><span class="n">calib</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-408"><a href="#Photosequence.TransfoCoord-408"><span class="linenos">408</span></a>        <span class="n">calib_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>  <span class="c1"># Convertir le fichier XML en CSV</span>
</span><span id="Photosequence.TransfoCoord-409"><a href="#Photosequence.TransfoCoord-409"><span class="linenos">409</span></a>    
</span><span id="Photosequence.TransfoCoord-410"><a href="#Photosequence.TransfoCoord-410"><span class="linenos">410</span></a>        <span class="n">calib_camera_csv</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-411"><a href="#Photosequence.TransfoCoord-411"><span class="linenos">411</span></a>    
</span><span id="Photosequence.TransfoCoord-412"><a href="#Photosequence.TransfoCoord-412"><span class="linenos">412</span></a>        <span class="c1"># Dictionnaire des variables de calibrations</span>
</span><span id="Photosequence.TransfoCoord-413"><a href="#Photosequence.TransfoCoord-413"><span class="linenos">413</span></a>        <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_to_dict</span><span class="p">(</span><span class="n">calib_camera_csv</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-414"><a href="#Photosequence.TransfoCoord-414"><span class="linenos">414</span></a>    
</span><span id="Photosequence.TransfoCoord-415"><a href="#Photosequence.TransfoCoord-415"><span class="linenos">415</span></a>        <span class="n">R</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_rotation_translation</span><span class="p">(</span>
</span><span id="Photosequence.TransfoCoord-416"><a href="#Photosequence.TransfoCoord-416"><span class="linenos">416</span></a>            <span class="n">orientation</span><span class="p">)</span>  <span class="c1"># Rcupration des matrices de rotation et vecteurs de translation</span>
</span><span id="Photosequence.TransfoCoord-417"><a href="#Photosequence.TransfoCoord-417"><span class="linenos">417</span></a>        <span class="n">coeffs_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_1&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_2&#39;</span><span class="p">]),</span>
</span><span id="Photosequence.TransfoCoord-418"><a href="#Photosequence.TransfoCoord-418"><span class="linenos">418</span></a>                               <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDist_3&#39;</span><span class="p">])])</span>  <span class="c1"># Cration du vecteur K1, K2, K3</span>
</span><span id="Photosequence.TransfoCoord-419"><a href="#Photosequence.TransfoCoord-419"><span class="linenos">419</span></a>        <span class="n">coeffs_rad_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Photosequence.TransfoCoord-420"><a href="#Photosequence.TransfoCoord-420"><span class="linenos">420</span></a>            <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_1&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_2&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_3&#39;</span><span class="p">]),</span>
</span><span id="Photosequence.TransfoCoord-421"><a href="#Photosequence.TransfoCoord-421"><span class="linenos">421</span></a>             <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CoeffDistInv_4&#39;</span><span class="p">])])</span>
</span><span id="Photosequence.TransfoCoord-422"><a href="#Photosequence.TransfoCoord-422"><span class="linenos">422</span></a>    
</span><span id="Photosequence.TransfoCoord-423"><a href="#Photosequence.TransfoCoord-423"><span class="linenos">423</span></a>        <span class="n">L_Coord</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.TransfoCoord-424"><a href="#Photosequence.TransfoCoord-424"><span class="linenos">424</span></a>    
</span><span id="Photosequence.TransfoCoord-425"><a href="#Photosequence.TransfoCoord-425"><span class="linenos">425</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">TablCoord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># Boucle sur tous les points  transformer</span>
</span><span id="Photosequence.TransfoCoord-426"><a href="#Photosequence.TransfoCoord-426"><span class="linenos">426</span></a>            <span class="c1"># World to camera frame</span>
</span><span id="Photosequence.TransfoCoord-427"><a href="#Photosequence.TransfoCoord-427"><span class="linenos">427</span></a>            <span class="n">ptCam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">World2Camera</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">TablCoord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># Reshape pour vecteurs</span>
</span><span id="Photosequence.TransfoCoord-428"><a href="#Photosequence.TransfoCoord-428"><span class="linenos">428</span></a>            <span class="c1"># Camera frame to bundle</span>
</span><span id="Photosequence.TransfoCoord-429"><a href="#Photosequence.TransfoCoord-429"><span class="linenos">429</span></a>            <span class="n">ptBun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cam2Bundle</span><span class="p">(</span><span class="n">ptCam</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-430"><a href="#Photosequence.TransfoCoord-430"><span class="linenos">430</span></a>            <span class="c1"># Application des distorsions radiales</span>
</span><span id="Photosequence.TransfoCoord-431"><a href="#Photosequence.TransfoCoord-431"><span class="linenos">431</span></a>            <span class="n">ptDist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadDistOnBundle</span><span class="p">(</span><span class="n">coeffs_rad</span><span class="p">,</span> <span class="n">ptBun</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-432"><a href="#Photosequence.TransfoCoord-432"><span class="linenos">432</span></a>            <span class="c1"># Bundle to pixel</span>
</span><span id="Photosequence.TransfoCoord-433"><a href="#Photosequence.TransfoCoord-433"><span class="linenos">433</span></a>            <span class="n">pt2Dproj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bundle2Pixel</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CDist_X&#39;</span><span class="p">]),</span>
</span><span id="Photosequence.TransfoCoord-434"><a href="#Photosequence.TransfoCoord-434"><span class="linenos">434</span></a>                                         <span class="nb">float</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;CDist_Y&#39;</span><span class="p">]),</span> <span class="n">ptDist</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-435"><a href="#Photosequence.TransfoCoord-435"><span class="linenos">435</span></a>            <span class="n">L_Coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt2Dproj</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-436"><a href="#Photosequence.TransfoCoord-436"><span class="linenos">436</span></a>    
</span><span id="Photosequence.TransfoCoord-437"><a href="#Photosequence.TransfoCoord-437"><span class="linenos">437</span></a>        <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Photosequence.TransfoCoord-438"><a href="#Photosequence.TransfoCoord-438"><span class="linenos">438</span></a>        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence.TransfoCoord-439"><a href="#Photosequence.TransfoCoord-439"><span class="linenos">439</span></a>    
</span><span id="Photosequence.TransfoCoord-440"><a href="#Photosequence.TransfoCoord-440"><span class="linenos">440</span></a>        <span class="c1"># Filtrer les points pour ne garder que ceux dans les dimensions de l&#39;image</span>
</span><span id="Photosequence.TransfoCoord-441"><a href="#Photosequence.TransfoCoord-441"><span class="linenos">441</span></a>        <span class="n">coord_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">L_Coord</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">]</span>
</span><span id="Photosequence.TransfoCoord-442"><a href="#Photosequence.TransfoCoord-442"><span class="linenos">442</span></a>    
</span><span id="Photosequence.TransfoCoord-443"><a href="#Photosequence.TransfoCoord-443"><span class="linenos">443</span></a>        <span class="c1"># Traiter les coordonnes sans outliers</span>
</span><span id="Photosequence.TransfoCoord-444"><a href="#Photosequence.TransfoCoord-444"><span class="linenos">444</span></a>        <span class="n">coord_wo_outliers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.TransfoCoord-445"><a href="#Photosequence.TransfoCoord-445"><span class="linenos">445</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">)):</span>
</span><span id="Photosequence.TransfoCoord-446"><a href="#Photosequence.TransfoCoord-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">L_Coord</span><span class="p">[</span><span class="n">L_Coord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">coord_filtered</span><span class="p">):</span>
</span><span id="Photosequence.TransfoCoord-447"><a href="#Photosequence.TransfoCoord-447"><span class="linenos">447</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L_Coord</span><span class="p">[</span><span class="n">L_Coord</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Photosequence.TransfoCoord-448"><a href="#Photosequence.TransfoCoord-448"><span class="linenos">448</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Photosequence.TransfoCoord-449"><a href="#Photosequence.TransfoCoord-449"><span class="linenos">449</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Photosequence.TransfoCoord-450"><a href="#Photosequence.TransfoCoord-450"><span class="linenos">450</span></a>                <span class="n">coord_wo_outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord_filtered</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Photosequence.TransfoCoord-451"><a href="#Photosequence.TransfoCoord-451"><span class="linenos">451</span></a>    
</span><span id="Photosequence.TransfoCoord-452"><a href="#Photosequence.TransfoCoord-452"><span class="linenos">452</span></a>        <span class="c1"># Transformation des coordonnes en QgsPointXY</span>
</span><span id="Photosequence.TransfoCoord-453"><a href="#Photosequence.TransfoCoord-453"><span class="linenos">453</span></a>        <span class="n">coord_XY</span> <span class="o">=</span> <span class="p">[</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_wo_outliers</span><span class="p">]</span>
</span><span id="Photosequence.TransfoCoord-454"><a href="#Photosequence.TransfoCoord-454"><span class="linenos">454</span></a>    
</span><span id="Photosequence.TransfoCoord-455"><a href="#Photosequence.TransfoCoord-455"><span class="linenos">455</span></a>        <span class="k">return</span> <span class="n">coord_XY</span><span class="p">,</span> <span class="n">L_Coord</span>
</span></pre></div>


            <div class="docstring"><p>Transforme des coordonnes 3D en coordonnes 2D dans une image en appliquant les tapes de la chane
de calibration, de projection et de distorsion.</p>

<p>Cette mthode prend un fichier de calibration (XML), une orientation (matrices de rotation et de translation),
un tableau de coordonnes 3D, et une image pour produire une liste de points filtrs (en pixels) correspondant
aux coordonnes projetes dans l'image.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>calib</strong>:  Chemin vers le fichier de calibration au format XML.</li>
<li><strong>orientation</strong>:  Chemin vers le fichier contenant les matrices de rotation et de translation.</li>
<li><strong>TablCoord</strong>:  Tableau numpy contenant les coordonnes 3D  transformer (de forme Nx3).</li>
<li><strong>img</strong>:  Chemin vers l'image utilise pour filtrer les points en dehors des dimensions de l'image.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Un tuple contenant :
      - list: Liste des coordonnes 2D filtres (QgsPointXY) qui se trouvent  l'intrieur des dimensions de l'image.
      - list: Liste complte des coordonnes 2D projetes (incluant les outliers).</p>
</blockquote>

<p>:notes:
    - Les tapes de transformation incluent :
        1. Transformation du fichier de calibration XML en CSV.
        2. Extraction des matrices de rotation et du vecteur de translation.
        3. Application des distorsions radiales.
        4. Filtrage des points projets pour ne garder que ceux dans les limites de l'image.
    - Les points hors des dimensions de l'image sont exclus du rsultat final.
    - Les coordonnes retournes sont inverses en Y, pour correspondre au coordones image sur qgis.</p>
</div>


                            </div>
                            <div id="Photosequence.execute_mm3d_simplepredict" class="classattr">
                                        <input id="Photosequence.execute_mm3d_simplepredict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">execute_mm3d_simplepredict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.execute_mm3d_simplepredict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.execute_mm3d_simplepredict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.execute_mm3d_simplepredict-458"><a href="#Photosequence.execute_mm3d_simplepredict-458"><span class="linenos">458</span></a>    <span class="k">def</span> <span class="nf">execute_mm3d_simplepredict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-459"><a href="#Photosequence.execute_mm3d_simplepredict-459"><span class="linenos">459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-460"><a href="#Photosequence.execute_mm3d_simplepredict-460"><span class="linenos">460</span></a><span class="sd">        Excute la commande MicMac `mm3d SimplePredict`.</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-461"><a href="#Photosequence.execute_mm3d_simplepredict-461"><span class="linenos">461</span></a><span class="sd">        </span>
</span><span id="Photosequence.execute_mm3d_simplepredict-462"><a href="#Photosequence.execute_mm3d_simplepredict-462"><span class="linenos">462</span></a><span class="sd">        Commande excute : </span>
</span><span id="Photosequence.execute_mm3d_simplepredict-463"><a href="#Photosequence.execute_mm3d_simplepredict-463"><span class="linenos">463</span></a><span class="sd">            mm3d SimplePredict &quot;*.JPG&quot; Ori-Absolut/ Points3D.xml</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-464"><a href="#Photosequence.execute_mm3d_simplepredict-464"><span class="linenos">464</span></a><span class="sd">        </span>
</span><span id="Photosequence.execute_mm3d_simplepredict-465"><a href="#Photosequence.execute_mm3d_simplepredict-465"><span class="linenos">465</span></a><span class="sd">        :return: La sortie standard de la commande si elle s&#39;excute avec succs, ou None si une erreur survient.</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-466"><a href="#Photosequence.execute_mm3d_simplepredict-466"><span class="linenos">466</span></a><span class="sd">        :rtype: str | None</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-467"><a href="#Photosequence.execute_mm3d_simplepredict-467"><span class="linenos">467</span></a><span class="sd">        </span>
</span><span id="Photosequence.execute_mm3d_simplepredict-468"><a href="#Photosequence.execute_mm3d_simplepredict-468"><span class="linenos">468</span></a><span class="sd">        :raises subprocess.CalledProcessError: Si la commande choue et que `check=True` est activ.</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-469"><a href="#Photosequence.execute_mm3d_simplepredict-469"><span class="linenos">469</span></a><span class="sd">        </span>
</span><span id="Photosequence.execute_mm3d_simplepredict-470"><a href="#Photosequence.execute_mm3d_simplepredict-470"><span class="linenos">470</span></a><span class="sd">        :notes:</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-471"><a href="#Photosequence.execute_mm3d_simplepredict-471"><span class="linenos">471</span></a><span class="sd">            - Les fichiers requis doivent tre prsents dans les rpertoires appropris pour que la commande aboutisse</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-472"><a href="#Photosequence.execute_mm3d_simplepredict-472"><span class="linenos">472</span></a><span class="sd">              (images JPG, orientation absolue et fichier Points3D.xml).</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-473"><a href="#Photosequence.execute_mm3d_simplepredict-473"><span class="linenos">473</span></a><span class="sd">            - Les logs sont crits dans la console de QGIS via `QgsMessageLog`.</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-474"><a href="#Photosequence.execute_mm3d_simplepredict-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-475"><a href="#Photosequence.execute_mm3d_simplepredict-475"><span class="linenos">475</span></a>
</span><span id="Photosequence.execute_mm3d_simplepredict-476"><a href="#Photosequence.execute_mm3d_simplepredict-476"><span class="linenos">476</span></a>
</span><span id="Photosequence.execute_mm3d_simplepredict-477"><a href="#Photosequence.execute_mm3d_simplepredict-477"><span class="linenos">477</span></a>        <span class="c1"># commande micmac </span>
</span><span id="Photosequence.execute_mm3d_simplepredict-478"><a href="#Photosequence.execute_mm3d_simplepredict-478"><span class="linenos">478</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mm3d&#39;</span><span class="p">,</span> <span class="s1">&#39;SimplePredict&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;.*.JPG&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;Ori-Absolut/&#39;</span><span class="p">,</span> <span class="s1">&#39;Points3D.xml&#39;</span><span class="p">]</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-479"><a href="#Photosequence.execute_mm3d_simplepredict-479"><span class="linenos">479</span></a>    
</span><span id="Photosequence.execute_mm3d_simplepredict-480"><a href="#Photosequence.execute_mm3d_simplepredict-480"><span class="linenos">480</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-481"><a href="#Photosequence.execute_mm3d_simplepredict-481"><span class="linenos">481</span></a>            <span class="c1"># Excuter la commande et sauver la sortie</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-482"><a href="#Photosequence.execute_mm3d_simplepredict-482"><span class="linenos">482</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-483"><a href="#Photosequence.execute_mm3d_simplepredict-483"><span class="linenos">483</span></a>    
</span><span id="Photosequence.execute_mm3d_simplepredict-484"><a href="#Photosequence.execute_mm3d_simplepredict-484"><span class="linenos">484</span></a>            <span class="c1"># Log de la sortie standard</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-485"><a href="#Photosequence.execute_mm3d_simplepredict-485"><span class="linenos">485</span></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-486"><a href="#Photosequence.execute_mm3d_simplepredict-486"><span class="linenos">486</span></a>            <span class="n">QgsMessageLog</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Commande excute avec succs : </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;PhotosequenceGen&quot;</span><span class="p">,</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-487"><a href="#Photosequence.execute_mm3d_simplepredict-487"><span class="linenos">487</span></a>            <span class="k">return</span> <span class="n">output</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-488"><a href="#Photosequence.execute_mm3d_simplepredict-488"><span class="linenos">488</span></a>        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-489"><a href="#Photosequence.execute_mm3d_simplepredict-489"><span class="linenos">489</span></a>            <span class="c1"># Log en cas d&#39;erreur</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-490"><a href="#Photosequence.execute_mm3d_simplepredict-490"><span class="linenos">490</span></a>            <span class="n">QgsMessageLog</span><span class="o">.</span><span class="n">logMessage</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur lors de l&#39;excution : </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;PhotosequenceGen&quot;</span><span class="p">,</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
</span><span id="Photosequence.execute_mm3d_simplepredict-491"><a href="#Photosequence.execute_mm3d_simplepredict-491"><span class="linenos">491</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Excute la commande MicMac <code>mm3d SimplePredict</code>.</p>

<p>Commande excute : 
    mm3d SimplePredict "*.JPG" Ori-Absolut/ Points3D.xml</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>La sortie standard de la commande si elle s'excute avec succs, ou None si une erreur survient.</p>
</blockquote>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>subprocess.CalledProcessError</strong>:  Si la commande choue et que <code>check=True</code> est activ.</li>
</ul>

<p>:notes:
    - Les fichiers requis doivent tre prsents dans les rpertoires appropris pour que la commande aboutisse
      (images JPG, orientation absolue et fichier Points3D.xml).
    - Les logs sont crits dans la console de QGIS via <code>QgsMessageLog</code>.</p>
</div>


                            </div>
                            <div id="Photosequence.creer_projet_qgis" class="classattr">
                                        <input id="Photosequence.creer_projet_qgis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">creer_projet_qgis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outputdir</span>, </span><span class="param"><span class="n">epsg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.creer_projet_qgis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.creer_projet_qgis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.creer_projet_qgis-494"><a href="#Photosequence.creer_projet_qgis-494"><span class="linenos">494</span></a>    <span class="k">def</span> <span class="nf">creer_projet_qgis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputdir</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence.creer_projet_qgis-495"><a href="#Photosequence.creer_projet_qgis-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.creer_projet_qgis-496"><a href="#Photosequence.creer_projet_qgis-496"><span class="linenos">496</span></a><span class="sd">        Cre un projet QGIS  et retourne le chemin d&#39;accs au fichier cr.</span>
</span><span id="Photosequence.creer_projet_qgis-497"><a href="#Photosequence.creer_projet_qgis-497"><span class="linenos">497</span></a><span class="sd">    </span>
</span><span id="Photosequence.creer_projet_qgis-498"><a href="#Photosequence.creer_projet_qgis-498"><span class="linenos">498</span></a><span class="sd">        Parameters</span>
</span><span id="Photosequence.creer_projet_qgis-499"><a href="#Photosequence.creer_projet_qgis-499"><span class="linenos">499</span></a><span class="sd">        ----------</span>
</span><span id="Photosequence.creer_projet_qgis-500"><a href="#Photosequence.creer_projet_qgis-500"><span class="linenos">500</span></a><span class="sd">        self : instance</span>
</span><span id="Photosequence.creer_projet_qgis-501"><a href="#Photosequence.creer_projet_qgis-501"><span class="linenos">501</span></a><span class="sd">            Instance de la classe qui contient cette mthode.</span>
</span><span id="Photosequence.creer_projet_qgis-502"><a href="#Photosequence.creer_projet_qgis-502"><span class="linenos">502</span></a><span class="sd">        outputdir : str</span>
</span><span id="Photosequence.creer_projet_qgis-503"><a href="#Photosequence.creer_projet_qgis-503"><span class="linenos">503</span></a><span class="sd">            Chemin du rpertoire o le projet QGIS sera cr.</span>
</span><span id="Photosequence.creer_projet_qgis-504"><a href="#Photosequence.creer_projet_qgis-504"><span class="linenos">504</span></a><span class="sd">    </span>
</span><span id="Photosequence.creer_projet_qgis-505"><a href="#Photosequence.creer_projet_qgis-505"><span class="linenos">505</span></a><span class="sd">        Returns</span>
</span><span id="Photosequence.creer_projet_qgis-506"><a href="#Photosequence.creer_projet_qgis-506"><span class="linenos">506</span></a><span class="sd">        -------</span>
</span><span id="Photosequence.creer_projet_qgis-507"><a href="#Photosequence.creer_projet_qgis-507"><span class="linenos">507</span></a><span class="sd">        str</span>
</span><span id="Photosequence.creer_projet_qgis-508"><a href="#Photosequence.creer_projet_qgis-508"><span class="linenos">508</span></a><span class="sd">            Chemin complet du fichier projet QGIS cr, ou None en cas d&#39;erreur.</span>
</span><span id="Photosequence.creer_projet_qgis-509"><a href="#Photosequence.creer_projet_qgis-509"><span class="linenos">509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.creer_projet_qgis-510"><a href="#Photosequence.creer_projet_qgis-510"><span class="linenos">510</span></a>        <span class="c1"># Vrifier si le dossier de sortie existe</span>
</span><span id="Photosequence.creer_projet_qgis-511"><a href="#Photosequence.creer_projet_qgis-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputdir</span><span class="p">):</span>
</span><span id="Photosequence.creer_projet_qgis-512"><a href="#Photosequence.creer_projet_qgis-512"><span class="linenos">512</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : Le dossier </span><span class="si">{</span><span class="n">outputdir</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_projet_qgis-513"><a href="#Photosequence.creer_projet_qgis-513"><span class="linenos">513</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Photosequence.creer_projet_qgis-514"><a href="#Photosequence.creer_projet_qgis-514"><span class="linenos">514</span></a>
</span><span id="Photosequence.creer_projet_qgis-515"><a href="#Photosequence.creer_projet_qgis-515"><span class="linenos">515</span></a>        <span class="c1"># Vrifier si le chemin est un rpertoire</span>
</span><span id="Photosequence.creer_projet_qgis-516"><a href="#Photosequence.creer_projet_qgis-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outputdir</span><span class="p">):</span>
</span><span id="Photosequence.creer_projet_qgis-517"><a href="#Photosequence.creer_projet_qgis-517"><span class="linenos">517</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : </span><span class="si">{</span><span class="n">outputdir</span><span class="si">}</span><span class="s2"> n&#39;est pas un rpertoire.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_projet_qgis-518"><a href="#Photosequence.creer_projet_qgis-518"><span class="linenos">518</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Photosequence.creer_projet_qgis-519"><a href="#Photosequence.creer_projet_qgis-519"><span class="linenos">519</span></a>
</span><span id="Photosequence.creer_projet_qgis-520"><a href="#Photosequence.creer_projet_qgis-520"><span class="linenos">520</span></a>        <span class="c1"># Nom et chemin complet du fichier projet</span>
</span><span id="Photosequence.creer_projet_qgis-521"><a href="#Photosequence.creer_projet_qgis-521"><span class="linenos">521</span></a>        <span class="n">nom_projet</span> <span class="o">=</span> <span class="s2">&quot;photosequence.qgz&quot;</span>
</span><span id="Photosequence.creer_projet_qgis-522"><a href="#Photosequence.creer_projet_qgis-522"><span class="linenos">522</span></a>        <span class="n">chemin_projet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputdir</span><span class="p">,</span> <span class="n">nom_projet</span><span class="p">)</span>
</span><span id="Photosequence.creer_projet_qgis-523"><a href="#Photosequence.creer_projet_qgis-523"><span class="linenos">523</span></a>
</span><span id="Photosequence.creer_projet_qgis-524"><a href="#Photosequence.creer_projet_qgis-524"><span class="linenos">524</span></a>        <span class="c1"># Crer un projet QGIS vierge</span>
</span><span id="Photosequence.creer_projet_qgis-525"><a href="#Photosequence.creer_projet_qgis-525"><span class="linenos">525</span></a>        <span class="n">projet</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
</span><span id="Photosequence.creer_projet_qgis-526"><a href="#Photosequence.creer_projet_qgis-526"><span class="linenos">526</span></a>        <span class="n">projet</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Nettoyer le projet actuel pour garantir qu&#39;il est vierge</span>
</span><span id="Photosequence.creer_projet_qgis-527"><a href="#Photosequence.creer_projet_qgis-527"><span class="linenos">527</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_projet_qgis-528"><a href="#Photosequence.creer_projet_qgis-528"><span class="linenos">528</span></a>        <span class="n">projet</span><span class="o">.</span><span class="n">setCrs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="Photosequence.creer_projet_qgis-529"><a href="#Photosequence.creer_projet_qgis-529"><span class="linenos">529</span></a>
</span><span id="Photosequence.creer_projet_qgis-530"><a href="#Photosequence.creer_projet_qgis-530"><span class="linenos">530</span></a>        <span class="c1"># Enregistrer le projet dans le rpertoire spcifi</span>
</span><span id="Photosequence.creer_projet_qgis-531"><a href="#Photosequence.creer_projet_qgis-531"><span class="linenos">531</span></a>        <span class="k">if</span> <span class="n">projet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chemin_projet</span><span class="p">):</span>
</span><span id="Photosequence.creer_projet_qgis-532"><a href="#Photosequence.creer_projet_qgis-532"><span class="linenos">532</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projet QGIS vierge cr avec succs : </span><span class="si">{</span><span class="n">chemin_projet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_projet_qgis-533"><a href="#Photosequence.creer_projet_qgis-533"><span class="linenos">533</span></a>            <span class="k">return</span> <span class="n">chemin_projet</span>
</span><span id="Photosequence.creer_projet_qgis-534"><a href="#Photosequence.creer_projet_qgis-534"><span class="linenos">534</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Photosequence.creer_projet_qgis-535"><a href="#Photosequence.creer_projet_qgis-535"><span class="linenos">535</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : Impossible de crer le projet QGIS dans </span><span class="si">{</span><span class="n">chemin_projet</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_projet_qgis-536"><a href="#Photosequence.creer_projet_qgis-536"><span class="linenos">536</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Cre un projet QGIS  et retourne le chemin d'accs au fichier cr.</p>

<h2 id="parameters">Parameters</h2>

<p>self : instance
    Instance de la classe qui contient cette mthode.
outputdir : str
    Chemin du rpertoire o le projet QGIS sera cr.</p>

<h2 id="returns">Returns</h2>

<p>str
    Chemin complet du fichier projet QGIS cr, ou None en cas d'erreur.</p>
</div>


                            </div>
                            <div id="Photosequence.creer_points" class="classattr">
                                        <input id="Photosequence.creer_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">creer_points</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">trajectory_file</span>, </span><span class="param"><span class="n">OutputDir</span>, </span><span class="param"><span class="n">calib</span>, </span><span class="param"><span class="n">orientation</span>, </span><span class="param"><span class="n">img</span>, </span><span class="param"><span class="n">epsg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.creer_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.creer_points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.creer_points-538"><a href="#Photosequence.creer_points-538"><span class="linenos">538</span></a>    <span class="k">def</span> <span class="nf">creer_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory_file</span><span class="p">,</span> <span class="n">OutputDir</span><span class="p">,</span> <span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence.creer_points-539"><a href="#Photosequence.creer_points-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.creer_points-540"><a href="#Photosequence.creer_points-540"><span class="linenos">540</span></a><span class="sd">        Permet de crer une couche de points contenant les pinules et les labels de certains points de la trajectoire de l&#39;avion.</span>
</span><span id="Photosequence.creer_points-541"><a href="#Photosequence.creer_points-541"><span class="linenos">541</span></a><span class="sd">        </span>
</span><span id="Photosequence.creer_points-542"><a href="#Photosequence.creer_points-542"><span class="linenos">542</span></a><span class="sd">        :param trajectory_file: Couche vectorielle contenant les donnes de la trajectoire de vol avec des champs comme &#39;longitude&#39;, &#39;latitude&#39; et &#39;alt_m&#39;.</span>
</span><span id="Photosequence.creer_points-543"><a href="#Photosequence.creer_points-543"><span class="linenos">543</span></a><span class="sd">        :type trajectory_file: QgsVectorLayer</span>
</span><span id="Photosequence.creer_points-544"><a href="#Photosequence.creer_points-544"><span class="linenos">544</span></a><span class="sd">        :param OutputDir: Rpertoire de sortie o seront enregistres les donnes (non utilis dans cette fonction mais pass par convention).</span>
</span><span id="Photosequence.creer_points-545"><a href="#Photosequence.creer_points-545"><span class="linenos">545</span></a><span class="sd">        :type OutputDir: str</span>
</span><span id="Photosequence.creer_points-546"><a href="#Photosequence.creer_points-546"><span class="linenos">546</span></a><span class="sd">        :param calib: Chemin vers le fichier contenant les paramtres de calibration de la camra.</span>
</span><span id="Photosequence.creer_points-547"><a href="#Photosequence.creer_points-547"><span class="linenos">547</span></a><span class="sd">        :type calib: str</span>
</span><span id="Photosequence.creer_points-548"><a href="#Photosequence.creer_points-548"><span class="linenos">548</span></a><span class="sd">        :param orientation: Dictionnaire contenant les paramtres d&#39;orientation de la camra.</span>
</span><span id="Photosequence.creer_points-549"><a href="#Photosequence.creer_points-549"><span class="linenos">549</span></a><span class="sd">        :type orientation: dict</span>
</span><span id="Photosequence.creer_points-550"><a href="#Photosequence.creer_points-550"><span class="linenos">550</span></a><span class="sd">        :param img: Chemin du fichier image  utiliser pour la projection des points.</span>
</span><span id="Photosequence.creer_points-551"><a href="#Photosequence.creer_points-551"><span class="linenos">551</span></a><span class="sd">        :type img: str</span>
</span><span id="Photosequence.creer_points-552"><a href="#Photosequence.creer_points-552"><span class="linenos">552</span></a><span class="sd">        </span>
</span><span id="Photosequence.creer_points-553"><a href="#Photosequence.creer_points-553"><span class="linenos">553</span></a><span class="sd">        :return: Couche vectorielle contenant les points projets, ajoute au projet QGIS.</span>
</span><span id="Photosequence.creer_points-554"><a href="#Photosequence.creer_points-554"><span class="linenos">554</span></a><span class="sd">        :rtype: QgsVectorLayer</span>
</span><span id="Photosequence.creer_points-555"><a href="#Photosequence.creer_points-555"><span class="linenos">555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.creer_points-556"><a href="#Photosequence.creer_points-556"><span class="linenos">556</span></a>
</span><span id="Photosequence.creer_points-557"><a href="#Photosequence.creer_points-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">:</span>
</span><span id="Photosequence.creer_points-558"><a href="#Photosequence.creer_points-558"><span class="linenos">558</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_transformer</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-559"><a href="#Photosequence.creer_points-559"><span class="linenos">559</span></a>
</span><span id="Photosequence.creer_points-560"><a href="#Photosequence.creer_points-560"><span class="linenos">560</span></a>        <span class="c1"># Cration de la couche temporaire en mmoire</span>
</span><span id="Photosequence.creer_points-561"><a href="#Photosequence.creer_points-561"><span class="linenos">561</span></a>        <span class="n">point_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Point?crs=EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;points_photosequence&#39;</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-562"><a href="#Photosequence.creer_points-562"><span class="linenos">562</span></a>        <span class="n">provider</span> <span class="o">=</span> <span class="n">point_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
</span><span id="Photosequence.creer_points-563"><a href="#Photosequence.creer_points-563"><span class="linenos">563</span></a>
</span><span id="Photosequence.creer_points-564"><a href="#Photosequence.creer_points-564"><span class="linenos">564</span></a>        <span class="c1"># Ajout des champs provenant de la couche trajectory_file</span>
</span><span id="Photosequence.creer_points-565"><a href="#Photosequence.creer_points-565"><span class="linenos">565</span></a>        <span class="n">qgsfields</span> <span class="o">=</span> <span class="n">trajectory_file</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
</span><span id="Photosequence.creer_points-566"><a href="#Photosequence.creer_points-566"><span class="linenos">566</span></a>        <span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">(</span><span class="n">qgsfields</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-567"><a href="#Photosequence.creer_points-567"><span class="linenos">567</span></a>        <span class="n">point_layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</span><span id="Photosequence.creer_points-568"><a href="#Photosequence.creer_points-568"><span class="linenos">568</span></a>
</span><span id="Photosequence.creer_points-569"><a href="#Photosequence.creer_points-569"><span class="linenos">569</span></a>        <span class="c1"># Boucle pour ajouter les points  la couche</span>
</span><span id="Photosequence.creer_points-570"><a href="#Photosequence.creer_points-570"><span class="linenos">570</span></a>        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">trajectory_file</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
</span><span id="Photosequence.creer_points-571"><a href="#Photosequence.creer_points-571"><span class="linenos">571</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
</span><span id="Photosequence.creer_points-572"><a href="#Photosequence.creer_points-572"><span class="linenos">572</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</span><span id="Photosequence.creer_points-573"><a href="#Photosequence.creer_points-573"><span class="linenos">573</span></a>            <span class="n">altitude</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">]</span>
</span><span id="Photosequence.creer_points-574"><a href="#Photosequence.creer_points-574"><span class="linenos">574</span></a>
</span><span id="Photosequence.creer_points-575"><a href="#Photosequence.creer_points-575"><span class="linenos">575</span></a>            <span class="c1"># Transformation des coordonnes en systme RGF93</span>
</span><span id="Photosequence.creer_points-576"><a href="#Photosequence.creer_points-576"><span class="linenos">576</span></a>            <span class="n">point_wgs84</span> <span class="o">=</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-577"><a href="#Photosequence.creer_points-577"><span class="linenos">577</span></a>            <span class="n">point_proj_wo_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point_wgs84</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-578"><a href="#Photosequence.creer_points-578"><span class="linenos">578</span></a>            <span class="n">point_proj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">point_proj_wo_z</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj_wo_z</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">altitude</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-579"><a href="#Photosequence.creer_points-579"><span class="linenos">579</span></a>
</span><span id="Photosequence.creer_points-580"><a href="#Photosequence.creer_points-580"><span class="linenos">580</span></a>            <span class="c1"># Transformation en coordonnes d&#39;image</span>
</span><span id="Photosequence.creer_points-581"><a href="#Photosequence.creer_points-581"><span class="linenos">581</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">coord_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calib</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">point_proj</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-582"><a href="#Photosequence.creer_points-582"><span class="linenos">582</span></a>
</span><span id="Photosequence.creer_points-583"><a href="#Photosequence.creer_points-583"><span class="linenos">583</span></a>            <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-584"><a href="#Photosequence.creer_points-584"><span class="linenos">584</span></a>            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence.creer_points-585"><a href="#Photosequence.creer_points-585"><span class="linenos">585</span></a>
</span><span id="Photosequence.creer_points-586"><a href="#Photosequence.creer_points-586"><span class="linenos">586</span></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">:</span>
</span><span id="Photosequence.creer_points-587"><a href="#Photosequence.creer_points-587"><span class="linenos">587</span></a>                <span class="c1"># Cration de l&#39;entit avec les coordonnes de l&#39;image</span>
</span><span id="Photosequence.creer_points-588"><a href="#Photosequence.creer_points-588"><span class="linenos">588</span></a>                <span class="n">new_feature</span> <span class="o">=</span> <span class="n">feature</span>
</span><span id="Photosequence.creer_points-589"><a href="#Photosequence.creer_points-589"><span class="linenos">589</span></a>                <span class="n">new_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">coord_img</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Photosequence.creer_points-590"><a href="#Photosequence.creer_points-590"><span class="linenos">590</span></a>
</span><span id="Photosequence.creer_points-591"><a href="#Photosequence.creer_points-591"><span class="linenos">591</span></a>                <span class="c1"># Copie des attributs de trajecto_layer</span>
</span><span id="Photosequence.creer_points-592"><a href="#Photosequence.creer_points-592"><span class="linenos">592</span></a>                <span class="c1"># new_feature.setAttributes([feature[field.name()] for field in qgsfields])</span>
</span><span id="Photosequence.creer_points-593"><a href="#Photosequence.creer_points-593"><span class="linenos">593</span></a>
</span><span id="Photosequence.creer_points-594"><a href="#Photosequence.creer_points-594"><span class="linenos">594</span></a>                <span class="n">new_feature</span><span class="p">[</span><span class="s1">&#39;label_posx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span>
</span><span id="Photosequence.creer_points-595"><a href="#Photosequence.creer_points-595"><span class="linenos">595</span></a>                <span class="n">new_feature</span><span class="p">[</span><span class="s1">&#39;label_posy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span>
</span><span id="Photosequence.creer_points-596"><a href="#Photosequence.creer_points-596"><span class="linenos">596</span></a>
</span><span id="Photosequence.creer_points-597"><a href="#Photosequence.creer_points-597"><span class="linenos">597</span></a>                <span class="c1"># Ajout de l&#39;entit  la couche</span>
</span><span id="Photosequence.creer_points-598"><a href="#Photosequence.creer_points-598"><span class="linenos">598</span></a>                <span class="n">provider</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">new_feature</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-599"><a href="#Photosequence.creer_points-599"><span class="linenos">599</span></a>
</span><span id="Photosequence.creer_points-600"><a href="#Photosequence.creer_points-600"><span class="linenos">600</span></a>        <span class="c1"># Application du style  la couche (si le fichier de style existe)</span>
</span><span id="Photosequence.creer_points-601"><a href="#Photosequence.creer_points-601"><span class="linenos">601</span></a>        <span class="n">style_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;style_bea.qml&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-602"><a href="#Photosequence.creer_points-602"><span class="linenos">602</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">style_path</span><span class="p">):</span>
</span><span id="Photosequence.creer_points-603"><a href="#Photosequence.creer_points-603"><span class="linenos">603</span></a>            <span class="n">point_layer</span><span class="o">.</span><span class="n">loadNamedStyle</span><span class="p">(</span><span class="n">style_path</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-604"><a href="#Photosequence.creer_points-604"><span class="linenos">604</span></a>            <span class="n">point_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="Photosequence.creer_points-605"><a href="#Photosequence.creer_points-605"><span class="linenos">605</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Photosequence.creer_points-606"><a href="#Photosequence.creer_points-606"><span class="linenos">606</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : le fichier de style </span><span class="si">{</span><span class="n">style_path</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-607"><a href="#Photosequence.creer_points-607"><span class="linenos">607</span></a>
</span><span id="Photosequence.creer_points-608"><a href="#Photosequence.creer_points-608"><span class="linenos">608</span></a>        <span class="c1"># Ajouter la couche au projet QGIS</span>
</span><span id="Photosequence.creer_points-609"><a href="#Photosequence.creer_points-609"><span class="linenos">609</span></a>        <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">point_layer</span><span class="p">)</span>
</span><span id="Photosequence.creer_points-610"><a href="#Photosequence.creer_points-610"><span class="linenos">610</span></a>
</span><span id="Photosequence.creer_points-611"><a href="#Photosequence.creer_points-611"><span class="linenos">611</span></a>        <span class="c1"># Retourner la couche cre</span>
</span><span id="Photosequence.creer_points-612"><a href="#Photosequence.creer_points-612"><span class="linenos">612</span></a>        <span class="k">return</span> <span class="n">point_layer</span>
</span></pre></div>


            <div class="docstring"><p>Permet de crer une couche de points contenant les pinules et les labels de certains points de la trajectoire de l'avion.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>trajectory_file</strong>:  Couche vectorielle contenant les donnes de la trajectoire de vol avec des champs comme 'longitude', 'latitude' et 'alt_m'.</li>
<li><strong>OutputDir</strong>:  Rpertoire de sortie o seront enregistres les donnes (non utilis dans cette fonction mais pass par convention).</li>
<li><strong>calib</strong>:  Chemin vers le fichier contenant les paramtres de calibration de la camra.</li>
<li><strong>orientation</strong>:  Dictionnaire contenant les paramtres d'orientation de la camra.</li>
<li><strong>img</strong>:  Chemin du fichier image  utiliser pour la projection des points.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Couche vectorielle contenant les points projets, ajoute au projet QGIS.</p>
</blockquote>
</div>


                            </div>
                            <div id="Photosequence.creer_polygone" class="classattr">
                                        <input id="Photosequence.creer_polygone-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">creer_polygone</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">points_sol</span>, </span><span class="param"><span class="n">points_air</span>, </span><span class="param"><span class="n">epsg</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.creer_polygone-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.creer_polygone"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.creer_polygone-614"><a href="#Photosequence.creer_polygone-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">creer_polygone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points_sol</span><span class="p">,</span> <span class="n">points_air</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="Photosequence.creer_polygone-615"><a href="#Photosequence.creer_polygone-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.creer_polygone-616"><a href="#Photosequence.creer_polygone-616"><span class="linenos">616</span></a><span class="sd">        Permet de crer des polygones pour les points 2  2.</span>
</span><span id="Photosequence.creer_polygone-617"><a href="#Photosequence.creer_polygone-617"><span class="linenos">617</span></a><span class="sd">        </span>
</span><span id="Photosequence.creer_polygone-618"><a href="#Photosequence.creer_polygone-618"><span class="linenos">618</span></a><span class="sd">        Les polygones auront un contour rouge, et leur intrieur sera d&#39;un rouge plus clair. </span>
</span><span id="Photosequence.creer_polygone-619"><a href="#Photosequence.creer_polygone-619"><span class="linenos">619</span></a><span class="sd">        La table attributaire est remplie avec le numro du point et les coordonnes des points dans les airs.</span>
</span><span id="Photosequence.creer_polygone-620"><a href="#Photosequence.creer_polygone-620"><span class="linenos">620</span></a><span class="sd">        </span>
</span><span id="Photosequence.creer_polygone-621"><a href="#Photosequence.creer_polygone-621"><span class="linenos">621</span></a><span class="sd">        :param points_sol: Liste des positions de l&#39;avion au sol sous forme de QgsPointXY.</span>
</span><span id="Photosequence.creer_polygone-622"><a href="#Photosequence.creer_polygone-622"><span class="linenos">622</span></a><span class="sd">        :type points_sol: List[QgsPointXY]</span>
</span><span id="Photosequence.creer_polygone-623"><a href="#Photosequence.creer_polygone-623"><span class="linenos">623</span></a><span class="sd">        :param points_air: Liste des positions de la trace arienne de l&#39;avion sous forme de QgsPointXY.</span>
</span><span id="Photosequence.creer_polygone-624"><a href="#Photosequence.creer_polygone-624"><span class="linenos">624</span></a><span class="sd">        :type points_air: List[QgsPointXY]</span>
</span><span id="Photosequence.creer_polygone-625"><a href="#Photosequence.creer_polygone-625"><span class="linenos">625</span></a><span class="sd">        </span>
</span><span id="Photosequence.creer_polygone-626"><a href="#Photosequence.creer_polygone-626"><span class="linenos">626</span></a><span class="sd">        :return: Une couche de polygone</span>
</span><span id="Photosequence.creer_polygone-627"><a href="#Photosequence.creer_polygone-627"><span class="linenos">627</span></a><span class="sd">        :rtype: QgsVectorLayer</span>
</span><span id="Photosequence.creer_polygone-628"><a href="#Photosequence.creer_polygone-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.creer_polygone-629"><a href="#Photosequence.creer_polygone-629"><span class="linenos">629</span></a>
</span><span id="Photosequence.creer_polygone-630"><a href="#Photosequence.creer_polygone-630"><span class="linenos">630</span></a>        <span class="c1"># Crer une couche de polygones vide</span>
</span><span id="Photosequence.creer_polygone-631"><a href="#Photosequence.creer_polygone-631"><span class="linenos">631</span></a>        <span class="n">polygone_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Polygon?crs=EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Polygones&#39;</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-632"><a href="#Photosequence.creer_polygone-632"><span class="linenos">632</span></a>        <span class="n">provider</span> <span class="o">=</span> <span class="n">polygone_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
</span><span id="Photosequence.creer_polygone-633"><a href="#Photosequence.creer_polygone-633"><span class="linenos">633</span></a>
</span><span id="Photosequence.creer_polygone-634"><a href="#Photosequence.creer_polygone-634"><span class="linenos">634</span></a>        <span class="c1"># Ajouter les champs pour la table d&#39;attributs</span>
</span><span id="Photosequence.creer_polygone-635"><a href="#Photosequence.creer_polygone-635"><span class="linenos">635</span></a>        <span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span>
</span><span id="Photosequence.creer_polygone-636"><a href="#Photosequence.creer_polygone-636"><span class="linenos">636</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;num_point&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">),</span>
</span><span id="Photosequence.creer_polygone-637"><a href="#Photosequence.creer_polygone-637"><span class="linenos">637</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;x_air1&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence.creer_polygone-638"><a href="#Photosequence.creer_polygone-638"><span class="linenos">638</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;y_air1&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence.creer_polygone-639"><a href="#Photosequence.creer_polygone-639"><span class="linenos">639</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;x_air2&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence.creer_polygone-640"><a href="#Photosequence.creer_polygone-640"><span class="linenos">640</span></a>            <span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;y_air2&quot;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">),</span>
</span><span id="Photosequence.creer_polygone-641"><a href="#Photosequence.creer_polygone-641"><span class="linenos">641</span></a>        <span class="p">])</span>
</span><span id="Photosequence.creer_polygone-642"><a href="#Photosequence.creer_polygone-642"><span class="linenos">642</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
</span><span id="Photosequence.creer_polygone-643"><a href="#Photosequence.creer_polygone-643"><span class="linenos">643</span></a>
</span><span id="Photosequence.creer_polygone-644"><a href="#Photosequence.creer_polygone-644"><span class="linenos">644</span></a>        <span class="c1"># Ajouter les polygones pour chaque paire de points</span>
</span><span id="Photosequence.creer_polygone-645"><a href="#Photosequence.creer_polygone-645"><span class="linenos">645</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points_sol</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_air</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Photosequence.creer_polygone-646"><a href="#Photosequence.creer_polygone-646"><span class="linenos">646</span></a>            <span class="n">point_sol1</span> <span class="o">=</span> <span class="n">points_sol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Photosequence.creer_polygone-647"><a href="#Photosequence.creer_polygone-647"><span class="linenos">647</span></a>            <span class="n">point_sol2</span> <span class="o">=</span> <span class="n">points_sol</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence.creer_polygone-648"><a href="#Photosequence.creer_polygone-648"><span class="linenos">648</span></a>            <span class="n">point_air1</span> <span class="o">=</span> <span class="n">points_air</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Photosequence.creer_polygone-649"><a href="#Photosequence.creer_polygone-649"><span class="linenos">649</span></a>            <span class="n">point_air2</span> <span class="o">=</span> <span class="n">points_air</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence.creer_polygone-650"><a href="#Photosequence.creer_polygone-650"><span class="linenos">650</span></a>
</span><span id="Photosequence.creer_polygone-651"><a href="#Photosequence.creer_polygone-651"><span class="linenos">651</span></a>            <span class="c1"># Crer le polygone</span>
</span><span id="Photosequence.creer_polygone-652"><a href="#Photosequence.creer_polygone-652"><span class="linenos">652</span></a>            <span class="n">polygone</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPolygonXY</span><span class="p">([</span>
</span><span id="Photosequence.creer_polygone-653"><a href="#Photosequence.creer_polygone-653"><span class="linenos">653</span></a>                <span class="p">[</span><span class="n">point_sol1</span><span class="p">,</span> <span class="n">point_air1</span><span class="p">,</span> <span class="n">point_air2</span><span class="p">,</span> <span class="n">point_sol2</span><span class="p">]</span>
</span><span id="Photosequence.creer_polygone-654"><a href="#Photosequence.creer_polygone-654"><span class="linenos">654</span></a>            <span class="p">])</span>
</span><span id="Photosequence.creer_polygone-655"><a href="#Photosequence.creer_polygone-655"><span class="linenos">655</span></a>
</span><span id="Photosequence.creer_polygone-656"><a href="#Photosequence.creer_polygone-656"><span class="linenos">656</span></a>            <span class="c1"># Crer une entit avec les attributs</span>
</span><span id="Photosequence.creer_polygone-657"><a href="#Photosequence.creer_polygone-657"><span class="linenos">657</span></a>            <span class="n">feature</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
</span><span id="Photosequence.creer_polygone-658"><a href="#Photosequence.creer_polygone-658"><span class="linenos">658</span></a>            <span class="n">feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">polygone</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-659"><a href="#Photosequence.creer_polygone-659"><span class="linenos">659</span></a>            <span class="n">feature</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span>
</span><span id="Photosequence.creer_polygone-660"><a href="#Photosequence.creer_polygone-660"><span class="linenos">660</span></a>                <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Numro du point</span>
</span><span id="Photosequence.creer_polygone-661"><a href="#Photosequence.creer_polygone-661"><span class="linenos">661</span></a>                <span class="n">point_air1</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_air1</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span>  <span class="c1"># Coordonnes du premier point arien</span>
</span><span id="Photosequence.creer_polygone-662"><a href="#Photosequence.creer_polygone-662"><span class="linenos">662</span></a>                <span class="n">point_air2</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_air2</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>  <span class="c1"># Coordonnes du deuxime point arien</span>
</span><span id="Photosequence.creer_polygone-663"><a href="#Photosequence.creer_polygone-663"><span class="linenos">663</span></a>            <span class="p">])</span>
</span><span id="Photosequence.creer_polygone-664"><a href="#Photosequence.creer_polygone-664"><span class="linenos">664</span></a>            <span class="n">provider</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-665"><a href="#Photosequence.creer_polygone-665"><span class="linenos">665</span></a>
</span><span id="Photosequence.creer_polygone-666"><a href="#Photosequence.creer_polygone-666"><span class="linenos">666</span></a>        <span class="n">chemin_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-667"><a href="#Photosequence.creer_polygone-667"><span class="linenos">667</span></a>        <span class="n">repertoire_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">chemin_script</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-668"><a href="#Photosequence.creer_polygone-668"><span class="linenos">668</span></a>        <span class="n">style_path</span> <span class="o">=</span> <span class="n">repertoire_script</span> <span class="o">+</span> <span class="s1">&#39;/Polygones.qml&#39;</span>
</span><span id="Photosequence.creer_polygone-669"><a href="#Photosequence.creer_polygone-669"><span class="linenos">669</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">style_path</span><span class="p">):</span>
</span><span id="Photosequence.creer_polygone-670"><a href="#Photosequence.creer_polygone-670"><span class="linenos">670</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur : le fichier de style </span><span class="si">{</span><span class="n">style_path</span><span class="si">}</span><span class="s2"> n&#39;existe pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-671"><a href="#Photosequence.creer_polygone-671"><span class="linenos">671</span></a>
</span><span id="Photosequence.creer_polygone-672"><a href="#Photosequence.creer_polygone-672"><span class="linenos">672</span></a>            <span class="k">return</span>
</span><span id="Photosequence.creer_polygone-673"><a href="#Photosequence.creer_polygone-673"><span class="linenos">673</span></a>
</span><span id="Photosequence.creer_polygone-674"><a href="#Photosequence.creer_polygone-674"><span class="linenos">674</span></a>        <span class="c1"># Charger le style .qml</span>
</span><span id="Photosequence.creer_polygone-675"><a href="#Photosequence.creer_polygone-675"><span class="linenos">675</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">loadNamedStyle</span><span class="p">(</span><span class="n">style_path</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-676"><a href="#Photosequence.creer_polygone-676"><span class="linenos">676</span></a>
</span><span id="Photosequence.creer_polygone-677"><a href="#Photosequence.creer_polygone-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">polygone_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
</span><span id="Photosequence.creer_polygone-678"><a href="#Photosequence.creer_polygone-678"><span class="linenos">678</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erreur : le style n&#39;a pas pu tre appliqu.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-679"><a href="#Photosequence.creer_polygone-679"><span class="linenos">679</span></a>            <span class="k">return</span>
</span><span id="Photosequence.creer_polygone-680"><a href="#Photosequence.creer_polygone-680"><span class="linenos">680</span></a>
</span><span id="Photosequence.creer_polygone-681"><a href="#Photosequence.creer_polygone-681"><span class="linenos">681</span></a>        <span class="c1"># Appliquer le style et redessiner la couche</span>
</span><span id="Photosequence.creer_polygone-682"><a href="#Photosequence.creer_polygone-682"><span class="linenos">682</span></a>        <span class="n">polygone_layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>
</span><span id="Photosequence.creer_polygone-683"><a href="#Photosequence.creer_polygone-683"><span class="linenos">683</span></a>
</span><span id="Photosequence.creer_polygone-684"><a href="#Photosequence.creer_polygone-684"><span class="linenos">684</span></a>        <span class="c1"># Confirmer que le style a t appliqu</span>
</span><span id="Photosequence.creer_polygone-685"><a href="#Photosequence.creer_polygone-685"><span class="linenos">685</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Style appliqu avec succs.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-686"><a href="#Photosequence.creer_polygone-686"><span class="linenos">686</span></a>
</span><span id="Photosequence.creer_polygone-687"><a href="#Photosequence.creer_polygone-687"><span class="linenos">687</span></a>        <span class="c1"># Ajouter la couche au projet</span>
</span><span id="Photosequence.creer_polygone-688"><a href="#Photosequence.creer_polygone-688"><span class="linenos">688</span></a>        <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">polygone_layer</span><span class="p">)</span>
</span><span id="Photosequence.creer_polygone-689"><a href="#Photosequence.creer_polygone-689"><span class="linenos">689</span></a>
</span><span id="Photosequence.creer_polygone-690"><a href="#Photosequence.creer_polygone-690"><span class="linenos">690</span></a>        <span class="c1"># Retourner la couche cre</span>
</span><span id="Photosequence.creer_polygone-691"><a href="#Photosequence.creer_polygone-691"><span class="linenos">691</span></a>        <span class="k">return</span> <span class="n">polygone_layer</span>
</span></pre></div>


            <div class="docstring"><p>Permet de crer des polygones pour les points 2  2.</p>

<p>Les polygones auront un contour rouge, et leur intrieur sera d'un rouge plus clair. 
La table attributaire est remplie avec le numro du point et les coordonnes des points dans les airs.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>points_sol</strong>:  Liste des positions de l'avion au sol sous forme de QgsPointXY.</li>
<li><strong>points_air</strong>:  Liste des positions de la trace arienne de l'avion sous forme de QgsPointXY.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Une couche de polygone</p>
</blockquote>
</div>


                            </div>
                            <div id="Photosequence.reset_dialog" class="classattr">
                                        <input id="Photosequence.reset_dialog-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_dialog</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.reset_dialog-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.reset_dialog"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.reset_dialog-693"><a href="#Photosequence.reset_dialog-693"><span class="linenos">693</span></a>    <span class="k">def</span> <span class="nf">reset_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence.reset_dialog-694"><a href="#Photosequence.reset_dialog-694"><span class="linenos">694</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rinitialise les champs de la bote de dialogue.&quot;&quot;&quot;</span>
</span><span id="Photosequence.reset_dialog-695"><a href="#Photosequence.reset_dialog-695"><span class="linenos">695</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier de calibration</span>
</span><span id="Photosequence.reset_dialog-696"><a href="#Photosequence.reset_dialog-696"><span class="linenos">696</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier d&#39;orientation</span>
</span><span id="Photosequence.reset_dialog-697"><a href="#Photosequence.reset_dialog-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le fichier image</span>
</span><span id="Photosequence.reset_dialog-698"><a href="#Photosequence.reset_dialog-698"><span class="linenos">698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser la trajectoire des points</span>
</span><span id="Photosequence.reset_dialog-699"><a href="#Photosequence.reset_dialog-699"><span class="linenos">699</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Rinitialiser le rpertoire de sortie</span>
</span></pre></div>


            <div class="docstring"><p>Rinitialise les champs de la bote de dialogue.</p>
</div>


                            </div>
                            <div id="Photosequence.disconnect_signals" class="classattr">
                                        <input id="Photosequence.disconnect_signals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disconnect_signals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.disconnect_signals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.disconnect_signals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.disconnect_signals-701"><a href="#Photosequence.disconnect_signals-701"><span class="linenos">701</span></a>    <span class="k">def</span> <span class="nf">disconnect_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence.disconnect_signals-702"><a href="#Photosequence.disconnect_signals-702"><span class="linenos">702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dconnecte les signaux pour viter les doublons.&quot;&quot;&quot;</span>
</span><span id="Photosequence.disconnect_signals-703"><a href="#Photosequence.disconnect_signals-703"><span class="linenos">703</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Photosequence.disconnect_signals-704"><a href="#Photosequence.disconnect_signals-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence.disconnect_signals-705"><a href="#Photosequence.disconnect_signals-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence.disconnect_signals-706"><a href="#Photosequence.disconnect_signals-706"><span class="linenos">706</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence.disconnect_signals-707"><a href="#Photosequence.disconnect_signals-707"><span class="linenos">707</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence.disconnect_signals-708"><a href="#Photosequence.disconnect_signals-708"><span class="linenos">708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence.disconnect_signals-709"><a href="#Photosequence.disconnect_signals-709"><span class="linenos">709</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_micmac</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence.disconnect_signals-710"><a href="#Photosequence.disconnect_signals-710"><span class="linenos">710</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_classic</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</span><span id="Photosequence.disconnect_signals-711"><a href="#Photosequence.disconnect_signals-711"><span class="linenos">711</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="Photosequence.disconnect_signals-712"><a href="#Photosequence.disconnect_signals-712"><span class="linenos">712</span></a>            <span class="c1"># Si les signaux ne sont pas connects, ignorer les erreurs</span>
</span><span id="Photosequence.disconnect_signals-713"><a href="#Photosequence.disconnect_signals-713"><span class="linenos">713</span></a>            <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Dconnecte les signaux pour viter les doublons.</p>
</div>


                            </div>
                            <div id="Photosequence.get_image_files" class="classattr">
                                        <input id="Photosequence.get_image_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_image_files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">directory</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.get_image_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.get_image_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.get_image_files-715"><a href="#Photosequence.get_image_files-715"><span class="linenos">715</span></a>    <span class="k">def</span> <span class="nf">get_image_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence.get_image_files-716"><a href="#Photosequence.get_image_files-716"><span class="linenos">716</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.get_image_files-717"><a href="#Photosequence.get_image_files-717"><span class="linenos">717</span></a><span class="sd">        Parcourt tous les fichiers dans le rpertoire spcifi et retourne une liste des chemins des fichiers image</span>
</span><span id="Photosequence.get_image_files-718"><a href="#Photosequence.get_image_files-718"><span class="linenos">718</span></a><span class="sd">        (avec les extensions .JPG, .PNG, .TIF), trie par ordre alphabtique des noms de fichiers,</span>
</span><span id="Photosequence.get_image_files-719"><a href="#Photosequence.get_image_files-719"><span class="linenos">719</span></a><span class="sd">        en excluant ceux dont le nom se termine par &quot;_Masq&quot; ou &quot;_masq_merged&quot;.</span>
</span><span id="Photosequence.get_image_files-720"><a href="#Photosequence.get_image_files-720"><span class="linenos">720</span></a><span class="sd">        </span>
</span><span id="Photosequence.get_image_files-721"><a href="#Photosequence.get_image_files-721"><span class="linenos">721</span></a><span class="sd">        :param directory: Le chemin du rpertoire  parcourir.</span>
</span><span id="Photosequence.get_image_files-722"><a href="#Photosequence.get_image_files-722"><span class="linenos">722</span></a><span class="sd">        :type directory: str</span>
</span><span id="Photosequence.get_image_files-723"><a href="#Photosequence.get_image_files-723"><span class="linenos">723</span></a><span class="sd">        </span>
</span><span id="Photosequence.get_image_files-724"><a href="#Photosequence.get_image_files-724"><span class="linenos">724</span></a><span class="sd">        :return: Liste des chemins de fichiers image trie par ordre alphabtique, avec exclusions.</span>
</span><span id="Photosequence.get_image_files-725"><a href="#Photosequence.get_image_files-725"><span class="linenos">725</span></a><span class="sd">        :rtype: list</span>
</span><span id="Photosequence.get_image_files-726"><a href="#Photosequence.get_image_files-726"><span class="linenos">726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.get_image_files-727"><a href="#Photosequence.get_image_files-727"><span class="linenos">727</span></a>
</span><span id="Photosequence.get_image_files-728"><a href="#Photosequence.get_image_files-728"><span class="linenos">728</span></a>        <span class="c1"># Vrifier si le rpertoire existe</span>
</span><span id="Photosequence.get_image_files-729"><a href="#Photosequence.get_image_files-729"><span class="linenos">729</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence.get_image_files-730"><a href="#Photosequence.get_image_files-730"><span class="linenos">730</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Le rpertoire spcifi n&#39;existe pas : </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.get_image_files-731"><a href="#Photosequence.get_image_files-731"><span class="linenos">731</span></a>
</span><span id="Photosequence.get_image_files-732"><a href="#Photosequence.get_image_files-732"><span class="linenos">732</span></a>        <span class="c1"># Initialiser une liste pour les fichiers image</span>
</span><span id="Photosequence.get_image_files-733"><a href="#Photosequence.get_image_files-733"><span class="linenos">733</span></a>        <span class="n">image_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.get_image_files-734"><a href="#Photosequence.get_image_files-734"><span class="linenos">734</span></a>
</span><span id="Photosequence.get_image_files-735"><a href="#Photosequence.get_image_files-735"><span class="linenos">735</span></a>        <span class="c1"># Extensions d&#39;image acceptes</span>
</span><span id="Photosequence.get_image_files-736"><a href="#Photosequence.get_image_files-736"><span class="linenos">736</span></a>        <span class="n">valid_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">]</span>
</span><span id="Photosequence.get_image_files-737"><a href="#Photosequence.get_image_files-737"><span class="linenos">737</span></a>
</span><span id="Photosequence.get_image_files-738"><a href="#Photosequence.get_image_files-738"><span class="linenos">738</span></a>        <span class="c1"># Parcourir les fichiers dans le rpertoire</span>
</span><span id="Photosequence.get_image_files-739"><a href="#Photosequence.get_image_files-739"><span class="linenos">739</span></a>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence.get_image_files-740"><a href="#Photosequence.get_image_files-740"><span class="linenos">740</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="Photosequence.get_image_files-741"><a href="#Photosequence.get_image_files-741"><span class="linenos">741</span></a>            <span class="n">file_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Photosequence.get_image_files-742"><a href="#Photosequence.get_image_files-742"><span class="linenos">742</span></a>
</span><span id="Photosequence.get_image_files-743"><a href="#Photosequence.get_image_files-743"><span class="linenos">743</span></a>            <span class="c1"># Vrifier si c&#39;est un fichier et si l&#39;extension est valide</span>
</span><span id="Photosequence.get_image_files-744"><a href="#Photosequence.get_image_files-744"><span class="linenos">744</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">valid_extensions</span><span class="p">:</span>
</span><span id="Photosequence.get_image_files-745"><a href="#Photosequence.get_image_files-745"><span class="linenos">745</span></a>                <span class="c1"># Exclure les fichiers dont le nom se termine par &quot;_Masq.ext&quot; ou &quot;_masq_merged.ext&quot;</span>
</span><span id="Photosequence.get_image_files-746"><a href="#Photosequence.get_image_files-746"><span class="linenos">746</span></a>                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_Masq&quot;</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_masq_merged&quot;</span> <span class="o">+</span> <span class="n">file_ext</span><span class="p">):</span>
</span><span id="Photosequence.get_image_files-747"><a href="#Photosequence.get_image_files-747"><span class="linenos">747</span></a>                    <span class="k">continue</span>
</span><span id="Photosequence.get_image_files-748"><a href="#Photosequence.get_image_files-748"><span class="linenos">748</span></a>                <span class="n">image_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="Photosequence.get_image_files-749"><a href="#Photosequence.get_image_files-749"><span class="linenos">749</span></a>
</span><span id="Photosequence.get_image_files-750"><a href="#Photosequence.get_image_files-750"><span class="linenos">750</span></a>        <span class="c1"># Trier la liste par ordre alphabtique des noms de fichiers</span>
</span><span id="Photosequence.get_image_files-751"><a href="#Photosequence.get_image_files-751"><span class="linenos">751</span></a>        <span class="n">image_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="Photosequence.get_image_files-752"><a href="#Photosequence.get_image_files-752"><span class="linenos">752</span></a>
</span><span id="Photosequence.get_image_files-753"><a href="#Photosequence.get_image_files-753"><span class="linenos">753</span></a>        <span class="k">return</span> <span class="n">image_files</span>
</span></pre></div>


            <div class="docstring"><p>Parcourt tous les fichiers dans le rpertoire spcifi et retourne une liste des chemins des fichiers image
(avec les extensions .JPG, .PNG, .TIF), trie par ordre alphabtique des noms de fichiers,
en excluant ceux dont le nom se termine par "_Masq" ou "_masq_merged".</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>directory</strong>:  Le chemin du rpertoire  parcourir.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Liste des chemins de fichiers image trie par ordre alphabtique, avec exclusions.</p>
</blockquote>
</div>


                            </div>
                            <div id="Photosequence.get_merged_mask_images" class="classattr">
                                        <input id="Photosequence.get_merged_mask_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_merged_mask_images</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">directory</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.get_merged_mask_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.get_merged_mask_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.get_merged_mask_images-755"><a href="#Photosequence.get_merged_mask_images-755"><span class="linenos">755</span></a>    <span class="k">def</span> <span class="nf">get_merged_mask_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence.get_merged_mask_images-756"><a href="#Photosequence.get_merged_mask_images-756"><span class="linenos">756</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Photosequence.get_merged_mask_images-757"><a href="#Photosequence.get_merged_mask_images-757"><span class="linenos">757</span></a><span class="sd">        Rcupre les fichiers d&#39;image dans un rpertoire qui se terminent par &quot;_masq_merged.png&quot;.</span>
</span><span id="Photosequence.get_merged_mask_images-758"><a href="#Photosequence.get_merged_mask_images-758"><span class="linenos">758</span></a><span class="sd">        </span>
</span><span id="Photosequence.get_merged_mask_images-759"><a href="#Photosequence.get_merged_mask_images-759"><span class="linenos">759</span></a><span class="sd">        :param directory: Le chemin du rpertoire  parcourir.</span>
</span><span id="Photosequence.get_merged_mask_images-760"><a href="#Photosequence.get_merged_mask_images-760"><span class="linenos">760</span></a><span class="sd">        :type directory: str</span>
</span><span id="Photosequence.get_merged_mask_images-761"><a href="#Photosequence.get_merged_mask_images-761"><span class="linenos">761</span></a><span class="sd">        </span>
</span><span id="Photosequence.get_merged_mask_images-762"><a href="#Photosequence.get_merged_mask_images-762"><span class="linenos">762</span></a><span class="sd">        :return: Liste des chemins des fichiers image se terminant par &quot;_masq_merged.png&quot;.</span>
</span><span id="Photosequence.get_merged_mask_images-763"><a href="#Photosequence.get_merged_mask_images-763"><span class="linenos">763</span></a><span class="sd">        :rtype: list</span>
</span><span id="Photosequence.get_merged_mask_images-764"><a href="#Photosequence.get_merged_mask_images-764"><span class="linenos">764</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Photosequence.get_merged_mask_images-765"><a href="#Photosequence.get_merged_mask_images-765"><span class="linenos">765</span></a>
</span><span id="Photosequence.get_merged_mask_images-766"><a href="#Photosequence.get_merged_mask_images-766"><span class="linenos">766</span></a>        <span class="c1"># Vrifier si le rpertoire existe</span>
</span><span id="Photosequence.get_merged_mask_images-767"><a href="#Photosequence.get_merged_mask_images-767"><span class="linenos">767</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence.get_merged_mask_images-768"><a href="#Photosequence.get_merged_mask_images-768"><span class="linenos">768</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Le rpertoire spcifi n&#39;existe pas : </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Photosequence.get_merged_mask_images-769"><a href="#Photosequence.get_merged_mask_images-769"><span class="linenos">769</span></a>
</span><span id="Photosequence.get_merged_mask_images-770"><a href="#Photosequence.get_merged_mask_images-770"><span class="linenos">770</span></a>        <span class="c1"># Initialiser une liste pour les fichiers image</span>
</span><span id="Photosequence.get_merged_mask_images-771"><a href="#Photosequence.get_merged_mask_images-771"><span class="linenos">771</span></a>        <span class="n">merged_mask_images</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.get_merged_mask_images-772"><a href="#Photosequence.get_merged_mask_images-772"><span class="linenos">772</span></a>
</span><span id="Photosequence.get_merged_mask_images-773"><a href="#Photosequence.get_merged_mask_images-773"><span class="linenos">773</span></a>        <span class="c1"># Parcourir les fichiers dans le rpertoire</span>
</span><span id="Photosequence.get_merged_mask_images-774"><a href="#Photosequence.get_merged_mask_images-774"><span class="linenos">774</span></a>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Photosequence.get_merged_mask_images-775"><a href="#Photosequence.get_merged_mask_images-775"><span class="linenos">775</span></a>            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="Photosequence.get_merged_mask_images-776"><a href="#Photosequence.get_merged_mask_images-776"><span class="linenos">776</span></a>
</span><span id="Photosequence.get_merged_mask_images-777"><a href="#Photosequence.get_merged_mask_images-777"><span class="linenos">777</span></a>            <span class="c1"># Vrifier si c&#39;est un fichier et si le nom se termine par &quot;_masq_merged.png&quot;</span>
</span><span id="Photosequence.get_merged_mask_images-778"><a href="#Photosequence.get_merged_mask_images-778"><span class="linenos">778</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_masq_merged.png&quot;</span><span class="p">):</span>
</span><span id="Photosequence.get_merged_mask_images-779"><a href="#Photosequence.get_merged_mask_images-779"><span class="linenos">779</span></a>                <span class="n">merged_mask_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="Photosequence.get_merged_mask_images-780"><a href="#Photosequence.get_merged_mask_images-780"><span class="linenos">780</span></a>
</span><span id="Photosequence.get_merged_mask_images-781"><a href="#Photosequence.get_merged_mask_images-781"><span class="linenos">781</span></a>        <span class="k">return</span> <span class="n">merged_mask_images</span>
</span></pre></div>


            <div class="docstring"><p>Rcupre les fichiers d'image dans un rpertoire qui se terminent par "_masq_merged.png".</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>directory</strong>:  Le chemin du rpertoire  parcourir.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Liste des chemins des fichiers image se terminant par "_masq_merged.png".</p>
</blockquote>
</div>


                            </div>
                            <div id="Photosequence.run" class="classattr">
                                        <input id="Photosequence.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Photosequence.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Photosequence.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Photosequence.run-783"><a href="#Photosequence.run-783"><span class="linenos">783</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Photosequence.run-784"><a href="#Photosequence.run-784"><span class="linenos">784</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run method that performs all the real work&quot;&quot;&quot;</span>
</span><span id="Photosequence.run-785"><a href="#Photosequence.run-785"><span class="linenos">785</span></a>
</span><span id="Photosequence.run-786"><a href="#Photosequence.run-786"><span class="linenos">786</span></a>        <span class="c1"># Create the dialog with elements (after translation) and keep reference</span>
</span><span id="Photosequence.run-787"><a href="#Photosequence.run-787"><span class="linenos">787</span></a>        <span class="c1"># Only create GUI ONCE in callback, so that it will only load when the plugin is started</span>
</span><span id="Photosequence.run-788"><a href="#Photosequence.run-788"><span class="linenos">788</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Photosequence.run-789"><a href="#Photosequence.run-789"><span class="linenos">789</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_start</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Photosequence.run-790"><a href="#Photosequence.run-790"><span class="linenos">790</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">PhotosequenceDialog</span><span class="p">()</span>
</span><span id="Photosequence.run-791"><a href="#Photosequence.run-791"><span class="linenos">791</span></a>
</span><span id="Photosequence.run-792"><a href="#Photosequence.run-792"><span class="linenos">792</span></a>        <span class="c1"># show the dialog</span>
</span><span id="Photosequence.run-793"><a href="#Photosequence.run-793"><span class="linenos">793</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset_dialog</span><span class="p">()</span>
</span><span id="Photosequence.run-794"><a href="#Photosequence.run-794"><span class="linenos">794</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Photosequence.run-795"><a href="#Photosequence.run-795"><span class="linenos">795</span></a>
</span><span id="Photosequence.run-796"><a href="#Photosequence.run-796"><span class="linenos">796</span></a>        <span class="c1">#permet d&#39;viter les doublons</span>
</span><span id="Photosequence.run-797"><a href="#Photosequence.run-797"><span class="linenos">797</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_signals</span><span class="p">()</span>
</span><span id="Photosequence.run-798"><a href="#Photosequence.run-798"><span class="linenos">798</span></a>
</span><span id="Photosequence.run-799"><a href="#Photosequence.run-799"><span class="linenos">799</span></a>        <span class="c1"># Connecter les boutons au fichier XML correspondant</span>
</span><span id="Photosequence.run-800"><a href="#Photosequence.run-800"><span class="linenos">800</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="Photosequence.run-801"><a href="#Photosequence.run-801"><span class="linenos">801</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="p">,</span> <span class="s1">&#39;calibration&#39;</span><span class="p">))</span>  <span class="c1"># Bouton pour le fichier de calibration</span>
</span><span id="Photosequence.run-802"><a href="#Photosequence.run-802"><span class="linenos">802</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_3</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="Photosequence.run-803"><a href="#Photosequence.run-803"><span class="linenos">803</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesXml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">))</span>  <span class="c1"># Bouton pour le fichier d&#39;orientation</span>
</span><span id="Photosequence.run-804"><a href="#Photosequence.run-804"><span class="linenos">804</span></a>
</span><span id="Photosequence.run-805"><a href="#Photosequence.run-805"><span class="linenos">805</span></a>        <span class="c1">#connecter les boutons pour les fichiers images</span>
</span><span id="Photosequence.run-806"><a href="#Photosequence.run-806"><span class="linenos">806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_5</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesIMG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="p">))</span>
</span><span id="Photosequence.run-807"><a href="#Photosequence.run-807"><span class="linenos">807</span></a>        <span class="c1">#connecter les boutons pour les fichiers trajecto</span>
</span><span id="Photosequence.run-808"><a href="#Photosequence.run-808"><span class="linenos">808</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_6</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseFilesGPKG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">))</span>
</span><span id="Photosequence.run-809"><a href="#Photosequence.run-809"><span class="linenos">809</span></a>
</span><span id="Photosequence.run-810"><a href="#Photosequence.run-810"><span class="linenos">810</span></a>        <span class="c1"># connecter le bouton repertoire de sortie</span>
</span><span id="Photosequence.run-811"><a href="#Photosequence.run-811"><span class="linenos">811</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">toolButton_7</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">BrowseOutputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="p">))</span>
</span><span id="Photosequence.run-812"><a href="#Photosequence.run-812"><span class="linenos">812</span></a>
</span><span id="Photosequence.run-813"><a href="#Photosequence.run-813"><span class="linenos">813</span></a>        <span class="c1"># Run the dialog event loop</span>
</span><span id="Photosequence.run-814"><a href="#Photosequence.run-814"><span class="linenos">814</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</span><span id="Photosequence.run-815"><a href="#Photosequence.run-815"><span class="linenos">815</span></a>        <span class="c1"># See if OK was pressed</span>
</span><span id="Photosequence.run-816"><a href="#Photosequence.run-816"><span class="linenos">816</span></a>        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Photosequence.run-817"><a href="#Photosequence.run-817"><span class="linenos">817</span></a>
</span><span id="Photosequence.run-818"><a href="#Photosequence.run-818"><span class="linenos">818</span></a>            <span class="n">calibration_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_2</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence.run-819"><a href="#Photosequence.run-819"><span class="linenos">819</span></a>            <span class="n">orientation_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_3</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence.run-820"><a href="#Photosequence.run-820"><span class="linenos">820</span></a>            <span class="n">image_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_4</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence.run-821"><a href="#Photosequence.run-821"><span class="linenos">821</span></a>            <span class="n">point_trajectory_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_6</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence.run-822"><a href="#Photosequence.run-822"><span class="linenos">822</span></a>            <span class="n">OutputDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit_7</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence.run-823"><a href="#Photosequence.run-823"><span class="linenos">823</span></a>            <span class="n">epsg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">le_epsg</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span id="Photosequence.run-824"><a href="#Photosequence.run-824"><span class="linenos">824</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">:</span>
</span><span id="Photosequence.run-825"><a href="#Photosequence.run-825"><span class="linenos">825</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">init_transformer</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence.run-826"><a href="#Photosequence.run-826"><span class="linenos">826</span></a>
</span><span id="Photosequence.run-827"><a href="#Photosequence.run-827"><span class="linenos">827</span></a>            <span class="c1"># Rcuperer les coordonnes de l&#39;aronef dans la BDD de la trajectoire en .gpkg</span>
</span><span id="Photosequence.run-828"><a href="#Photosequence.run-828"><span class="linenos">828</span></a>            <span class="n">posx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">)</span>
</span><span id="Photosequence.run-829"><a href="#Photosequence.run-829"><span class="linenos">829</span></a>            <span class="n">posy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
</span><span id="Photosequence.run-830"><a href="#Photosequence.run-830"><span class="linenos">830</span></a>            <span class="n">posz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;alt_m&#39;</span><span class="p">)</span>
</span><span id="Photosequence.run-831"><a href="#Photosequence.run-831"><span class="linenos">831</span></a>            <span class="n">posz_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s1">&#39;mnt_m&#39;</span><span class="p">)</span>
</span><span id="Photosequence.run-832"><a href="#Photosequence.run-832"><span class="linenos">832</span></a>
</span><span id="Photosequence.run-833"><a href="#Photosequence.run-833"><span class="linenos">833</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-834"><a href="#Photosequence.run-834"><span class="linenos">834</span></a>            <span class="c1"># crer le projet QGIS</span>
</span><span id="Photosequence.run-835"><a href="#Photosequence.run-835"><span class="linenos">835</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-836"><a href="#Photosequence.run-836"><span class="linenos">836</span></a>
</span><span id="Photosequence.run-837"><a href="#Photosequence.run-837"><span class="linenos">837</span></a>            <span class="n">project_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_projet_qgis</span><span class="p">(</span><span class="n">OutputDir</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence.run-838"><a href="#Photosequence.run-838"><span class="linenos">838</span></a>
</span><span id="Photosequence.run-839"><a href="#Photosequence.run-839"><span class="linenos">839</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-840"><a href="#Photosequence.run-840"><span class="linenos">840</span></a>            <span class="c1"># gestion de la banque d&#39;image</span>
</span><span id="Photosequence.run-841"><a href="#Photosequence.run-841"><span class="linenos">841</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-842"><a href="#Photosequence.run-842"><span class="linenos">842</span></a>
</span><span id="Photosequence.run-843"><a href="#Photosequence.run-843"><span class="linenos">843</span></a>            <span class="n">images_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
</span><span id="Photosequence.run-844"><a href="#Photosequence.run-844"><span class="linenos">844</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">images_list</span><span class="p">)</span>
</span><span id="Photosequence.run-845"><a href="#Photosequence.run-845"><span class="linenos">845</span></a>
</span><span id="Photosequence.run-846"><a href="#Photosequence.run-846"><span class="linenos">846</span></a>            <span class="n">base_img</span> <span class="o">=</span> <span class="n">images_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Photosequence.run-847"><a href="#Photosequence.run-847"><span class="linenos">847</span></a>            <span class="n">base_img_lyr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_png_to_qgis_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">base_img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence.run-848"><a href="#Photosequence.run-848"><span class="linenos">848</span></a>
</span><span id="Photosequence.run-849"><a href="#Photosequence.run-849"><span class="linenos">849</span></a>            <span class="c1"># Zoom to first raster layer extent</span>
</span><span id="Photosequence.run-850"><a href="#Photosequence.run-850"><span class="linenos">850</span></a>            <span class="n">extent</span> <span class="o">=</span> <span class="n">base_img_lyr</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
</span><span id="Photosequence.run-851"><a href="#Photosequence.run-851"><span class="linenos">851</span></a>            <span class="n">projection</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">base_img_lyr</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
</span><span id="Photosequence.run-852"><a href="#Photosequence.run-852"><span class="linenos">852</span></a>                                                <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
</span><span id="Photosequence.run-853"><a href="#Photosequence.run-853"><span class="linenos">853</span></a>                                                <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">())</span>
</span><span id="Photosequence.run-854"><a href="#Photosequence.run-854"><span class="linenos">854</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">setExtent</span><span class="p">(</span><span class="n">projection</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">extent</span><span class="p">))</span>
</span><span id="Photosequence.run-855"><a href="#Photosequence.run-855"><span class="linenos">855</span></a>
</span><span id="Photosequence.run-856"><a href="#Photosequence.run-856"><span class="linenos">856</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-857"><a href="#Photosequence.run-857"><span class="linenos">857</span></a>            <span class="c1"># Gestion des masques</span>
</span><span id="Photosequence.run-858"><a href="#Photosequence.run-858"><span class="linenos">858</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-859"><a href="#Photosequence.run-859"><span class="linenos">859</span></a>
</span><span id="Photosequence.run-860"><a href="#Photosequence.run-860"><span class="linenos">860</span></a>            <span class="c1"># Boucle permettant de fusionner les masque micmac des images aux images.</span>
</span><span id="Photosequence.run-861"><a href="#Photosequence.run-861"><span class="linenos">861</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_list</span><span class="p">)):</span>
</span><span id="Photosequence.run-862"><a href="#Photosequence.run-862"><span class="linenos">862</span></a>                <span class="c1"># Charger l&#39;image en couleur et le masque</span>
</span><span id="Photosequence.run-863"><a href="#Photosequence.run-863"><span class="linenos">863</span></a>                <span class="n">path_in</span> <span class="o">=</span> <span class="n">images_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Photosequence.run-864"><a href="#Photosequence.run-864"><span class="linenos">864</span></a>                <span class="n">path_mask</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_Masq.tif&quot;</span>
</span><span id="Photosequence.run-865"><a href="#Photosequence.run-865"><span class="linenos">865</span></a>                <span class="c1"># print(path_mask)</span>
</span><span id="Photosequence.run-866"><a href="#Photosequence.run-866"><span class="linenos">866</span></a>                <span class="n">image_color</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_in</span><span class="p">)</span>
</span><span id="Photosequence.run-867"><a href="#Photosequence.run-867"><span class="linenos">867</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span><span id="Photosequence.run-868"><a href="#Photosequence.run-868"><span class="linenos">868</span></a>
</span><span id="Photosequence.run-869"><a href="#Photosequence.run-869"><span class="linenos">869</span></a>                <span class="c1"># Vrifier que les dimensions correspondent</span>
</span><span id="Photosequence.run-870"><a href="#Photosequence.run-870"><span class="linenos">870</span></a>                <span class="k">if</span> <span class="n">image_color</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="Photosequence.run-871"><a href="#Photosequence.run-871"><span class="linenos">871</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Les dimensions de l&#39;image couleur et du masque ne correspondent pas.&quot;</span><span class="p">)</span>
</span><span id="Photosequence.run-872"><a href="#Photosequence.run-872"><span class="linenos">872</span></a>
</span><span id="Photosequence.run-873"><a href="#Photosequence.run-873"><span class="linenos">873</span></a>                <span class="c1"># Convertir le masque en 3 canaux pour l&#39;appliquer sur l&#39;image couleur</span>
</span><span id="Photosequence.run-874"><a href="#Photosequence.run-874"><span class="linenos">874</span></a>                <span class="n">mask_3channel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="Photosequence.run-875"><a href="#Photosequence.run-875"><span class="linenos">875</span></a>
</span><span id="Photosequence.run-876"><a href="#Photosequence.run-876"><span class="linenos">876</span></a>                <span class="c1"># Appliquer le masque  l&#39;image couleur</span>
</span><span id="Photosequence.run-877"><a href="#Photosequence.run-877"><span class="linenos">877</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">image_color</span><span class="p">,</span> <span class="n">mask_3channel</span><span class="p">)</span>
</span><span id="Photosequence.run-878"><a href="#Photosequence.run-878"><span class="linenos">878</span></a>
</span><span id="Photosequence.run-879"><a href="#Photosequence.run-879"><span class="linenos">879</span></a>                <span class="c1"># Sauvegarder ou afficher le rsultat</span>
</span><span id="Photosequence.run-880"><a href="#Photosequence.run-880"><span class="linenos">880</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_masq_merged.png&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="Photosequence.run-881"><a href="#Photosequence.run-881"><span class="linenos">881</span></a>            <span class="c1"># Boucle permettant de fusionner les masque micmac des images aux images.</span>
</span><span id="Photosequence.run-882"><a href="#Photosequence.run-882"><span class="linenos">882</span></a>            <span class="n">merged_mask_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_mask_images</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
</span><span id="Photosequence.run-883"><a href="#Photosequence.run-883"><span class="linenos">883</span></a>
</span><span id="Photosequence.run-884"><a href="#Photosequence.run-884"><span class="linenos">884</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">merged_mask_list</span><span class="p">)):</span>
</span><span id="Photosequence.run-885"><a href="#Photosequence.run-885"><span class="linenos">885</span></a>                <span class="c1"># Ajouter l&#39;image PNG au projet et rcuprer la couche</span>
</span><span id="Photosequence.run-886"><a href="#Photosequence.run-886"><span class="linenos">886</span></a>                <span class="n">transparence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Photosequence.run-887"><a href="#Photosequence.run-887"><span class="linenos">887</span></a>                <span class="n">raster_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_png_to_qgis_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">merged_mask_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">epsg</span><span class="p">,</span> <span class="n">transparence</span><span class="p">)</span>
</span><span id="Photosequence.run-888"><a href="#Photosequence.run-888"><span class="linenos">888</span></a>
</span><span id="Photosequence.run-889"><a href="#Photosequence.run-889"><span class="linenos">889</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-890"><a href="#Photosequence.run-890"><span class="linenos">890</span></a>            <span class="c1"># ALGORITHME &quot;MAISON&quot;</span>
</span><span id="Photosequence.run-891"><a href="#Photosequence.run-891"><span class="linenos">891</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-892"><a href="#Photosequence.run-892"><span class="linenos">892</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_classic</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="Photosequence.run-893"><a href="#Photosequence.run-893"><span class="linenos">893</span></a>
</span><span id="Photosequence.run-894"><a href="#Photosequence.run-894"><span class="linenos">894</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-895"><a href="#Photosequence.run-895"><span class="linenos">895</span></a>                <span class="c1">#             Trajectoire de l&#39;avion</span>
</span><span id="Photosequence.run-896"><a href="#Photosequence.run-896"><span class="linenos">896</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-897"><a href="#Photosequence.run-897"><span class="linenos">897</span></a>                <span class="c1"># Rcuprer les indices des valeurs non NULL et transformer les coordonnes en flottants</span>
</span><span id="Photosequence.run-898"><a href="#Photosequence.run-898"><span class="linenos">898</span></a>                <span class="n">indices_posx_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">posx</span><span class="p">)</span> <span class="k">if</span>
</span><span id="Photosequence.run-899"><a href="#Photosequence.run-899"><span class="linenos">899</span></a>                                         <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence.run-900"><a href="#Photosequence.run-900"><span class="linenos">900</span></a>                <span class="n">indices_posy_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">posy</span><span class="p">)</span> <span class="k">if</span>
</span><span id="Photosequence.run-901"><a href="#Photosequence.run-901"><span class="linenos">901</span></a>                                         <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence.run-902"><a href="#Photosequence.run-902"><span class="linenos">902</span></a>
</span><span id="Photosequence.run-903"><a href="#Photosequence.run-903"><span class="linenos">903</span></a>                <span class="c1"># Permet de trier les valeurs de la BDD pour enlever les valeurs NULL et aussi transformer les coordonnes en flottant</span>
</span><span id="Photosequence.run-904"><a href="#Photosequence.run-904"><span class="linenos">904</span></a>                <span class="n">posx_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posx</span> <span class="k">if</span>
</span><span id="Photosequence.run-905"><a href="#Photosequence.run-905"><span class="linenos">905</span></a>                                 <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence.run-906"><a href="#Photosequence.run-906"><span class="linenos">906</span></a>                <span class="n">posy_not_null</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posy</span> <span class="k">if</span>
</span><span id="Photosequence.run-907"><a href="#Photosequence.run-907"><span class="linenos">907</span></a>                                 <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isNull</span><span class="p">()]</span>
</span><span id="Photosequence.run-908"><a href="#Photosequence.run-908"><span class="linenos">908</span></a>                <span class="n">posz_not_null</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.run-909"><a href="#Photosequence.run-909"><span class="linenos">909</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">)):</span>
</span><span id="Photosequence.run-910"><a href="#Photosequence.run-910"><span class="linenos">910</span></a>                    <span class="n">posz_not_null</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posz</span><span class="p">[</span><span class="n">indices_posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="Photosequence.run-911"><a href="#Photosequence.run-911"><span class="linenos">911</span></a>
</span><span id="Photosequence.run-912"><a href="#Photosequence.run-912"><span class="linenos">912</span></a>                <span class="n">coord_XY_qgs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.run-913"><a href="#Photosequence.run-913"><span class="linenos">913</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">))):</span>
</span><span id="Photosequence.run-914"><a href="#Photosequence.run-914"><span class="linenos">914</span></a>                    <span class="n">coord_XY_qgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">posy_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="Photosequence.run-915"><a href="#Photosequence.run-915"><span class="linenos">915</span></a>
</span><span id="Photosequence.run-916"><a href="#Photosequence.run-916"><span class="linenos">916</span></a>                <span class="n">coord_proj_air</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Photosequence.run-917"><a href="#Photosequence.run-917"><span class="linenos">917</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence.run-918"><a href="#Photosequence.run-918"><span class="linenos">918</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">coord_XY_qgs</span><span class="p">:</span>
</span><span id="Photosequence.run-919"><a href="#Photosequence.run-919"><span class="linenos">919</span></a>                    <span class="n">point_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="Photosequence.run-920"><a href="#Photosequence.run-920"><span class="linenos">920</span></a>                    <span class="n">coord_proj_air</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_proj</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">posz_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="Photosequence.run-921"><a href="#Photosequence.run-921"><span class="linenos">921</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Photosequence.run-922"><a href="#Photosequence.run-922"><span class="linenos">922</span></a>                <span class="c1"># print(&quot;coord_proj_air: &quot;,coord_proj_air)</span>
</span><span id="Photosequence.run-923"><a href="#Photosequence.run-923"><span class="linenos">923</span></a>
</span><span id="Photosequence.run-924"><a href="#Photosequence.run-924"><span class="linenos">924</span></a>                <span class="n">L_coord_image_air</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span> <span class="n">coord_proj_air</span><span class="p">,</span> <span class="n">base_img</span><span class="p">)</span>
</span><span id="Photosequence.run-925"><a href="#Photosequence.run-925"><span class="linenos">925</span></a>                <span class="c1"># print(&quot;L_coord_image_air: &quot;,L_coord_image_air)</span>
</span><span id="Photosequence.run-926"><a href="#Photosequence.run-926"><span class="linenos">926</span></a>                <span class="c1"># self.creer_ligne(L_coord_image_air)</span>
</span><span id="Photosequence.run-927"><a href="#Photosequence.run-927"><span class="linenos">927</span></a>
</span><span id="Photosequence.run-928"><a href="#Photosequence.run-928"><span class="linenos">928</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-929"><a href="#Photosequence.run-929"><span class="linenos">929</span></a>                <span class="c1">#             Trace au sol</span>
</span><span id="Photosequence.run-930"><a href="#Photosequence.run-930"><span class="linenos">930</span></a>                <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-931"><a href="#Photosequence.run-931"><span class="linenos">931</span></a>                <span class="n">posz_not_null_tr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Photosequence.run-932"><a href="#Photosequence.run-932"><span class="linenos">932</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">)):</span>
</span><span id="Photosequence.run-933"><a href="#Photosequence.run-933"><span class="linenos">933</span></a>                    <span class="n">posz_not_null_tr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posz_tr</span><span class="p">[</span><span class="n">indices_posx_not_null</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="Photosequence.run-934"><a href="#Photosequence.run-934"><span class="linenos">934</span></a>
</span><span id="Photosequence.run-935"><a href="#Photosequence.run-935"><span class="linenos">935</span></a>                <span class="n">coord_proj_tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posx_not_null</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Photosequence.run-936"><a href="#Photosequence.run-936"><span class="linenos">936</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Photosequence.run-937"><a href="#Photosequence.run-937"><span class="linenos">937</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">coord_XY_qgs</span><span class="p">:</span>
</span><span id="Photosequence.run-938"><a href="#Photosequence.run-938"><span class="linenos">938</span></a>                    <span class="n">point_proj_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="Photosequence.run-939"><a href="#Photosequence.run-939"><span class="linenos">939</span></a>                    <span class="n">coord_proj_tr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_proj_tr</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">point_proj_tr</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">posz_not_null_tr</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="Photosequence.run-940"><a href="#Photosequence.run-940"><span class="linenos">940</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Photosequence.run-941"><a href="#Photosequence.run-941"><span class="linenos">941</span></a>
</span><span id="Photosequence.run-942"><a href="#Photosequence.run-942"><span class="linenos">942</span></a>                <span class="n">L_coord_image_tr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransfoCoord</span><span class="p">(</span><span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span> <span class="n">coord_proj_tr</span><span class="p">,</span> <span class="n">base_img</span><span class="p">)</span>
</span><span id="Photosequence.run-943"><a href="#Photosequence.run-943"><span class="linenos">943</span></a>                <span class="c1"># print(&quot;L_coord_image_tr: &quot;,L_coord_image_tr)</span>
</span><span id="Photosequence.run-944"><a href="#Photosequence.run-944"><span class="linenos">944</span></a>
</span><span id="Photosequence.run-945"><a href="#Photosequence.run-945"><span class="linenos">945</span></a>                <span class="n">layer_polygone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_polygone</span><span class="p">(</span><span class="n">L_coord_image_tr</span><span class="p">,</span> <span class="n">L_coord_image_air</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence.run-946"><a href="#Photosequence.run-946"><span class="linenos">946</span></a>
</span><span id="Photosequence.run-947"><a href="#Photosequence.run-947"><span class="linenos">947</span></a>                <span class="n">trajectory_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">point_trajectory_file</span><span class="p">,</span> <span class="s2">&quot;trajecto_fictive&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
</span><span id="Photosequence.run-948"><a href="#Photosequence.run-948"><span class="linenos">948</span></a>                <span class="n">point_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creer_points</span><span class="p">(</span><span class="n">trajectory_layer</span><span class="p">,</span> <span class="n">OutputDir</span><span class="p">,</span> <span class="n">calibration_file</span><span class="p">,</span> <span class="n">orientation_file</span><span class="p">,</span>
</span><span id="Photosequence.run-949"><a href="#Photosequence.run-949"><span class="linenos">949</span></a>                                                <span class="n">base_img</span><span class="p">,</span> <span class="n">epsg</span><span class="p">)</span>
</span><span id="Photosequence.run-950"><a href="#Photosequence.run-950"><span class="linenos">950</span></a>
</span><span id="Photosequence.run-951"><a href="#Photosequence.run-951"><span class="linenos">951</span></a>
</span><span id="Photosequence.run-952"><a href="#Photosequence.run-952"><span class="linenos">952</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-953"><a href="#Photosequence.run-953"><span class="linenos">953</span></a>            <span class="c1"># si MicMac est choisi</span>
</span><span id="Photosequence.run-954"><a href="#Photosequence.run-954"><span class="linenos">954</span></a>            <span class="c1"># =============================================================================</span>
</span><span id="Photosequence.run-955"><a href="#Photosequence.run-955"><span class="linenos">955</span></a>
</span><span id="Photosequence.run-956"><a href="#Photosequence.run-956"><span class="linenos">956</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">rb_micmac</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="Photosequence.run-957"><a href="#Photosequence.run-957"><span class="linenos">957</span></a>                <span class="c1"># TODO</span>
</span><span id="Photosequence.run-958"><a href="#Photosequence.run-958"><span class="linenos">958</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;oui&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run method that performs all the real work</p>
</div>


                            </div>
                </section>
    </main>
</body>
</html>